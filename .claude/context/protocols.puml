@startuml Miyabi Protocols - Task Management & Reporting
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName "SF Pro Display"
skinparam shadowing false
skinparam roundCorner 10

title Miyabi Protocols - Task Management & Reporting Protocol v2.0.1

state "Task Management Protocol" as TaskMgmt {
  ' Task Management Flow
  state "Task Classification" as classify {
    [*] --> CheckComplexity
    CheckComplexity --> UseTodo : 3+ steps\nè¤‡é›‘ãªã‚¿ã‚¹ã‚¯\nãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¤‡æ•°ã‚¿ã‚¹ã‚¯ã‚’æä¾›
    CheckComplexity --> SkipTodo : å˜ç´”ãª1ã‚¹ãƒ†ãƒƒãƒ—\nç´”ç²‹ãªè³ªå•ãƒ»æƒ…å ±æä¾›
  }

  state "Todo Lifecycle" as lifecycle {
    pending --> in_progress : Start Task
    in_progress --> completed : Success
    in_progress --> in_progress : Error (Keep Status)

    note right of in_progress
      **Rule**: åŒæ™‚ã«1ã¤ã®ã¿ in_progress
      å®Œäº†ã—ãŸã‚‰**å³åº§ã«** completed ã«å¤‰æ›´
    end note
  }

  state "Todo Structure" as structure {
    state "Todo Object" as todo {
      content : "ã€Categoryã€‘Task - Details"
      status : "pending | in_progress | completed"
      activeForm : "ã€å®Ÿæ–½ä¸­ - Categoryã€‘Progress"
    }

    note right of todo
      Example:
      content: "ã€Phase 1ã€‘å‹å®‰å…¨æ€§å‘ä¸Š - Interfaceä½œæˆ"
      status: "in_progress"
      activeForm: "ã€å®Ÿè£…ä¸­ - Phase 1ã€‘Interfaceå®Ÿè£…ä¸­"
    end note
  }

  state "Prohibited Actions âŒ" as prohibited {
    state "ãƒãƒƒãƒæ›´æ–°ç¦æ­¢" as batch
    state "ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®completedç¦æ­¢" as testfail
    state "éƒ¨åˆ†å®Ÿè£…ã§ã®completedç¦æ­¢" as partial
    state "è¤‡æ•°in_progressç¦æ­¢" as multiple
  }
}

' Reporting Protocol
state "Reporting Protocol" as ReportProto {
  state "Report Structure" as report {
    state "Header" as header {
      header : å ±å‘Šè€…: Claude Code
      header : å ±å‘Šæ—¥æ™‚: YYYY-MM-DD
      header : ã‚»ãƒƒã‚·ãƒ§ãƒ³: [ã‚»ãƒƒã‚·ãƒ§ãƒ³å]
    }

    state "Completed Tasks" as completed_tasks {
      completed_tasks : âœ… å®Œäº†ã—ãŸä½œæ¥­
      completed_tasks : æ‹…å½“: Claude Code
    }

    state "Change Statistics" as stats {
      stats : ğŸ“Š å¤‰æ›´çµ±è¨ˆ
      stats : ã‚³ãƒŸãƒƒãƒˆID, å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«æ•°
      stats : è¿½åŠ è¡Œæ•°, å‰Šé™¤è¡Œæ•°
    }

    state "Verification Results" as verification {
      verification : ğŸ¯ å‹•ä½œç¢ºèªçµæœ
      verification : ç¢ºèªè€…: Claude Code
    }

    state "Next Steps" as nextsteps {
      nextsteps : ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆææ¡ˆï¼‰
      nextsteps : ææ¡ˆè€…: Claude Code
    }

    header --> completed_tasks
    completed_tasks --> stats
    stats --> verification
    verification --> nextsteps
    nextsteps --> [*] : å ±å‘Šçµ‚äº†\nClaude Code
  }

  state "Report Triggers" as triggers {
    triggers : ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚
    triggers : é‡è¦ãªãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆæ™‚
    triggers : Issueå‡¦ç†å®Œäº†æ™‚
    triggers : Agentå®Ÿè¡Œçµæœå ±å‘Š
    triggers : ã‚¨ãƒ©ãƒ¼ãƒ»å•é¡Œç™ºç”Ÿæ™‚
  }
}

' Relationships
classify --> lifecycle : Create Todo
lifecycle --> structure : Store
structure --> report : Report on Completion
triggers --> report : Trigger Report

note bottom
  **Key Principles**:
  1. å ±å‘Šè€…ã®æ˜è¨˜ - ã™ã¹ã¦ã®å ±å‘Šã§ã€ŒClaude Codeã€ã¨ã—ã¦åä¹—ã‚‹
  2. æ‹…å½“è€…ã®æ˜è¨˜ - å„ä½œæ¥­é …ç›®ã«ã€Œæ‹…å½“: Claude Codeã€ã‚’è¨˜è¼‰
  3. ç¢ºèªè€…ã®æ˜è¨˜ - å‹•ä½œç¢ºèªçµæœã«ã€Œç¢ºèªè€…: Claude Codeã€ã‚’è¨˜è¼‰
  4. ææ¡ˆè€…ã®æ˜è¨˜ - æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ææ¡ˆã«ã€Œææ¡ˆè€…: Claude Codeã€ã‚’è¨˜è¼‰

  **References**:
  - Task Management Protocol: .claude/prompts/task-management-protocol.md
  - Reporting Protocol: .claude/templates/reporting-protocol.md
end note

@enduml
