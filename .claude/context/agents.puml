@startuml Miyabi Agent System - 20 Agents Architecture
!theme plain
skinparam backgroundColor #FFFFFF
skinparam defaultFontName "SF Pro Display"
skinparam shadowing false
skinparam roundCorner 10

title Miyabi Agent System v3.0.0 - 6 Coding Agents + 14 Business Agents

' Legend
legend top right
  **Status Legend**:
  âœ… Deployed (tmux Orchestra v2.0)
  ğŸ“‹ Planned (Spec only)

  **Workflow Coverage**:
  W1: Issue Triage
  W2: Task Decomposition
  W3: Code Implementation
  W4: Code Review
  W5: Deployment
endlegend

package "Miyabi Orchestra v2.0 - Coding Agents" {
  ' W1 - Issue Triage
  component "IssueAgent\n(ã¿ã¤ã‘ã‚‹ã‚“)\nPane %10\nâœ… W1" as IssueAgent #FFE5E5

  ' W2 - Task Decomposition
  component "CoordinatorAgent\n(ã—ãã‚‹ã‚“)\nPane %11\nâœ… W2" as CoordinatorAgent #E5F5FF

  ' W3 - Code Implementation
  component "CodeGenAgent\n(ã‚«ã‚¨ãƒ‡)\nPane %2\nâœ… W3" as CodeGenAgent #FFE5F5

  ' W4 - Code Review
  component "ReviewAgent\n(ã‚µã‚¯ãƒ©)\nPane %5\nâœ… W4" as ReviewAgent #F5FFE5

  ' W3 - Pull Request
  component "PRAgent\n(ãƒ„ãƒã‚­)\nPane %3\nâœ… W3" as PRAgent #E5E5FF

  ' W5 - Deployment
  component "DeploymentAgent\n(ãƒœã‚¿ãƒ³)\nPane %4\nâœ… W5" as DeploymentAgent #FFE5E5

  ' Workflow Chain
  IssueAgent -down-> CoordinatorAgent : W1â†’W2\nLabel Assignment
  CoordinatorAgent -down-> CodeGenAgent : W2â†’W3\nTask Decomposition
  CodeGenAgent -down-> ReviewAgent : W3â†’W4\nGenerated Code
  ReviewAgent -right-> PRAgent : W4â†’W3\nQuality Report
  PRAgent -down-> DeploymentAgent : W3â†’W5\nPull Request

  note right of IssueAgent
    **Water Spider v2.0**
    è‡ªå‹•ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸­ç¶™
    ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦å®Ÿè¡Œ
    100% W1-W5ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ
  end note
}

package "Business Agents - Strategy & Planning (6 Agents)" {
  ' Leader (Red - Cannot run in parallel)
  component "AIEntrepreneurAgent\n(ã‚ãã‚“ã©ã•ã‚“)\nğŸ”´ Leader\nğŸ“‹ Planned" as AIEnt #FFE5E5

  ' Executors (Green - Can run in parallel)
  component "ProductConceptAgent\n(ã‘ã„ã‹ãã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as ProdConcept #E5FFE5
  component "ProductDesignAgent\n(ã¤ãã‚‹ã‚“2å·)\nğŸŸ¢ Executor\nâœ… Deployed" as ProdDesign #E5FFE5
  component "FunnelDesignAgent\n(ã¿ã¡ã—ã‚‹ã¹ã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as FunnelDesign #E5FFE5
  component "PersonaAgent\n(ã‚ˆã¿ã¨ã‚‹ã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as PersonaAgent #E5FFE5

  ' Analyzer (Blue - Can run in parallel)
  component "SelfAnalysisAgent\n(ã—ã‚‰ã¹ã‚‹ã‚“)\nğŸ”µ Analyzer\nâœ… Deployed" as SelfAnalysis #E5F5FF
}

package "Business Agents - Marketing (5 Agents)" {
  ' Analyzer
  component "MarketResearchAgent\n(ã—ã‚‰ã¹ã‚‹ã‚“2å·)\nğŸ”µ Analyzer\nâœ… Deployed" as MarketResearch #E5F5FF

  ' Executors
  component "MarketingAgent\n(ã²ã‚ã‚ã‚‹ã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as Marketing #E5FFE5
  component "ContentCreationAgent\n(ã‹ãã¡ã‚ƒã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as ContentCreation #E5FFE5
  component "SNSStrategyAgent\n(ã¤ã¶ã‚„ãã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as SNSStrategy #E5FFE5
  component "YouTubeAgent\n(ã©ã†ãŒãã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as YouTube #E5FFE5
}

package "Business Agents - Sales & CRM (3 Agents)" {
  component "SalesAgent\n(ã†ã‚‹ã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as Sales #E5FFE5
  component "CRMAgent\n(ã•ã•ãˆã‚‹ã‚“)\nğŸŸ¢ Executor\nâœ… Deployed" as CRM #E5FFE5

  ' Analyzer
  component "AnalyticsAgent\n(ã‹ããˆã‚‹ã‚“)\nğŸ”µ Analyzer\nâœ… Deployed" as Analytics #E5F5FF
}

' Business Agent Relationships
AIEnt --> ProdConcept : Strategy
ProdConcept --> ProdDesign : Concept
ProdDesign --> FunnelDesign : Design
PersonaAgent --> MarketResearch : Persona Data
MarketResearch --> Marketing : Market Data
Marketing --> ContentCreation : Marketing Plan
ContentCreation --> SNSStrategy : Content Plan
SNSStrategy --> YouTube : SNS Strategy
FunnelDesign --> Sales : Funnel Design
Sales --> CRM : Sales Data
CRM --> Analytics : Customer Data
Analytics --> AIEnt : Analytics Report (PDCA)

' Cross-Agent Communication
package "Agent Communication Protocol" {
  component "BaseAgent Trait" as BaseAgent
  note right of BaseAgent
    execute(task: Task) : Result<AgentResult>
  end note

  component "Worktree Manager" as WorktreeManager
  note right of WorktreeManager
    create_worktree(issue_number)
    merge_worktree(worktree)
    remove_worktree(worktree)
  end note

  BaseAgent --> WorktreeManager : Parallel Execution
}

IssueAgent .up.|> BaseAgent
CoordinatorAgent .up.|> BaseAgent
CodeGenAgent .up.|> BaseAgent
ReviewAgent .up.|> BaseAgent
PRAgent .up.|> BaseAgent
DeploymentAgent .up.|> BaseAgent

AIEnt .up.|> BaseAgent
ProdConcept .up.|> BaseAgent
MarketResearch .up.|> BaseAgent

note bottom
  **Agent Execution**:
  CLI: miyabi agent run <agent-name> --issue <number>
  Rust API: agent.execute(&task).await?
  MCP Server: {"method": "agents/<agent-type>/execute"}

  **Parallel Execution Rules**:
  ğŸ”´ Leader: Cannot run in parallel (ã‚ãã‚“ã©ã•ã‚“)
  ğŸŸ¢ Executor: Can run in parallel (10 agents)
  ğŸ”µ Analyzer: Can run in parallel (3 agents)

  **References**:
  - Agent Specs: .claude/agents/specs/{coding,business}/*.md
  - Agent Prompts: .claude/agents/prompts/coding/*.md
  - tmux Control: .claude/agents/tmux_agents_control.md
end note

@enduml
