# Miyabi Orchestra Configuration Schema
# JSON Schema Draft 07 (YAML format)
#
# ã“ã®ã‚¹ã‚­ãƒ¼ãƒã¯ã€Miyabi Orchestraï¼ˆä¸¦åˆ—Agentå®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ï¼‰ã®
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã®ã‚‚ã®ã§ã™ã€‚

$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://github.com/ShunsukeHayashi/Miyabi/schemas/orchestra-config.schema.yaml"
title: Miyabi Orchestra Configuration
description: |
  Miyabi Orchestraã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ã‚­ãƒ¼ãƒã€‚
  è¤‡æ•°ã®Agentã‚’ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å®šç¾©ã—ã¾ã™ã€‚

type: object

required:
  - orchestration
  - ensemble

properties:
  # ========================================
  # ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
  # ========================================
  orchestration:
    type: object
    description: Agentã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†ã¨ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
    required:
      - max_retries
      - timeout_seconds
    properties:
      max_retries:
        type: integer
        description: æœ€å¤§ãƒªãƒˆãƒ©ã‚¤å›æ•°
        minimum: 0
        maximum: 10
        default: 3
        examples:
          - 3
          - 5

      initial_backoff_ms:
        type: integer
        description: åˆæœŸãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
        minimum: 10
        maximum: 5000
        default: 100
        examples:
          - 100
          - 500

      backoff_multiplier:
        type: number
        description: ãƒãƒƒã‚¯ã‚ªãƒ•ä¹—æ•°ï¼ˆæŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•ï¼‰
        minimum: 1.0
        maximum: 5.0
        default: 2.0
        examples:
          - 2.0
          - 1.5

      max_backoff_ms:
        type: integer
        description: æœ€å¤§ãƒãƒƒã‚¯ã‚ªãƒ•æ™‚é–“ï¼ˆãƒŸãƒªç§’ï¼‰
        minimum: 1000
        maximum: 60000
        default: 10000
        examples:
          - 10000
          - 30000

      timeout_seconds:
        type: integer
        description: ã‚¿ã‚¹ã‚¯å®Ÿè¡Œã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
        minimum: 10
        maximum: 3600
        default: 300
        examples:
          - 300
          - 600

  # ========================================
  # Ensembleè¨­å®šï¼ˆpaneãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
  # ========================================
  ensemble:
    type: object
    description: tmux paneã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨Agenté…ç½®
    required:
      - type
      - num_agents
    properties:
      type:
        type: string
        description: Ensembleã‚¿ã‚¤ãƒ—
        enum:
          - coding
          - hybrid
          - demo
          - custom
        default: coding
        examples:
          - coding
          - hybrid

      num_agents:
        type: integer
        description: Agentæ•°ï¼ˆConductoré™¤ãï¼‰
        minimum: 1
        maximum: 20
        examples:
          - 4
          - 6
          - 1

      layout:
        type: string
        description: tmuxãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå½¢å¼
        enum:
          - tiled
          - even-horizontal
          - even-vertical
          - main-horizontal
          - main-vertical
          - custom
        default: tiled

      custom_layout:
        type: string
        description: ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆtmux layout formatï¼‰
        pattern: "^[0-9a-f,{}\\[\\]]+$"
        examples:
          - "1a2b,159x48,0,0{79x48,0,0,1,79x48,80,0[79x23,80,0,2,79x24,80,24,3]}"

  # ========================================
  # Agentè¨­å®š
  # ========================================
  agents:
    type: array
    description: Agentå®šç¾©ãƒªã‚¹ãƒˆ
    minItems: 1
    maxItems: 21
    items:
      type: object
      required:
        - name
        - type
        - pane_id
      properties:
        name:
          type: string
          description: Agentåï¼ˆæ—¥æœ¬èªãƒ»è‹±èªã©ã¡ã‚‰ã§ã‚‚å¯ï¼‰
          minLength: 1
          maxLength: 50
          examples:
            - ã‚«ã‚¨ãƒ‡
            - ã‚µã‚¯ãƒ©
            - ãƒ„ãƒã‚­
            - ãƒœã‚¿ãƒ³
            - CodeGen
            - Review

        type:
          type: string
          description: AgentTypeï¼ˆE3ï¼‰
          enum:
            # Coding Agents
            - CoordinatorAgent
            - CodeGenAgent
            - ReviewAgent
            - IssueAgent
            - PRAgent
            - DeploymentAgent
            - RefresherAgent
            # Business Agents
            - AIEntrepreneurAgent
            - ProductConceptAgent
            - ProductDesignAgent
            - FunnelDesignAgent
            - PersonaAgent
            - SelfAnalysisAgent
            - MarketResearchAgent
            - MarketingAgent
            - ContentCreationAgent
            - SNSStrategyAgent
            - YouTubeAgent
            - SalesAgent
            - CRMAgent
            - AnalyticsAgent

        pane_id:
          type: string
          description: tmux pane IDï¼ˆ%Nå½¢å¼ï¼‰
          pattern: "^%[0-9]+$"
          examples:
            - "%1"
            - "%2"
            - "%27"

        pane_index:
          type: integer
          description: tmux pane indexï¼ˆ0å§‹ã¾ã‚Šï¼‰
          minimum: 0
          maximum: 100

        role:
          type: string
          description: å½¹å‰²èª¬æ˜
          maxLength: 200
          examples:
            - Rustã‚³ãƒ¼ãƒ‰å®Ÿè£…æ‹…å½“
            - ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“
            - PRä½œæˆæ‹…å½“
            - ãƒ‡ãƒ—ãƒ­ã‚¤æ‹…å½“

        authority:
          type: string
          description: Agentæ¨©é™ãƒ¬ãƒ™ãƒ«
          enum:
            - ğŸ”´çµ±æ‹¬æ¨©é™
            - ğŸ”µå®Ÿè¡Œæ¨©é™
            - ğŸŸ¢åˆ†ææ¨©é™
          examples:
            - ğŸ”´çµ±æ‹¬æ¨©é™
            - ğŸ”µå®Ÿè¡Œæ¨©é™

        escalation_target:
          type: string
          description: ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ
          enum:
            - TechLead
            - ProductManager
            - User
          examples:
            - TechLead

  # ========================================
  # tmuxè¨­å®š
  # ========================================
  tmux:
    type: object
    description: tmuxå›ºæœ‰ã®è¨­å®š
    properties:
      session_name:
        type: string
        description: tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³å
        minLength: 1
        maxLength: 50
        default: miyabi
        examples:
          - miyabi
          - miyabi-orchestra

      window_name:
        type: string
        description: tmuxã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å
        minLength: 1
        maxLength: 50
        default: orchestra
        examples:
          - orchestra
          - coding-ensemble

      prefix_key:
        type: string
        description: tmux prefix key
        enum:
          - C-a
          - C-b
        default: C-b
        examples:
          - C-a
          - C-b

      pane_border_status:
        type: string
        description: paneå¢ƒç•Œç·šã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
        enum:
          - "off"
          - top
          - bottom
        default: top

      pane_border_format:
        type: string
        description: paneå¢ƒç•Œç·šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        examples:
          - " ğŸ¹ #{pane_title} "
          - " [#{pane_index}] #{pane_title} "

  # ========================================
  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹è¨­å®š
  # ========================================
  metrics:
    type: object
    description: å®Ÿè¡Œãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®åé›†ã¨ä¿å­˜
    properties:
      enabled:
        type: boolean
        description: ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚’æœ‰åŠ¹åŒ–
        default: true

      output_dir:
        type: string
        description: ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
        default: .ai/logs/metrics
        examples:
          - .ai/logs/metrics
          - /tmp/miyabi-metrics

      format:
        type: string
        description: ãƒ¡ãƒˆãƒªã‚¯ã‚¹å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        enum:
          - json
          - yaml
          - csv
        default: json

      include_fields:
        type: array
        description: å‡ºåŠ›ã™ã‚‹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
        items:
          type: string
          enum:
            - start_time
            - end_time
            - duration_ms
            - retry_count
            - success
            - error_message
        default:
          - start_time
          - end_time
          - duration_ms
          - success

  # ========================================
  # ãƒ­ã‚°è¨­å®š
  # ========================================
  logging:
    type: object
    description: ãƒ­ã‚°å‡ºåŠ›è¨­å®š
    properties:
      level:
        type: string
        description: ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
        enum:
          - trace
          - debug
          - info
          - warn
          - error
        default: info

      output:
        type: string
        description: ãƒ­ã‚°å‡ºåŠ›å…ˆ
        enum:
          - stdout
          - file
          - both
        default: both

      file_path:
        type: string
        description: ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
        default: .ai/logs/orchestra.log
        examples:
          - .ai/logs/orchestra.log
          - /tmp/miyabi-orchestra.log

  # ========================================
  # å ±å‘Šãƒ—ãƒ­ãƒˆã‚³ãƒ«
  # ========================================
  reporting:
    type: object
    description: Agentã®å ±å‘Šãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­å®š
    properties:
      format:
        type: string
        description: å ±å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        examples:
          - "[{agent_name}] {message}"
          - "ğŸ­ {agent_name}: {message}"

      conductor_pane:
        type: string
        description: Conductor pane IDï¼ˆå ±å‘Šå…ˆï¼‰
        pattern: "^%[0-9]+$"
        default: "%1"
        examples:
          - "%1"

      send_delay_ms:
        type: integer
        description: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å‰ã®é…å»¶ï¼ˆãƒŸãƒªç§’ï¼‰
        minimum: 0
        maximum: 5000
        default: 100

# ========================================
# è¨­å®šä¾‹
# ========================================
examples:
  - # Coding Ensemble (5-pane)
    orchestration:
      max_retries: 3
      initial_backoff_ms: 100
      backoff_multiplier: 2.0
      max_backoff_ms: 10000
      timeout_seconds: 300

    ensemble:
      type: coding
      num_agents: 4
      layout: tiled

    agents:
      - name: ã‚«ã‚¨ãƒ‡
        type: CodeGenAgent
        pane_id: "%2"
        pane_index: 1
        role: Rustã‚³ãƒ¼ãƒ‰å®Ÿè£…æ‹…å½“
        authority: ğŸ”µå®Ÿè¡Œæ¨©é™
        escalation_target: TechLead

      - name: ã‚µã‚¯ãƒ©
        type: ReviewAgent
        pane_id: "%5"
        pane_index: 2
        role: ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“
        authority: ğŸ”µå®Ÿè¡Œæ¨©é™
        escalation_target: TechLead

      - name: ãƒ„ãƒã‚­
        type: PRAgent
        pane_id: "%3"
        pane_index: 3
        role: PRä½œæˆæ‹…å½“
        authority: ğŸ”µå®Ÿè¡Œæ¨©é™
        escalation_target: TechLead

      - name: ãƒœã‚¿ãƒ³
        type: DeploymentAgent
        pane_id: "%4"
        pane_index: 4
        role: ãƒ‡ãƒ—ãƒ­ã‚¤æ‹…å½“
        authority: ğŸ”µå®Ÿè¡Œæ¨©é™
        escalation_target: TechLead

    tmux:
      session_name: miyabi
      window_name: coding-ensemble
      prefix_key: C-a
      pane_border_status: top
      pane_border_format: " ğŸ¹ #{pane_title} "

    metrics:
      enabled: true
      output_dir: .ai/logs/metrics
      format: json

    logging:
      level: info
      output: both
      file_path: .ai/logs/orchestra.log

    reporting:
      format: "[{agent_name}] {message}"
      conductor_pane: "%1"
      send_delay_ms: 100

  - # Hybrid Ensemble (7-pane)
    orchestration:
      max_retries: 5
      timeout_seconds: 600

    ensemble:
      type: hybrid
      num_agents: 6
      layout: tiled

    agents:
      - name: CodeGen
        type: CodeGenAgent
        pane_id: "%27"

      - name: Review
        type: ReviewAgent
        pane_id: "%28"

      - name: PR
        type: PRAgent
        pane_id: "%25"

      - name: MarketResearch
        type: MarketResearchAgent
        pane_id: "%29"

      - name: Content
        type: ContentCreationAgent
        pane_id: "%30"

      - name: Analytics
        type: AnalyticsAgent
        pane_id: "%31"
