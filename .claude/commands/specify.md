# /specify - 仕様駆動開発コマンド

Issue/タスクの仕様を詳細化し、実装前に設計を固めるコマンド。

## 使用方法

```
/specify #<issue番号>
/specify <機能名>
```

## 実行フロー

### Phase 1: 要件収集

まず対象のIssue/タスクを確認し、以下の情報を収集してください：

1. **Issue内容を読む**（GitHub Issue番号が指定された場合）
   ```bash
   gh issue view <issue番号>
   ```

2. **関連コードを確認**
   - 既存の実装パターン
   - 影響を受けるファイル
   - 依存関係

### Phase 2: 仕様テンプレート作成

以下のテンプレートに沿って仕様を作成してください：

```markdown
# 仕様書: [機能名]

## 1. 概要
- **Issue**: #XXX
- **目的**: この機能が解決する問題
- **スコープ**: 実装範囲（含むもの/含まないもの）

## 2. 要件定義

### 必須要件
- [ ] 要件1: 具体的な説明
- [ ] 要件2: 具体的な説明

### オプション要件
- [ ] 要件3: 将来的に追加可能

## 3. インターフェース設計

### 入力
| パラメータ | 型 | 必須 | 説明 | 例 |
|-----------|---|------|------|---|
| param1 | String | Yes | 説明 | "example" |

### 出力
| フィールド | 型 | 説明 |
|-----------|---|------|
| result | T | 正常時の戻り値 |
| error | Error | エラー時の詳細 |

## 4. エッジケース

| ケース | 入力例 | 期待動作 |
|--------|--------|---------|
| 空入力 | "" | 400 Bad Request |
| 不正形式 | "abc" | 422 Validation Error |
| 権限なし | - | 403 Forbidden |

## 5. 技術設計

### 使用技術
- 言語: Rust 2021 Edition
- フレームワーク: axum
- パターン: Repository Pattern

### ファイル構成
```
src/
├── handlers/
│   └── new_handler.rs  # 新規作成
├── services/
│   └── new_service.rs  # 新規作成
└── models/
    └── new_model.rs    # 新規作成
```

### 依存関係
- 新規追加: なし / あり（crate名）
- 既存利用: serde, tokio

## 6. テスト計画

### ユニットテスト
- [ ] 正常系: 基本動作
- [ ] 異常系: エラーハンドリング
- [ ] 境界値: 上限/下限

### 統合テスト
- [ ] E2E: API全体の動作確認

## 7. タスク分解

| # | タスク | 見積 | 依存 |
|---|--------|------|------|
| 1 | モデル定義 | 15min | - |
| 2 | サービス実装 | 30min | 1 |
| 3 | ハンドラー実装 | 20min | 2 |
| 4 | テスト追加 | 20min | 3 |
| 5 | ドキュメント更新 | 10min | 4 |

## 8. レビューチェックリスト

- [ ] 全必須要件を満たしている
- [ ] エッジケースが処理されている
- [ ] 不要なコードがない
- [ ] テストカバレッジ80%以上
- [ ] cargo clippy警告なし
```

### Phase 3: 確認と承認

仕様書を作成したら、ユーザーに確認を求めてください：

1. 仕様の内容を要約して提示
2. 不明点や追加要件がないか確認
3. 承認を得てから実装フェーズへ

### Phase 4: 実装準備

承認後、TodoWriteを使用してタスクを登録：

```
[
  {"content": "モデル定義作成", "status": "pending", "activeForm": "モデル定義を作成中"},
  {"content": "サービス実装", "status": "pending", "activeForm": "サービスを実装中"},
  ...
]
```

## 禁止事項

- 仕様確定前にコード生成を開始しない
- 「とりあえず動く」実装をしない
- 仕様に書かれていない機能を追加しない
- 過剰な抽象化・将来拡張を先取りしない

## 成功基準

- 仕様カバー率: 100%
- 実装後のレビュー指摘: 設計変更0件
- ReviewAgentスコア: 80点以上

---

**Remember**: 仕様が先、コードは後
