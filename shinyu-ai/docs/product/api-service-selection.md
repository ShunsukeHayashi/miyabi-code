# API/サービス選定リスト

**プロジェクト**: 統合占いアプリ（新湯 AI）
**作成日**: 2025-10-25
**バージョン**: 1.0.0

---

## 占いAPI選定

### 1. 西洋占星術API

#### 選定: **AstrologyAPI**

**公式サイト**: https://www.astrologyapi.com/

**選定理由**:
1. **正確性**: Swiss Ephemeris使用（天文計算の業界標準）
2. **機能網羅性**: 出生図、トランジット、プログレス、シナストリー対応
3. **API品質**: RESTful、JSON形式、レスポンス速度<500ms
4. **ドキュメント**: 充実（サンプルコード、Postman Collection提供）
5. **サポート**: メール対応（24時間以内）

**価格体系**:
| プラン | 月額 | リクエスト数 | 1リクエスト単価 |
|--------|------|-------------|----------------|
| Basic | $39 | 1,000 | $0.039 |
| Standard | $79 | 5,000 | $0.016 |
| Professional | $149 | 15,000 | $0.010 |
| Enterprise | カスタム | 無制限 | 要相談 |

**MVP選定**: **Basic（$39/月）**
- 初期ユーザー50人想定、1人2-3回実行 → 月150リクエスト程度
- 余裕を持って1,000リクエスト/月で十分

**Phase 2移行**: **Standard（$79/月）**
- ユーザー100人、月500リクエスト想定

**Phase 3以降**: **Professional（$149/月）**
- ユーザー1,000人、月3,000リクエスト想定

---

**主要エンドポイント**:

#### 1. Western Horoscope（出生図）
```
POST https://api.astrologyapi.com/v1/western_horoscope
```

**リクエスト例**:
```json
{
  "day": 15,
  "month": 3,
  "year": 1990,
  "hour": 14,
  "min": 30,
  "lat": 35.6762,
  "lon": 139.6503,
  "tzone": 9.0
}
```

**レスポンス例**:
```json
{
  "sun_sign": "Pisces",
  "moon_sign": "Cancer",
  "ascendant": "Gemini",
  "planets": [
    {
      "name": "Sun",
      "sign": "Pisces",
      "degree": 24.5,
      "house": 10,
      "retrograde": false
    },
    {
      "name": "Moon",
      "sign": "Cancer",
      "degree": 12.3,
      "house": 2,
      "retrograde": false
    }
  ]
}
```

---

#### 2. Planet Positions（惑星配置）
```
POST https://api.astrologyapi.com/v1/planet_positions
```

**用途**: 詳細な惑星配置分析（Phase 3で使用）

---

#### 3. Transit（トランジット）
```
POST https://api.astrologyapi.com/v1/transit
```

**用途**: 時系列分析（過去・未来の運勢）

---

**代替案との比較**:

| サービス | 価格 | 精度 | 機能 | ドキュメント | 判定 |
|---------|------|------|------|-------------|------|
| **AstrologyAPI** | $39/月 | ◎ | ◎ | ◎ | **採用** |
| Astro-Charts API | $29/月 | ○ | ○ | △ | 不採用 |
| Vedic Rishi API | $49/月 | ◎ | △（インド占星術） | ○ | 不採用 |
| 独自実装（swiss-ephemeris） | 無料 | ◎ | △ | △ | Phase 3検討 |

**不採用理由**:
- **Astro-Charts API**: ドキュメント不足、サポート不明
- **Vedic Rishi API**: インド占星術メイン（西洋占星術は限定的）
- **独自実装**: 実装コスト高（2-3週間必要）、保守リスク

---

### 2. 動物占いAPI

#### 選定: **独自実装**

**選定理由**:
1. **シンプルなロジック**: 誕生日からの計算式（1日で実装可能）
2. **コスト削減**: API費用不要
3. **カスタマイズ性**: 日本独自の動物占いに対応

**実装方法**: TypeScriptでスクラッチ実装

**参考資料**:
- 動物占い公式サイト: https://www.doubutsu-uranai.com/
- Wikipediaの動物占い解説

**データソース**: JSON形式で性格特性を管理

---

### 3. 数秘術API

#### 選定: **独自実装**

**選定理由**:
1. **計算式が標準化**: ピタゴラス式数秘術は公開済み
2. **低コスト**: API費用不要
3. **高速**: ローカル計算で<10ms

**実装方法**: TypeScriptでスクラッチ実装

**参考ライブラリ**: `numerology-calculator`（npm）
- ライセンス: MIT
- 使用例: https://www.npmjs.com/package/numerology-calculator

**代替案**: Numerology API（$19/月）
- 判定: **不採用**（実装が簡単なため、コスト削減優先）

---

### 4. 兄弟構成診断

#### 選定: **独自実装**

**選定理由**:
1. **学術的根拠**: アドラー心理学の出生順位理論
2. **API不存在**: 該当するAPIがない
3. **カスタマイズ性**: 日本の家族構造に適応

**参考文献**:
- 『The Birth Order Book』Kevin Leman著
- アドラー心理学の論文

**データソース**: JSON形式で性格特性を管理

---

## AI画像生成API選定

### 選定: **OpenAI DALL-E 3**

**公式サイト**: https://platform.openai.com/docs/guides/images

**選定理由**:
1. **品質**: 高精細（1024x1024、1024x1792、1792x1024）
2. **API統合**: OpenAI SDK（TypeScript対応）
3. **速度**: 10-20秒/枚
4. **プロンプト理解**: 自然言語で細かい指示可能

**価格**:
| サイズ | 品質 | 価格/枚 |
|--------|------|---------|
| 1024x1024 | Standard | $0.040 |
| 1024x1024 | HD | $0.080 |
| 1024x1792 | Standard | $0.080 |

**MVP選定**: **1024x1024 Standard（$0.040/枚）**

**月間コスト試算**:
- ユーザー50人 × 3枚（動物、野菜、椎茸） = 150枚
- 150枚 × $0.040 = **$6/月（¥900）**

**Phase 2試算**:
- ユーザー100人 × 3枚 = 300枚
- キャッシュ活用（同一動物+色は再利用） → 実質150枚
- 150枚 × $0.040 = **$6/月（¥900）**

**Phase 3試算**:
- ユーザー1,000人 × 3枚 = 3,000枚
- キャッシュ活用（再利用率70%） → 実質900枚
- 900枚 × $0.040 = **$36/月（¥5,400）**

---

**主要エンドポイント**:

#### Image Generation
```
POST https://api.openai.com/v1/images/generations
```

**リクエスト例**:
```json
{
  "model": "dall-e-3",
  "prompt": "A cute golden wolf character in Japanese anime style, with mystical fortune-telling elements like stars and moons in the background. The character should look friendly and magical.",
  "n": 1,
  "size": "1024x1024",
  "quality": "standard"
}
```

**レスポンス例**:
```json
{
  "created": 1696464000,
  "data": [
    {
      "url": "https://oaidalleapiprodscus.blob.core.windows.net/private/..."
    }
  ]
}
```

---

**代替案との比較**:

| サービス | 価格 | 品質 | 速度 | API提供 | 判定 |
|---------|------|------|------|---------|------|
| **DALL-E 3** | $0.04/枚 | ◎ | ○（10-20秒） | ◎ | **採用** |
| Stable Diffusion（自前） | 無料 | ○ | △（GPU必要） | △ | 不採用 |
| Midjourney | $10/月 | ◎ | ○ | ❌ | 不採用 |
| Leonardo.ai | $12/月 | ○ | ○ | ○ | 検討中 |

**不採用理由**:
- **Stable Diffusion**: GPU費用（AWS EC2 g4dn.xlarge $0.526/h = $378/月）が高額
- **Midjourney**: API未提供（Discord Bot経由のみ）
- **Leonardo.ai**: Phase 3で検討（コスト削減目的）

---

## AI言語モデルAPI選定

### 選定: **OpenAI GPT-4o-mini**

**公式サイト**: https://platform.openai.com/docs/models/gpt-4o-mini

**選定理由**:
1. **コスパ**: GPT-4o比で15倍安い
2. **速度**: レスポンス<2秒
3. **品質**: ユーモア占い生成に十分な精度
4. **API統合**: DALL-E 3と同一SDK

**価格**:
| モデル | 入力（1Mトークン） | 出力（1Mトークン） |
|--------|-------------------|-------------------|
| GPT-4o-mini | $0.150 | $0.600 |
| GPT-4o | $2.50 | $10.00 |

**MVP試算**:
- ユーザー50人 × 3占い（野菜、椎茸、妖怪）= 150リクエスト
- 平均入力: 200トークン、出力: 150トークン
- 入力コスト: 150リクエスト × 200トークン × $0.15/1M = **$0.0045**
- 出力コスト: 150リクエスト × 150トークン × $0.60/1M = **$0.0135**
- **合計**: **$0.018/月（¥2.7）**

**Phase 3試算**:
- ユーザー1,000人 → **$0.36/月（¥54）**

---

**主要エンドポイント**:

#### Chat Completions
```
POST https://api.openai.com/v1/chat/completions
```

**リクエスト例**:
```json
{
  "model": "gpt-4o-mini",
  "messages": [
    {
      "role": "user",
      "content": "あなたは占い師です。以下のプロフィールから、野菜占いを生成してください。\n\nプロフィール:\n- 誕生日: 1990年3月15日\n- 名前: 山田太郎\n- 星座: うお座\n- 動物占い: ゴールドの狼\n\nユーモアを交えた野菜占いを200文字以内で生成してください。"
    }
  ],
  "max_tokens": 300
}
```

**レスポンス例**:
```json
{
  "choices": [
    {
      "message": {
        "role": "assistant",
        "content": "あなたは「神秘的なアスパラガス」です。うお座の繊細さとゴールドの狼の鋭さを併せ持ち、周囲からは「高級野菜」として一目置かれています。ただし、時々「茹ですぎ注意」な一面も。感受性が強すぎて疲れやすいので、適度にリラックスを。"
      }
    }
  ]
}
```

---

**用途別モデル選定**:

| 用途 | モデル | 理由 |
|------|--------|------|
| ユーモア占い生成 | GPT-4o-mini | コスパ重視 |
| 統合プロファイル生成 | GPT-4o | 高精度必要 |
| AIアドバイザーチャット | GPT-4o-mini | 会話速度優先 |

---

## バックエンドサービス選定

### 選定: **Supabase**

**公式サイト**: https://supabase.com/

**選定理由**:
1. **オールインワン**: DB、認証、ストレージ、Edge Functions統合
2. **PostgreSQL**: リレーショナルDB（占い結果の複雑なクエリに対応）
3. **無料枠**: Free tier（50,000 MAU、500MB DB、1GB storage）
4. **TypeScript統合**: フルスタックTypeScript実現
5. **Row Level Security**: データ保護自動化

**価格体系**:
| プラン | 月額 | DB容量 | Storage | Edge Functions | 帯域幅 |
|--------|------|--------|---------|----------------|--------|
| Free | $0 | 500MB | 1GB | 500K req/月 | 5GB |
| Pro | $25 | 8GB | 100GB | 2M req/月 | 50GB |
| Team | $599 | 制限なし | 200GB | 5M req/月 | 250GB |

**MVP選定**: **Free**
- ユーザー50人、DB使用量<100MB
- 画像ストレージ<500MB（キャッシュ活用）

**Phase 2移行**: **Pro（$25/月）**
- ユーザー100人超過時

---

**代替案との比較**:

| サービス | 価格（MVP） | TypeScript統合 | 学習コスト | 判定 |
|---------|------------|---------------|----------|------|
| **Supabase** | 無料 | ◎ | 低 | **採用** |
| Firebase | 無料 | ○ | 低 | 不採用 |
| AWS Amplify | 無料 | ○ | 高 | 不採用 |
| 独自API（NestJS） | $20/月 | ◎ | 高 | Phase 3検討 |

**不採用理由**:
- **Firebase**: NoSQL（複雑なクエリ困難）
- **AWS Amplify**: 学習コスト高、設定複雑
- **独自API**: 開発期間2-3週間必要（MVP期間不足）

---

## ホスティングサービス選定

### 選定: **Vercel**

**公式サイト**: https://vercel.com/

**選定理由**:
1. **Next.js最適化**: ゼロコンフィグデプロイ
2. **無料枠**: Hobby（100GB bandwidth/月）
3. **CDN**: 世界中にエッジノード（日本含む）
4. **GitHub連携**: 自動デプロイ

**価格体系**:
| プラン | 月額 | Bandwidth | ビルド時間 | チーム人数 |
|--------|------|-----------|-----------|----------|
| Hobby | $0 | 100GB | 6,000分/月 | 1人 |
| Pro | $20 | 1TB | 24,000分/月 | 無制限 |

**MVP選定**: **Hobby**

**Phase 2移行**: **Pro（$20/月）**
- トラフィック増加時（100GB超過）

---

**代替案との比較**:

| サービス | 価格 | Next.js最適化 | デプロイ速度 | 判定 |
|---------|------|--------------|------------|------|
| **Vercel** | 無料 | ◎ | ◎ | **採用** |
| Netlify | 無料 | ○ | ○ | 不採用 |
| AWS Amplify | 無料 | △ | △ | 不採用 |
| Cloudflare Pages | 無料 | ○ | ○ | Phase 3検討 |

---

## 決済サービス選定

### 選定: **Stripe**

**公式サイト**: https://stripe.com/jp

**選定理由**:
1. **日本対応**: 日本円決済、日本語ドキュメント
2. **サブスクリプション**: 定期課金対応
3. **API品質**: TypeScript SDK、Webhook充実
4. **手数料**: 3.6%（業界標準）

**価格**:
- **手数料**: 3.6%（クレジットカード）
- **月額費用**: 無料（従量課金のみ）

**Phase 4導入**（有料化時）

---

**代替案との比較**:

| サービス | 手数料 | サブスク対応 | 開発容易性 | 判定 |
|---------|--------|-------------|-----------|------|
| **Stripe** | 3.6% | ◎ | ◎ | **採用** |
| PayPal | 3.6% + 40円 | ○ | ○ | 不採用 |
| Square | 3.6% | ○ | ○ | 不採用 |

---

## 分析・監視サービス選定

### 1. アクセス解析

#### 選定: **Google Analytics 4（GA4）**

**選定理由**:
1. **無料**
2. **業界標準**
3. **イベントトラッキング充実**

**価格**: 無料

---

### 2. エラー監視

#### 選定: **Sentry**

**公式サイト**: https://sentry.io/

**選定理由**:
1. **無料枠**: 5,000イベント/月
2. **Next.js統合**: 公式SDK提供
3. **ソースマップ対応**: 本番エラーのデバッグ容易

**価格**:
| プラン | 月額 | イベント数 |
|--------|------|-----------|
| Developer | $0 | 5,000 |
| Team | $26 | 50,000 |

**MVP選定**: **Developer（無料）**

---

### 3. パフォーマンス監視

#### 選定: **Vercel Analytics**

**選定理由**:
1. **Vercel統合**: 追加設定不要
2. **Core Web Vitals**: 自動計測
3. **無料**

**価格**: 無料（Vercel Hobbyプランに含む）

---

## 総コスト試算（月額）

### MVP期間（Month 1）

| サービス | プラン | 月額 |
|---------|--------|------|
| Vercel | Hobby | $0 |
| Supabase | Free | $0 |
| AstrologyAPI | Basic | $39 |
| OpenAI（DALL-E 3） | 従量課金 | $6（¥900） |
| OpenAI（GPT-4o-mini） | 従量課金 | $0.02（¥3） |
| ドメイン（お名前.com） | .com | ¥1,500/年（¥125/月） |
| GA4 | - | $0 |
| Sentry | Developer | $0 |
| **合計** | - | **$45（¥6,750）** |

---

### Phase 2（Month 2-3）

| サービス | プラン | 月額 |
|---------|--------|------|
| Vercel | Hobby | $0 |
| Supabase | Pro | $25 |
| AstrologyAPI | Standard | $79 |
| OpenAI（DALL-E 3） | 従量課金 | $6（¥900） |
| OpenAI（GPT-4o-mini） | 従量課金 | $0.36（¥54） |
| ドメイン | .com | ¥125 |
| **合計** | - | **$110（¥16,500）** |

---

### Phase 3（Month 4-6）

| サービス | プラン | 月額 |
|---------|--------|------|
| Vercel | Pro | $20 |
| Supabase | Pro | $25 |
| AstrologyAPI | Professional | $149 |
| OpenAI（DALL-E 3） | 従量課金 | $36（¥5,400） |
| OpenAI（GPT-4o-mini） | 従量課金 | $0.36（¥54） |
| Stripe | 従量課金 | 収益の3.6% |
| ドメイン | .com | ¥125 |
| Redis（Upstash） | Pay as you go | $10 |
| **合計（固定費）** | - | **$240（¥36,000）** |

---

## 改訂履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0.0 | 2025-10-25 | 初版作成 |

---

**関連ドキュメント**:
- [技術スタック完全仕様書](./tech-stack.md)
- [MVP定義書](./mvp-definition.md)
