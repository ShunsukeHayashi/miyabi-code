# 🎯 Miyabi Layer 1 Human Interface Design
# Lark Communication UI/UX Specification

**Version**: 2.0.0  
**Status**: Production Ready  
**Last Updated**: 2025-11-21

---

## 📋 設計原則

### 1. 即時フィードバック原則
ユーザーが何かをリクエストしたら、**即座に応答**する。
- 0-3秒以内: 「受け付けました」
- 処理完了時: 結果報告

### 2. インテント中心設計
ユーザーの**意図（Intent）**を理解し、それに対する適切な完了報告を行う。
- 「状態を知りたい」→ 状態を報告
- 「ビルドして」→ ビルド結果を報告
- 「Issue確認して」→ Issue内容を報告

### 3. 会話的インタラクション
コマンドライン風ではなく、**自然な会話**のようなやり取り。
- ❌ `/miyabi status` → `OK`
- ✅ 「状態確認して」→ 「確認します...」→ 「現在の状態: ブランチmain、60クレート、5件のIssueがあります」

---

## 🔄 3ステップ通信フロー

```
┌─────────────────────────────────────────────────────────────┐
│  Step 1: 即時ACK (0-3秒)                                    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ✅ [コマンド名] を受け付けました                       │   │
│  │ 🔄 [処理内容の簡潔な説明] 中...                       │   │
│  │ ⏱️ 予想時間: [X秒/分]                                │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  Step 2: 処理実行 (バックグラウンド)                         │
│  - miyabi-orchestrator内で実際のタスク実行                  │
│  - 必要に応じて進捗更新（長時間タスクの場合）                 │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  Step 3: 完了報告                                           │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [結果アイコン] [タスク名] 完了                         │   │
│  │                                                      │   │
│  │ [ユーザーのインテントに対する適切な結果]               │   │
│  │                                                      │   │
│  │ 📍 [タイムスタンプ] | ⏱️ 所要時間: [X秒]              │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

---

## 📝 メッセージテンプレート

### Step 1: 即時ACK テンプレート

```
✅ {command} を受け付けました

🔄 {action_description}...
⏱️ 予想時間: {estimated_time}
```

**例:**
```
✅ status を受け付けました

🔄 システム状態を確認しています...
⏱️ 予想時間: 5-10秒
```

### Step 3: 完了報告テンプレート

#### 成功時
```
{result_icon} {task_name} 完了

{result_content}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
✅ ステータス: 成功
```

#### 失敗時
```
❌ {task_name} 失敗

{error_description}

🔧 推奨アクション:
{recommended_actions}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
❌ ステータス: 失敗
```

---

## 🎨 アイコン・絵文字規則

### 状態アイコン
| アイコン | 意味 |
|---------|------|
| ✅ | 成功・完了・受付 |
| ❌ | 失敗・エラー |
| 🔄 | 処理中・進行中 |
| ⏳ | 待機中 |
| ⚠️ | 警告 |
| 🚨 | 緊急・重大 |

### カテゴリアイコン
| アイコン | カテゴリ |
|---------|---------|
| 📊 | ステータス・レポート |
| 🔨 | ビルド |
| 🧪 | テスト |
| 🚀 | デプロイ |
| 🎫 | Issue |
| 🔀 | PR（プルリクエスト） |
| 📁 | ファイル・プロジェクト |
| ⚙️ | 設定 |
| 🔍 | 検索・調査 |

### 優先度アイコン
| アイコン | 優先度 |
|---------|--------|
| 🔴 | 緊急 |
| 🟠 | 高 |
| 🟡 | 中 |
| 🟢 | 低 |
| ⚪ | 情報のみ |

---

## 📋 コマンド一覧と応答設計

### /miyabi status (または「状態」「ステータス」)

**Intent**: システムの現在状態を知りたい

**Step 1 ACK:**
```
✅ status を受け付けました

🔄 システム状態を確認しています...
⏱️ 予想時間: 5-10秒
```

**Step 3 完了報告:**
```
📊 システム状態レポート

📁 プロジェクト
• ブランチ: {branch}
• 最新コミット: {commit_hash} - {commit_message}

📦 コンポーネント
• Rust Crates: {crate_count}個
• MCP Servers: {mcp_count}個
• 未コミット変更: {uncommitted_count}ファイル

🎫 オープンIssue: {issue_count}件
{top_issues}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
✅ ステータス: 正常
```

### /miyabi build (または「ビルド」「ビルドして」)

**Intent**: プロジェクトをビルドしたい

**Step 1 ACK:**
```
✅ build を受け付けました

🔄 ビルドを開始します...
⏱️ 予想時間: 1-5分
```

**Step 3 完了報告 (成功):**
```
🔨 ビルド完了

✅ 結果: 成功
📦 ビルド成果物: {artifact_info}
⚠️ 警告: {warning_count}件

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
✅ ステータス: 成功
```

**Step 3 完了報告 (失敗):**
```
🔨 ビルド失敗

❌ エラー: {error_summary}

📄 詳細:
{error_details}

🔧 推奨アクション:
• {action_1}
• {action_2}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
❌ ステータス: 失敗
```

### /miyabi test (または「テスト」「テスト実行」)

**Intent**: テストを実行したい

**Step 1 ACK:**
```
✅ test を受け付けました

🔄 テストを実行しています...
⏱️ 予想時間: 2-10分
```

**Step 3 完了報告:**
```
🧪 テスト完了

📊 結果サマリー
• 合計: {total}件
• 成功: {passed}件 ✅
• 失敗: {failed}件 ❌
• スキップ: {skipped}件 ⏭️

{failed_test_details if any}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
{status_icon} ステータス: {status}
```

### /miyabi issue {number} (または「Issue #XXX 確認」)

**Intent**: 特定のIssueの詳細を知りたい

**Step 1 ACK:**
```
✅ Issue #{number} の確認を受け付けました

🔄 Issue情報を取得しています...
⏱️ 予想時間: 3-5秒
```

**Step 3 完了報告:**
```
🎫 Issue #{number}

📋 {title}

📝 説明:
{body_summary}

👤 作成者: {author}
🏷️ ラベル: {labels}
📅 作成日: {created_at}
📊 状態: {state}

🔗 リンク: {url}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
```

### /miyabi deploy (または「デプロイ」)

**Intent**: デプロイを実行したい

**Step 1 ACK:**
```
✅ deploy を受け付けました

🔄 デプロイの準備を開始します...
⏱️ 予想時間: 5-15分

⚠️ 本番環境への影響があります
```

**Step 2 進捗更新 (長時間タスク):**
```
🚀 デプロイ進捗

📊 現在のステップ: {current_step}/{total_steps}
🔄 {current_action}

⏱️ 経過時間: {elapsed}
```

**Step 3 完了報告:**
```
🚀 デプロイ完了

✅ 環境: {environment}
📦 バージョン: {version}
🔗 URL: {deployed_url}

📊 デプロイサマリー
• 変更ファイル: {changed_files}件
• 新機能: {features}
• バグ修正: {fixes}

━━━━━━━━━━━━━━━━━━━━
📍 {timestamp}
⏱️ 所要時間: {duration}
✅ ステータス: 成功
```

---

## 🗣️ 自然言語対応

### 対応する自然言語パターン

| パターン | マッピング先 |
|---------|-------------|
| 「状態」「ステータス」「今どうなってる」 | /miyabi status |
| 「ビルド」「ビルドして」「コンパイル」 | /miyabi build |
| 「テスト」「テスト実行」「テストして」 | /miyabi test |
| 「Issue XXX」「#XXX 見せて」「チケットXXX」 | /miyabi issue XXX |
| 「デプロイ」「本番反映」「リリース」 | /miyabi deploy |
| 「PR XXX」「プルリク XXX」 | /miyabi pr XXX |
| 「ログ」「ログ見せて」 | /miyabi logs |
| 「ヘルプ」「使い方」「何ができる」 | /miyabi help |

---

## 🚨 エラーハンドリング

### 認識できないコマンド
```
❓ コマンドを認識できませんでした

受信内容: "{user_input}"

💡 利用可能なコマンド:
• status - システム状態確認
• build - ビルド実行
• test - テスト実行
• issue {#} - Issue確認
• deploy - デプロイ

📝 例: 「状態確認して」「Issue #1050 見せて」
```

### タイムアウト
```
⏱️ タイムアウト

{task_name} の処理が予想時間を超えました。

🔄 現在の状態: {current_state}
⏱️ 経過時間: {elapsed}

選択肢:
1. 継続して待つ
2. キャンセル → 「キャンセル」と送信
```

### システムエラー
```
🚨 システムエラー

{task_name} の処理中にエラーが発生しました。

❌ エラー: {error_type}
📄 詳細: {error_message}

🔧 自動的に再試行します...
または「再試行」「キャンセル」と送信
```

---

## 📊 パフォーマンス目標

| メトリクス | 目標値 |
|-----------|--------|
| Step 1 ACK 応答時間 | < 3秒 |
| ポーリング間隔 | 10秒 |
| メッセージ認識率 | > 95% |
| 完了報告の正確性 | 100% |
| エラーハンドリング率 | 100% |

---

## 🔐 セキュリティ考慮

1. **認証済みユーザーのみ**: Larkグループメンバーのみがコマンド実行可能
2. **破壊的操作の確認**: deploy, delete等は確認ステップを追加
3. **監査ログ**: 全コマンドとその結果をログに記録
4. **レート制限**: 連続コマンドの制限（10秒に1コマンド）

---

## 📈 将来の拡張

1. **リアクションベース確認**: 👍で承認、👎でキャンセル
2. **スレッド返信**: 長い報告はスレッドで返信
3. **インタラクティブカード**: ボタン付きカードでアクション選択
4. **音声入力対応**: 音声メッセージの認識
5. **スケジュール機能**: 「明日の朝にビルドして」

---

**Document Version**: 2.0.0  
**Created**: 2025-11-21  
**Author**: Miyabi Command Center
