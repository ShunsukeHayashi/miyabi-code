# Planned GitHub Issues - 2026-01-09

Generated by Claude Code Session on branch `claude/start-project-setup-xgXLW`

---

## Issue 1: Discord MCP Server - Complete Core Methods

**Priority**: P1 - High
**Type**: feat
**Labels**: `âœ¨ type:feature`, `ðŸ¤– agent:CodeGenAgent`, `ðŸ“Š impact:Medium`
**Estimated Duration**: 4-6 hours

### Title
feat(discord-mcp): Complete Discord MCP Server core methods implementation

### Description
The Discord MCP Server has several unimplemented methods that need to be completed for full functionality.

**Current State:**
- `crates/miyabi-discord-mcp-server/src/discord/` contains stub implementations
- Methods return `todo!()` or empty responses

**Files to Update:**
- `src/discord/channel.rs` - 5 methods
- `src/discord/message.rs` - 6 methods
- `src/discord/role.rs` - 2 methods
- `src/rpc/handler.rs` - Rate limit handling

### Tasks
- [ ] Implement `create_channel`, `delete_channel`, `update_channel`, `get_channels`, `get_channel`
- [ ] Implement `send_message`, `edit_message`, `delete_message`, `get_messages`, `react_message`, `pin_message`
- [ ] Implement `create_role`, `assign_role`
- [ ] Add proper rate limit tracking
- [ ] Add unit tests for each method

### References
- `crates/miyabi-discord-mcp-server/src/discord/channel.rs:10-47`
- `crates/miyabi-discord-mcp-server/src/discord/message.rs:10-70`

---

## Issue 2: Web API - Implement Token Blacklist

**Priority**: P1 - High
**Type**: feat
**Labels**: `ðŸ”’ security`, `âœ¨ type:feature`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 2-3 hours

### Title
feat(web-api): Implement token blacklist for secure logout

### Description
The authentication system currently lacks token blacklist functionality, which is needed for secure session management.

**Current State:**
- `src/routes/auth.rs:362` - TODO comment for token blacklist
- `tests/unit_auth.rs:296` - TODO for Redis-based blacklist

**Implementation Plan:**
1. Create `TokenBlacklist` trait
2. Implement in-memory version for development
3. Implement Redis version for production
4. Integrate with logout endpoint

### Tasks
- [ ] Define `TokenBlacklist` trait in `src/services/`
- [ ] Create `MemoryTokenBlacklist` implementation
- [ ] Create `RedisTokenBlacklist` implementation
- [ ] Update `/auth/logout` endpoint
- [ ] Add middleware to check blacklist
- [ ] Add tests

### References
- `crates/miyabi-web-api/src/routes/auth.rs:207,362`

---

## Issue 3: Web API - Stripe Billing Integration

**Priority**: P2 - Medium
**Type**: feat
**Labels**: `âœ¨ type:feature`, `ðŸ’° billing`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 6-8 hours

### Title
feat(billing): Complete Stripe checkout and subscription management

### Description
Billing routes have placeholder implementations that need to be connected to Stripe API.

**Current State:**
- `src/routes/billing.rs:271-277` - Checkout session creation is mocked
- `src/routes/billing.rs:431` - Subscription cancellation is mocked

### Tasks
- [ ] Add `stripe-rust` crate dependency
- [ ] Implement `create_checkout_session` with actual Stripe API
- [ ] Implement `cancel_subscription`
- [ ] Add webhook handler for Stripe events
- [ ] Add subscription status sync
- [ ] Add comprehensive tests with Stripe test mode

### References
- `crates/miyabi-web-api/src/routes/billing.rs:271-431`

---

## Issue 4: Repository Service - GitHub API Integration

**Priority**: P2 - Medium
**Type**: feat
**Labels**: `âœ¨ type:feature`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 3-4 hours

### Title
feat(repository): Integrate GitHub API for repository statistics

### Description
Repository service returns hardcoded values for `open_issues` and `open_prs` counters.

**Current State:**
- `src/services/repository_service.rs:257-258` - Returns 0 for both counts

### Tasks
- [ ] Add octocrab client to repository service
- [ ] Implement `fetch_repository_stats` method
- [ ] Add caching layer for API rate limiting
- [ ] Update repository list endpoint
- [ ] Add tests with mocked GitHub API

### References
- `crates/miyabi-web-api/src/services/repository_service.rs:257-258`

---

## Issue 5: Agent Execution Integration

**Priority**: P1 - High
**Type**: feat
**Labels**: `âœ¨ type:feature`, `ðŸ¤– agent:CodeGenAgent`, `ðŸ“Š impact:High`
**Estimated Duration**: 8-10 hours

### Title
feat(agents): Implement actual agent execution in API routes

### Description
Multiple API endpoints have placeholder agent execution that needs real implementation.

**Current State:**
- `src/routes/agents.rs:526` - Agent execution is mocked
- `src/routes/codegen.rs:142` - CodeGenAgent execution is mocked
- `src/routes/telegram.rs:578` - Agent execution is mocked

### Tasks
- [ ] Create `AgentExecutor` service
- [ ] Integrate with A2ABridge for agent invocation
- [ ] Add async task queue for long-running agents
- [ ] Implement progress tracking
- [ ] Add WebSocket notifications for agent status
- [ ] Add comprehensive integration tests

### References
- `crates/miyabi-web-api/src/routes/agents.rs:526`
- `crates/miyabi-web-api/src/routes/codegen.rs:142`

---

## Issue 6: tmux Route Enhancements

**Priority**: P3 - Low
**Type**: enhancement
**Labels**: `ðŸ”§ type:refactor`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 2-3 hours

### Title
refactor(tmux): Add session metadata and agent mapping

### Description
tmux routes lack proper metadata parsing and agent-to-pane mapping.

**Current State:**
- `src/routes/tmux.rs:189-190` - `created_at` and `attached` not parsed
- `src/routes/tmux.rs:295` - Agent mapping not implemented

### Tasks
- [ ] Parse tmux session creation time
- [ ] Detect session attachment status
- [ ] Implement agent-to-pane mapping from conductor timeline
- [ ] Add session health check endpoint
- [ ] Add tests

### References
- `crates/miyabi-web-api/src/routes/tmux.rs:189-295`

---

## Issue 7: DAG Topological Sort Optimization

**Priority**: P3 - Low
**Type**: perf
**Labels**: `âš¡ type:performance`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 1-2 hours

### Title
perf(dag): Optimize topological sort with task-to-level map

### Description
The DAG topological sort implementation has a TODO for optimization.

**Current State:**
- `src/topological.rs:131` - TODO comment for optimization

### Tasks
- [ ] Add task-to-level HashMap cache
- [ ] Optimize level lookup in parallel execution
- [ ] Add benchmarks
- [ ] Verify correctness with property tests

### References
- `crates/miyabi-dag/src/topological.rs:131`

---

## Issue 8: Five Worlds Merge Logic

**Priority**: P2 - Medium
**Type**: feat
**Labels**: `âœ¨ type:feature`, `ðŸ¤– agent:CodeGenAgent`
**Estimated Duration**: 4-5 hours

### Title
feat(worktree): Implement Five Worlds merge logic

### Description
The Five Worlds worktree implementation has placeholder merge logic.

**Current State:**
- `src/five_worlds.rs:425` - Merge logic returns placeholder

### Tasks
- [ ] Design merge strategy for parallel worktrees
- [ ] Implement conflict detection
- [ ] Implement automatic merge for non-conflicting changes
- [ ] Add manual conflict resolution API
- [ ] Add integration tests

### References
- `crates/miyabi-worktree/src/five_worlds.rs:425`

---

## Summary Table

| # | Title | Priority | Estimated | Type |
|---|-------|----------|-----------|------|
| 1 | Discord MCP Server Methods | P1 | 4-6h | feat |
| 2 | Token Blacklist | P1 | 2-3h | feat |
| 3 | Stripe Billing | P2 | 6-8h | feat |
| 4 | Repository GitHub API | P2 | 3-4h | feat |
| 5 | Agent Execution | P1 | 8-10h | feat |
| 6 | tmux Enhancements | P3 | 2-3h | enhancement |
| 7 | DAG Optimization | P3 | 1-2h | perf |
| 8 | Five Worlds Merge | P2 | 4-5h | feat |

**Total Estimated**: 30-41 hours

---

## Quick Create Commands

When GitHub CLI is available, use these commands:

```bash
# Issue 1
gh issue create --title "feat(discord-mcp): Complete Discord MCP Server core methods" \
  --body-file ISSUES/issue-1-discord-mcp.md \
  --label "âœ¨ type:feature" --label "ðŸ“Š impact:Medium"

# Issue 2
gh issue create --title "feat(web-api): Implement token blacklist for secure logout" \
  --body-file ISSUES/issue-2-token-blacklist.md \
  --label "ðŸ”’ security" --label "âœ¨ type:feature"

# ... etc
```

---

*Generated: 2026-01-09 by Claude Code (Opus 4.5)*
