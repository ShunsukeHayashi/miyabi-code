# Course Authentication Environment Configuration
# Issue #1300: Environment variables for comprehensive authentication system

# =============================================================================
# JWT Configuration (REQUIRED)
# =============================================================================

# JWT Secret Key - CRITICAL: Must be a strong, random string
# Generate with: openssl rand -base64 32
JWT_SECRET=your-super-secure-secret-key-minimum-32-characters-long

# JWT Token Expiration
JWT_EXPIRES_IN=7d

# JWT Issuer and Audience
JWT_ISSUER=miyabi-course-platform
JWT_AUDIENCE=miyabi-users

# =============================================================================
# Security Configuration
# =============================================================================

# Content Watermarking Salt
CONTENT_WATERMARK_SALT=miyabi-course-watermark-salt-unique-string

# Password Hashing Configuration
BCRYPT_SALT_ROUNDS=12

# Session Configuration
SESSION_MAX_AGE=604800  # 7 days in seconds
SESSION_COOKIE_SECURE=true  # Set to false in development
SESSION_COOKIE_HTTP_ONLY=true
SESSION_COOKIE_SAME_SITE=strict

# =============================================================================
# Rate Limiting Configuration
# =============================================================================

# Login Rate Limits
RATE_LIMIT_LOGIN_ATTEMPTS=5
RATE_LIMIT_LOGIN_WINDOW_MS=3600000  # 1 hour

# Registration Rate Limits
RATE_LIMIT_REGISTER_ATTEMPTS=3
RATE_LIMIT_REGISTER_WINDOW_MS=3600000  # 1 hour

# API Rate Limits
RATE_LIMIT_API_REQUESTS=100
RATE_LIMIT_API_WINDOW_MS=3600000  # 1 hour

# =============================================================================
# Security Monitoring
# =============================================================================

# Audit Log Retention (days)
AUDIT_LOG_RETENTION_DAYS=90

# Security Alert Thresholds
SECURITY_ALERT_RISK_THRESHOLD=75  # Risk score 0-100
SECURITY_ALERT_FAILED_LOGIN_THRESHOLD=10
SECURITY_ALERT_ASSESSMENT_VIOLATION_THRESHOLD=3

# Content Protection
CONTENT_URL_EXPIRY_SECONDS=3600  # 1 hour
CONTENT_SIGNATURE_ALGORITHM=sha256

# =============================================================================
# Assessment Security
# =============================================================================

# Anti-cheating Thresholds
ASSESSMENT_MAX_TAB_SWITCHES=10
ASSESSMENT_MAX_COPY_PASTE_ATTEMPTS=5
ASSESSMENT_MAX_FOCUS_LOSS=15
ASSESSMENT_SCREENSHOT_DETECTION=true

# Assessment Time Limits
ASSESSMENT_MIN_COMPLETION_MINUTES=2
ASSESSMENT_MAX_COMPLETION_HOURS=3

# =============================================================================
# Course Access Control
# =============================================================================

# Time-based Access
COURSE_ACCESS_DEFAULT_TIMEZONE=UTC
COURSE_ACCESS_ALLOW_PREVIEW=true
COURSE_ACCESS_GRACE_PERIOD_MINUTES=15

# Prerequisites
COURSE_PREREQUISITES_STRICT_MODE=true
COURSE_PREREQUISITES_CACHE_TTL=3600  # 1 hour

# =============================================================================
# Integration Settings
# =============================================================================

# Miyabi System Integration
MIYABI_API_BASE_URL=http://localhost:3000
MIYABI_API_TIMEOUT=30000  # 30 seconds

# External Services (Optional)
REDIS_URL=redis://localhost:6379  # For production rate limiting
ELASTICSEARCH_URL=http://localhost:9200  # For advanced security analytics

# =============================================================================
# Development/Testing Configuration
# =============================================================================

# Test Mode Settings (only for development/testing)
TEST_MODE=false
TEST_JWT_SECRET=test-secret-key-not-for-production
TEST_SKIP_RATE_LIMITING=false
TEST_MOCK_AUTHENTICATION=false

# Debug Settings
DEBUG_AUTHENTICATION=false
DEBUG_SECURITY_EVENTS=false
DEBUG_RATE_LIMITING=false

# =============================================================================
# Email/Notification Configuration (Optional)
# =============================================================================

# Email Settings for Security Alerts
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_SECURE=true
SMTP_USER=alerts@yourapp.com
SMTP_PASS=your-email-password

# Admin Alert Recipients
SECURITY_ALERT_EMAILS=admin@yourapp.com,security@yourapp.com

# =============================================================================
# Database Configuration
# =============================================================================

# Database URL with auth tables
DATABASE_URL=postgresql://username:password@localhost:5432/miyabi_course_db

# Database Pool Settings
DATABASE_POOL_SIZE=10
DATABASE_POOL_TIMEOUT=20000

# =============================================================================
# Logging Configuration
# =============================================================================

# Log Levels: error, warn, info, debug
LOG_LEVEL=info

# Security Log Settings
SECURITY_LOG_FILE=logs/security.log
SECURITY_LOG_MAX_SIZE=10MB
SECURITY_LOG_MAX_FILES=30

# Application Insights (Optional)
APPLICATION_INSIGHTS_CONNECTION_STRING=your-app-insights-connection-string

# =============================================================================
# Feature Flags
# =============================================================================

# Authentication Features
FEATURE_MULTI_FACTOR_AUTH=false
FEATURE_SOCIAL_LOGIN=false
FEATURE_MAGIC_LINK_LOGIN=false

# Security Features
FEATURE_ADVANCED_THREAT_DETECTION=true
FEATURE_BEHAVIORAL_ANALYSIS=true
FEATURE_GEOLOCATION_TRACKING=false

# Course Features
FEATURE_OFFLINE_CONTENT=false
FEATURE_LIVE_PROCTORING=false
FEATURE_BLOCKCHAIN_CERTIFICATES=false

# =============================================================================
# Performance Configuration
# =============================================================================

# Token Cache Settings
TOKEN_CACHE_TTL=300  # 5 minutes
TOKEN_CACHE_MAX_SIZE=1000

# Permission Cache Settings
PERMISSION_CACHE_TTL=600  # 10 minutes
PERMISSION_CACHE_MAX_SIZE=5000

# Content Delivery
CDN_BASE_URL=https://cdn.yourapp.com
CDN_SIGNATURE_KEY=your-cdn-signature-key

# =============================================================================
# Compliance & Legal
# =============================================================================

# Data Retention Policies
USER_DATA_RETENTION_YEARS=7
ASSESSMENT_DATA_RETENTION_YEARS=3
LOG_DATA_RETENTION_DAYS=90

# Privacy Settings
GDPR_COMPLIANCE=true
CCPA_COMPLIANCE=true
DATA_ANONYMIZATION=true

# Terms of Service
TOS_VERSION=1.0
TOS_ACCEPTANCE_REQUIRED=true
TOS_UPDATE_NOTIFICATION=true

# =============================================================================
# Monitoring & Alerting
# =============================================================================

# Health Check Settings
HEALTH_CHECK_INTERVAL=30000  # 30 seconds
HEALTH_CHECK_TIMEOUT=5000   # 5 seconds

# Metrics Collection
METRICS_ENABLED=true
METRICS_ENDPOINT=/api/metrics
METRICS_AUTH_REQUIRED=true

# Alert Webhooks
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/YOUR/DISCORD/WEBHOOK

# =============================================================================
# Advanced Security
# =============================================================================

# Content Security Policy
CSP_ENABLED=true
CSP_REPORT_URI=/api/csp-report

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,https://yourapp.com
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization,X-API-Key

# API Security
API_VERSIONING=true
API_DEPRECATION_WARNINGS=true
API_USAGE_ANALYTICS=true

# =============================================================================
# Mobile App Configuration (if applicable)
# =============================================================================

# Mobile JWT Configuration
MOBILE_JWT_EXPIRES_IN=30d
MOBILE_REFRESH_TOKEN_EXPIRES_IN=90d

# Mobile Security
MOBILE_APP_SIGNATURE_VERIFICATION=true
MOBILE_BIOMETRIC_AUTH_REQUIRED=false
MOBILE_DEVICE_BINDING=true

# =============================================================================
# Example Production Values
# =============================================================================

# Production environment should override these values:
# JWT_SECRET=<generate with: openssl rand -base64 32>
# CONTENT_WATERMARK_SALT=<unique production salt>
# DATABASE_URL=<production database connection string>
# REDIS_URL=<production redis connection string>
# SECURITY_ALERT_EMAILS=<production admin emails>
# LOG_LEVEL=warn
# SESSION_COOKIE_SECURE=true
# RATE_LIMIT_*=<appropriate production limits>

# =============================================================================
# Notes
# =============================================================================

# 1. Never commit actual secret values to version control
# 2. Use environment-specific files (.env.development, .env.production)
# 3. Validate all environment variables at application startup
# 4. Regularly rotate secrets, especially JWT_SECRET
# 5. Monitor and alert on configuration changes
# 6. Document any custom environment variables added
# 7. Use infrastructure as code for environment management
# 8. Test configuration changes in staging before production