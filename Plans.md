# Plans for Issue #205

**Title**: Refactor CLI Command Surface

**URL**: https://github.com/ShunsukeHayashi/miyabi-private/issues/205

---

## üìã Summary

- **Total Tasks**: 4
- **Estimated Duration**: 60 minutes
- **Execution Levels**: 4
- **Has Cycles**: ‚úÖ No

## üìù Task Breakdown

### 1. Analyze requirements for #205

- **ID**: `task-205-analysis`
- **Type**: Docs
- **Assigned Agent**: IssueAgent
- **Priority**: 0
- **Estimated Duration**: 5 min

**Description**: Analyze issue requirements and create detailed specification

### 2. Implement solution for #205

- **ID**: `task-205-impl`
- **Type**: Feature
- **Assigned Agent**: CodeGenAgent
- **Priority**: 1
- **Estimated Duration**: 30 min
- **Dependencies**: task-205-analysis

**Description**: ## Summary
Separate CLI parsing from execution logic by introducing reusable service traits, enabling agents and other entry points to share the same code paths while maintaining consistent JSON outputs.

## Deliverables
- Command service trait layer
- Simplified clap wiring
- Snapshot/unit tests for CLI outputs
- Updated CLI docs

## Dependencies
- Issue 203 (Unify Agent Pipeline)
- Issue 204 (Modularize Worktree Infrastructure)

## Checklist
- [ ] T5-command-survey ‚Äî cli-team ‚Äî list subcommands, dependencies, JSON outputs
- [ ] T5-service-trait-design ‚Äî cli-lead ‚Äî design service traits and error contracts
- [ ] T5-core-service-impl ‚Äî cli-team ‚Äî implement reusable command services
- [ ] T5-cli-wiring ‚Äî cli-team ‚Äî rewire clap commands to call services
- [ ] T5-contract-tests ‚Äî qa ‚Äî add snapshot/unit tests for outputs and args
- [ ] T5-doc-revision ‚Äî docs ‚Äî update CLI help, quickstart, examples


### 3. Add tests for #205

- **ID**: `task-205-test`
- **Type**: Test
- **Assigned Agent**: CodeGenAgent
- **Priority**: 2
- **Estimated Duration**: 15 min
- **Dependencies**: task-205-impl

**Description**: Create comprehensive test coverage

### 4. Review code quality for #205

- **ID**: `task-205-review`
- **Type**: Refactor
- **Assigned Agent**: ReviewAgent
- **Priority**: 3
- **Estimated Duration**: 10 min
- **Dependencies**: task-205-test

**Description**: Run quality checks and code review

## üîÑ Execution Plan (DAG Levels)

Tasks can be executed in parallel within each level:

### Level 0 (Parallel Execution)

- `task-205-analysis` - Analyze requirements for #205

### Level 1 (Parallel Execution)

- `task-205-impl` - Implement solution for #205

### Level 2 (Parallel Execution)

- `task-205-test` - Add tests for #205

### Level 3 (Parallel Execution)

- `task-205-review` - Review code quality for #205

## üìä Dependency Graph

```mermaid
graph TD
    task_205_analysis["Analyze requirements for #205"]
    task_205_impl["Implement solution for #205"]
    task_205_test["Add tests for #205"]
    task_205_review["Review code quality for #205"]
    task_205_analysis --> task_205_impl
    task_205_impl --> task_205_test
    task_205_test --> task_205_review
```

## ‚è±Ô∏è Timeline Estimation

- **Sequential Execution**: 60 minutes (1.0 hours)
- **Parallel Execution (Critical Path)**: 10 minutes (0.2 hours)
- **Estimated Speedup**: 6.0x

---

*Generated by CoordinatorAgent on 2025-10-18 18:47:18 UTC*
