# Miyabi Larkçµ±åˆ - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰

**Version**: 1.0.0
**Last Updated**: 2025-11-20
**Status**: P0 Phase - åŸºæœ¬é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

---

## ğŸ“‹ ç›®æ¬¡

1. [å‰ææ¡ä»¶](#å‰ææ¡ä»¶)
2. [Larkã‚¢ãƒ—ãƒªã®ä½œæˆ](#larkã‚¢ãƒ—ãƒªã®ä½œæˆ)
3. [èªè¨¼æƒ…å ±ã®è¨­å®š](#èªè¨¼æƒ…å ±ã®è¨­å®š)
4. [MCPã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#mcpã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
5. [ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆã®ä½œæˆ](#ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆã®ä½œæˆ)
6. [é€šçŸ¥ãƒ†ã‚¹ãƒˆ](#é€šçŸ¥ãƒ†ã‚¹ãƒˆ)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ğŸ”§ å‰ææ¡ä»¶

### å¿…é ˆ

- âœ… Lark/Feishu ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆç®¡ç†è€…æ¨©é™æ¨å¥¨ï¼‰
- âœ… Node.js >= 16.20.0
- âœ… npm ã¾ãŸã¯ yarn
- âœ… Miyabiãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®ã‚¢ã‚¯ã‚»ã‚¹

### æ¨å¥¨

- Lark Open Platform ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- é–‹ç™ºç”¨ã®Larkãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹

---

## ğŸš€ Larkã‚¢ãƒ—ãƒªã®ä½œæˆ

### Step 1: Lark Open Platformã¸ã‚¢ã‚¯ã‚»ã‚¹

1. [https://open.feishu.cn](https://open.feishu.cn) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. Larkã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. ã€Œé–‹ç™ºè€…ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã€â†’ã€Œã‚¢ãƒ—ãƒªã‚’ä½œæˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯

### Step 2: ã‚¢ãƒ—ãƒªã®åŸºæœ¬æƒ…å ±è¨­å®š

```
ã‚¢ãƒ—ãƒªå: Miyabi Bot
ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³: ï¼ˆä»»æ„ï¼‰
ã‚¢ãƒ—ãƒªèª¬æ˜: Miyabiè‡ªå¾‹å‹é–‹ç™ºãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é€šçŸ¥Bot
```

### Step 3: æ¨©é™ã®è¨­å®š

ä»¥ä¸‹ã®æ¨©é™ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼š

#### å¿…é ˆæ¨©é™ï¼ˆP0ãƒ•ã‚§ãƒ¼ã‚ºï¼‰

| æ¨©é™ã‚¹ã‚³ãƒ¼ãƒ— | èª¬æ˜ | ç”¨é€” |
|------------|------|------|
| `im:message` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸èª­ã¿å–ã‚Š | å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ç¢ºèª |
| `im:message:send_as_bot` | Botã¨ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ | é€šçŸ¥é€ä¿¡ |
| `im:chat` | ãƒãƒ£ãƒƒãƒˆæƒ…å ±å–å¾— | ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆæƒ…å ±å–å¾— |
| `im:chat:write` | ãƒãƒ£ãƒƒãƒˆä½œæˆãƒ»ç®¡ç† | ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆä½œæˆ |

#### æ¨å¥¨æ¨©é™ï¼ˆP1ãƒ•ã‚§ãƒ¼ã‚ºä»¥é™ï¼‰

| æ¨©é™ã‚¹ã‚³ãƒ¼ãƒ— | èª¬æ˜ | ç”¨é€” |
|------------|------|------|
| `bitable:app` | Base ã‚¢ãƒ—ãƒªç®¡ç† | Lark BaseåŒæœŸ |
| `calendar:calendar` | ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç®¡ç† | ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç† |
| `task:task` | ã‚¿ã‚¹ã‚¯ç®¡ç† | ã‚¿ã‚¹ã‚¯åŒæœŸ |

### Step 4: èªè¨¼æƒ…å ±ã®å–å¾—

1. ã€Œã‚¢ãƒ—ãƒªæƒ…å ±ã€ãƒšãƒ¼ã‚¸ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š
   - **App ID**: `cli_xxxxxxxxxxxxxxxx`
   - **App Secret**: `xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
2. ã“ã‚Œã‚‰ã®æƒ…å ±ã‚’å®‰å…¨ã«ä¿ç®¡

---

## ğŸ” èªè¨¼æƒ…å ±ã®è¨­å®š

### Step 1: èªè¨¼æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§å®Ÿè¡Œ
cd /Users/shunsuke/Dev/01-miyabi/_core/miyabi-private

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚³ãƒ”ãƒ¼
cp .lark/config/credentials.json.example .lark/config/credentials.json
```

### Step 2: èªè¨¼æƒ…å ±ã®è¨˜å…¥

`.lark/config/credentials.json` ã‚’ç·¨é›†ï¼š

```json
{
  "environments": {
    "development": {
      "app_id": "cli_ã‚ãªãŸã®App ID",
      "app_secret": "ã‚ãªãŸã®App Secret",
      "domain": "https://open.feishu.cn",
      "language": "ja"
    }
  }
}
```

### Step 3: èªè¨¼æƒ…å ±ã®ç¢ºèª

```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ãŒ .gitignore ã«å«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
git status .lark/config/credentials.json
# â†’ "Untracked files" ã«è¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ã‚’ç¢ºèª
```

---

## ğŸ”Œ MCPã‚µãƒ¼ãƒãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### Step 1: MCPã‚µãƒ¼ãƒãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# lark-mcp-enhanced ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¸ç§»å‹•
cd mcp-servers/lark-mcp-enhanced

# ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install

# ãƒ“ãƒ«ãƒ‰
npm run build
```

### Step 2: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`mcp-servers/lark-mcp-enhanced/.env` ã‚’ä½œæˆï¼š

```bash
APP_ID=ã‚ãªãŸã®App ID
APP_SECRET=ã‚ãªãŸã®App Secret
LARK_DOMAIN=https://open.feishu.cn
LARK_LANGUAGE=ja
```

### Step 3: MCPã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒªã‚»ãƒƒãƒˆã§èµ·å‹•
npm start

# ã¾ãŸã¯ã€ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ—ãƒªã‚»ãƒƒãƒˆã§èµ·å‹•
npm run start:collab
```

æˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªå‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

```
âœ“ Lark MCP Server started successfully
âœ“ Mode: stdio
âœ“ Preset: default
âœ“ Auto Permission Manager: enabled
```

---

## ğŸ‘¥ ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆã®ä½œæˆ

### Option A: MCPãƒ„ãƒ¼ãƒ«ã§ä½œæˆï¼ˆæ¨å¥¨ï¼‰

Claude Codeã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œï¼š

```javascript
// Miyabié–‹ç™ºãƒãƒ¼ãƒ ç”¨ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
mcp__lark__im_v1_chat_create({
  data: {
    name: "Miyabi Dev Team",
    description: "Miyabié–‹ç™ºãƒãƒ¼ãƒ  - Issueé€šçŸ¥ãƒ»ãƒ“ãƒ«ãƒ‰ãƒ¬ãƒãƒ¼ãƒˆ",
    chat_type: "private",
    user_id_list: ["ou_xxxxxxxx"] // ã‚ãªãŸã®Open ID
  },
  params: {
    user_id_type: "open_id"
  }
})
```

### Option B: Larkã‚¢ãƒ—ãƒªã‹ã‚‰æ‰‹å‹•ä½œæˆ

1. Larkã‚¢ãƒ—ãƒªã‚’é–‹ã
2. ã€Œæ–°è¦ã‚°ãƒ«ãƒ¼ãƒ—ã€ã‚’ä½œæˆ
3. ã‚°ãƒ«ãƒ¼ãƒ—å: `Miyabi Dev Team`
4. Miyabi Botã‚’è¿½åŠ 
5. Chat IDã‚’ãƒ¡ãƒ¢ï¼ˆå¾Œã§ä½¿ç”¨ï¼‰

### ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šã®ä¿å­˜

`.lark/groups/miyabi-dev.json` ã‚’ä½œæˆï¼š

```json
{
  "group_name": "Miyabi Dev Team",
  "chat_id": "oc_xxxxxxxxxxxxxxxx",
  "purpose": "é–‹ç™ºãƒãƒ¼ãƒ é€šçŸ¥ç”¨",
  "enabled_notifications": [
    "issue_created",
    "build_completed",
    "deployment_status"
  ],
  "members": [
    "ou_xxxxxxxx"
  ]
}
```

---

## ğŸ§ª é€šçŸ¥ãƒ†ã‚¹ãƒˆ

### Step 1: ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡

Claude Codeã§ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

```javascript
mcp__lark__im_v1_message_create({
  data: {
    receive_id: "oc_ã‚ãªãŸã®Chat ID",
    msg_type: "text",
    content: JSON.stringify({
      text: "ğŸ‰ Miyabi Larkçµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸï¼\n\nã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€åŸºæœ¬è¨­å®šã¯å®Œäº†ã§ã™ã€‚"
    })
  },
  params: {
    receive_id_type: "chat_id"
  }
})
```

### Step 2: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã‚«ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆ

```javascript
// Issueé€šçŸ¥ã‚«ãƒ¼ãƒ‰ã‚’ãƒ†ã‚¹ãƒˆé€ä¿¡
const cardTemplate = require('./.lark/templates/cards/issue-notification.json');

// å¤‰æ•°ã‚’å®Ÿéš›ã®å€¤ã«ç½®ãæ›ãˆã¦ãƒ†ã‚¹ãƒˆ
```

---

## âœ… ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

P0ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã®ç¢ºèªï¼š

- [ ] Larkã‚¢ãƒ—ãƒªãŒä½œæˆã•ã‚Œã€App ID/Secretã‚’å–å¾—æ¸ˆã¿
- [ ] `.lark/config/credentials.json` ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] MCPã‚µãƒ¼ãƒãƒ¼ãŒæ­£å¸¸ã«èµ·å‹•ã™ã‚‹
- [ ] Miyabi Dev Teamã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] BotãŒã‚°ãƒ«ãƒ¼ãƒ—ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ã«æˆåŠŸã—ãŸ
- [ ] `.lark/config/credentials.json` ãŒ .gitignore ã«å«ã¾ã‚Œã¦ã„ã‚‹

---

## ğŸ”„ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

P0ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†å¾Œã€ä»¥ä¸‹ã«é€²ã‚“ã§ãã ã•ã„ï¼š

### P1ãƒ•ã‚§ãƒ¼ã‚ºï¼ˆ2-3é€±ç›®ï¼‰

1. **åŒæ–¹å‘åŒæœŸã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   - `miyabi-lark-sync` ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ‡ãƒ—ãƒ­ã‚¤
   - Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®è¨­å®š

2. **å®šæœŸãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•åŒ–**
   - AgentçŠ¶æ…‹ãƒ¬ãƒãƒ¼ãƒˆï¼ˆ4æ™‚é–“ã”ã¨ï¼‰
   - ãƒ‡ã‚¤ãƒªãƒ¼ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒƒãƒ—

3. **GitHub Actionsçµ±åˆ**
   - CI/CDã‚¤ãƒ™ãƒ³ãƒˆã®è‡ªå‹•é€šçŸ¥
   - ãƒ“ãƒ«ãƒ‰çµæœã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡

è©³ç´°ã¯ `.lark/docs/P1_SETUP.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ï¼ˆä½œæˆäºˆå®šï¼‰ã€‚

---

## ğŸ†˜ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: MCPã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„

**ç—‡çŠ¶**: `npm start` ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ

**è§£æ±ºç­–**:
```bash
# ä¾å­˜é–¢ä¿‚ã‚’å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install
npm run build
```

### å•é¡Œ: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ™‚ã«æ¨©é™ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: `Permission denied` ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–**:
1. Lark Open Platformã§æ¨©é™è¨­å®šã‚’ç¢ºèª
2. å¿…è¦ãªæ¨©é™ã‚¹ã‚³ãƒ¼ãƒ—ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. ã‚¢ãƒ—ãƒªã‚’å†æ‰¿èª

### å•é¡Œ: BotãŒã‚°ãƒ«ãƒ¼ãƒ—ã«å‚åŠ ã§ããªã„

**ç—‡çŠ¶**: ã‚°ãƒ«ãƒ¼ãƒ—ã«Botã‚’è¿½åŠ ã§ããªã„

**è§£æ±ºç­–**:
1. Botã®å¯ç”¨æ€§è¨­å®šã‚’ç¢ºèªï¼ˆå…¨ç¤¾å“¡/ç‰¹å®šéƒ¨é–€ï¼‰
2. ã‚°ãƒ«ãƒ¼ãƒ—ã®å¤–éƒ¨Botè¨±å¯è¨­å®šã‚’ç¢ºèª
3. ã‚¢ãƒ—ãƒªã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã€Œå…¬é–‹ä¸­ã€ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª

---

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Lark Open Platform](https://open.feishu.cn)
- [Lark API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://open.feishu.cn/document/)
- [MCP Protocol](https://modelcontextprotocol.io/)
- [Miyabi CLAUDE.md](../../CLAUDE.md)

---

**ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚**
