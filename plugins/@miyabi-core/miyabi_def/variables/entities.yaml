# Miyabi Entity Definitions - 14 Core Entities
# Version: 1.0.0
# Source: docs/architecture/ENTITY_RELATION_MODEL.md

entities:
  # E1: Issue - GitHub Issue
  E1_Issue:
    id: "E1"
    name: "Issue"
    type: "GitHub Issue"
    description: "GitHub Issueã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£Primary entity in Miyabi system"

    attributes:
      identification:
        - name: "number"
          type: "integer"
          description: "Issueç•ªå·ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯IDï¼‰"
          required: true

      content:
        - name: "title"
          type: "string"
          description: "ã‚¿ã‚¤ãƒˆãƒ«"
          required: true
        - name: "body"
          type: "string"
          description: "æœ¬æ–‡ï¼ˆè¦ä»¶ãƒ»ä»•æ§˜ï¼‰"
          required: true

      state:
        - name: "state"
          type: "enum"
          values: ["open", "closed"]
          description: "ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚º"
          required: true
        - name: "labels"
          type: "string[]"
          description: "ä»˜ä¸ã•ã‚ŒãŸLabel"
          required: true

      metadata:
        - name: "assignee"
          type: "string"
          description: "æ‹…å½“è€…"
          required: false
        - name: "createdAt"
          type: "string"
          format: "ISO8601"
          description: "ä½œæˆæ—¥æ™‚"
          required: true
        - name: "updatedAt"
          type: "string"
          format: "ISO8601"
          description: "æ›´æ–°æ—¥æ™‚"
          required: true
        - name: "url"
          type: "string"
          format: "URL"
          description: "GitHub URL"
          required: true

    relations:
      - "R1: analyzed-by â†’ Agent (IssueAgent)"
      - "R2: decomposed-into â†’ Task[]"
      - "R3: tagged-with â†’ Label[]"
      - "R4: creates â†’ PR"
      - "R36: parent-of â†’ SubIssue"

    implementation:
      type_definition: "agents/types/index.ts:54-64"
      agent: ".claude/agents/specs/issue-agent.md"
      prompts: ".claude/agents/prompts/issue-agent-prompt.md"
      labels: "docs/guides/LABEL_SYSTEM_GUIDE.md"
      templates: ".github/ISSUE_TEMPLATE/agent-task.md"

  # E2: Task - Decomposed Task
  E2_Task:
    id: "E2"
    name: "Task"
    type: "Task"
    description: "Issueã‹ã‚‰CoordinatorAgentã«ã‚ˆã‚Šåˆ†è§£ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯"

    attributes:
      identification:
        - name: "id"
          type: "string"
          format: "UUID"
          description: "TaskID"
          required: true

      content:
        - name: "title"
          type: "string"
          description: "ã‚¿ã‚¹ã‚¯å"
          required: true
        - name: "description"
          type: "string"
          description: "è©³ç´°èª¬æ˜"
          required: true
        - name: "type"
          type: "enum"
          values: ["feature", "bug", "refactor", "docs", "test", "deployment"]
          description: "ã‚¿ã‚¹ã‚¯ç¨®åˆ¥"
          required: true

      priority:
        - name: "priority"
          type: "number"
          description: "å„ªå…ˆåº¦ï¼ˆæ•°å€¤ï¼‰"
          required: true
        - name: "severity"
          type: "enum"
          values: ["Sev.1-Critical", "Sev.2-High", "Sev.3-Medium", "Sev.4-Low"]
          description: "æ·±åˆ»åº¦"
          required: false
        - name: "impact"
          type: "enum"
          values: ["Critical", "High", "Medium", "Low"]
          description: "å½±éŸ¿åº¦"
          required: false

      assignment:
        - name: "assignedAgent"
          type: "AgentType"
          description: "å‰²ã‚Šå½“ã¦Agent"
          required: false

      dependencies:
        - name: "dependencies"
          type: "string[]"
          description: "ä¾å­˜TaskIDãƒªã‚¹ãƒˆ"
          required: true
          default: "[]"

      execution:
        - name: "estimatedDuration"
          type: "number"
          unit: "minutes"
          description: "æ¨å®šæ™‚é–“"
          required: false
        - name: "status"
          type: "AgentStatus"
          description: "ç¾åœ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
          required: false
        - name: "startTime"
          type: "number"
          format: "timestamp"
          description: "é–‹å§‹æ™‚åˆ»"
          required: false
        - name: "endTime"
          type: "number"
          format: "timestamp"
          description: "çµ‚äº†æ™‚åˆ»"
          required: false

      metadata:
        - name: "metadata"
          type: "Record<string, any>"
          description: "è¿½åŠ æƒ…å ±"
          required: false

    relations:
      - "R5: assigned-to â†’ Agent"
      - "R6: depends-on â†’ Task"
      - "R7: part-of â†’ DAG"
      - "R8: runs-in â†’ Worktree"

    implementation:
      type_definition: "agents/types/index.ts:37-52"
      agent: "agents/coordinator/coordinator-agent.ts"
      spec: ".claude/agents/specs/coordinator-agent.md"
      prompts: ".claude/agents/prompts/coordinator-agent-prompt.md"

  # E3: Agent - Autonomous Agent
  E3_Agent:
    id: "E3"
    name: "Agent"
    type: "AgentType"
    description: "è‡ªå¾‹å®Ÿè¡ŒAgentï¼ˆCoding: 7å€‹, Business: 14å€‹ï¼‰"

    types:
      coding:
        - name: "CoordinatorAgent"
          role: "çµ±æ‹¬ãƒ»DAGåˆ†è§£"
          authority: "ğŸ”´çµ±æ‹¬æ¨©é™"
          character: "æŒ‡æ®è€…ã‚¢ãƒ¼ã‚¯"
        - name: "CodeGenAgent"
          role: "AIé§†å‹•ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ"
          authority: "ğŸ”µå®Ÿè¡Œæ¨©é™"
          character: "å¤©æ‰ã‚³ãƒ¼ãƒ€ãƒ¼ãƒªãƒªã‚¢"
        - name: "ReviewAgent"
          role: "å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼"
          authority: "ğŸ”µå®Ÿè¡Œæ¨©é™"
          character: "å³æ ¼å¯©æŸ»å®˜ã‚¯ãƒªã‚¹ã‚¿"
        - name: "IssueAgent"
          role: "Issueåˆ†æãƒ»ãƒ©ãƒ™ãƒªãƒ³ã‚°"
          authority: "ğŸŸ¢åˆ†ææ¨©é™"
          character: "æˆ¦ç•¥å®¶ã‚½ãƒ•ã‚£ã‚¢"
        - name: "PRAgent"
          role: "PRè‡ªå‹•ä½œæˆ"
          authority: "ğŸ”µå®Ÿè¡Œæ¨©é™"
          character: "çµ±åˆã®å®ˆè­·è€…ãƒã‚¢"
        - name: "DeploymentAgent"
          role: "CI/CDãƒ‡ãƒ—ãƒ­ã‚¤"
          authority: "ğŸ”µå®Ÿè¡Œæ¨©é™"
          character: "å±•é–‹å¸ä»¤å®˜ã‚¢ãƒˆãƒ©ã‚¹"
        - name: "RefresherAgent"
          role: "IssueçŠ¶æ…‹ç›£è¦–ãƒ»æ›´æ–°"
          authority: "ğŸŸ¢åˆ†ææ¨©é™"
          character: "ç›£è¦–è€…ã‚»ãƒ©ãƒ•"

      business:
        strategy_planning:
          - "SelfAnalysisAgent"
          - "MarketResearchAgent"
          - "PersonaAgent"
          - "ProductConceptAgent"
          - "ProductDesignAgent"
          - "FunnelDesignAgent"
        marketing:
          - "ContentCreationAgent"
          - "SNSStrategyAgent"
          - "YouTubeAgent"
          - "MarketingAgent"
        sales_crm:
          - "SalesAgent"
          - "CRMAgent"
          - "AnalyticsAgent"
        ai_entrepreneur:
          - "AIEntrepreneurAgent"

    authority_levels:
      - name: "ğŸ”´çµ±æ‹¬æ¨©é™"
        description: "å…¨ä½“çµ±æ‹¬ã€DAGåˆ†è§£ã€Agentå‰²ã‚Šå½“ã¦"
        agents: ["CoordinatorAgent"]
      - name: "ğŸ”µå®Ÿè¡Œæ¨©é™"
        description: "ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€PRä½œæˆã€ãƒ‡ãƒ—ãƒ­ã‚¤"
        agents: ["CodeGenAgent", "ReviewAgent", "PRAgent", "DeploymentAgent"]
      - name: "ğŸŸ¢åˆ†ææ¨©é™"
        description: "Issueåˆ†æã€ãƒ©ãƒ™ãƒ«ç®¡ç†ã€çŠ¶æ…‹ç›£è¦–"
        agents: ["IssueAgent", "RefresherAgent"]

    escalation_targets:
      - "TechLead"
      - "PO"
      - "CISO"
      - "CTO"
      - "DevOps"

    relations:
      - "R9: executes â†’ Task"
      - "R10: generates â†’ PR"
      - "R11: creates â†’ QualityReport"
      - "R12: triggers â†’ Escalation"
      - "R13: performs â†’ Deployment"
      - "R14: logs-to â†’ LDDLog"
      - "R15: invoked-by â†’ Command"

    implementation:
      type_definition: "agents/types/index.ts:15-22"
      implementations: "agents/*/*-agent.ts"
      specs: ".claude/agents/specs/*-agent.md"
      prompts: ".claude/agents/prompts/*-agent-prompt.md"
      characters: ".claude/agents/AGENT_CHARACTERS.md"

  # E4: PR - Pull Request
  E4_PR:
    id: "E4"
    name: "PR"
    type: "Pull Request"
    description: "GitHub Pull Request"

    attributes:
      request:
        - name: "title"
          type: "string"
          format: "Conventional Commits"
          description: "PRã‚¿ã‚¤ãƒˆãƒ«"
          required: true
        - name: "body"
          type: "string"
          description: "PRæœ¬æ–‡ï¼ˆå¤‰æ›´ã‚µãƒãƒªï¼‰"
          required: true
        - name: "baseBranch"
          type: "string"
          description: "ãƒ™ãƒ¼ã‚¹ãƒ–ãƒ©ãƒ³ãƒï¼ˆmain/developï¼‰"
          required: true
        - name: "headBranch"
          type: "string"
          description: "HEADãƒ–ãƒ©ãƒ³ãƒï¼ˆfeature/agent-*ï¼‰"
          required: true
        - name: "draft"
          type: "boolean"
          description: "Draft PR ãƒ•ãƒ©ã‚°"
          required: true
        - name: "issueNumber"
          type: "number"
          description: "é–¢é€£Issueç•ªå·"
          required: false
        - name: "labels"
          type: "string[]"
          description: "Label"
          required: false
        - name: "reviewers"
          type: "string[]"
          description: "ãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼"
          required: false

      result:
        - name: "number"
          type: "number"
          description: "PRç•ªå·"
          required: true
        - name: "url"
          type: "string"
          format: "URL"
          description: "GitHub URL"
          required: true
        - name: "state"
          type: "enum"
          values: ["draft", "open", "merged", "closed"]
          description: "çŠ¶æ…‹"
          required: true
        - name: "createdAt"
          type: "string"
          format: "ISO8601"
          description: "ä½œæˆæ—¥æ™‚"
          required: true

    relations:
      - "R19: reviewed-by â†’ Agent (ReviewAgent)"
      - "R20: has â†’ QualityReport"
      - "R21: attached-to â†’ Issue"

    implementation:
      type_definition: "agents/types/index.ts:240-257"
      agent: "agents/pr/pr-agent.ts"
      spec: ".claude/agents/specs/pr-agent.md"

  # E5: Label - GitHub Label
  E5_Label:
    id: "E5"
    name: "Label"
    type: "GitHub Label"
    description: "GitHub Labelï¼ˆ57å€‹ã€11ã‚«ãƒ†ã‚´ãƒªï¼‰"

    categories:
      STATE:
        count: 8
        role: "ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†"
        labels:
          - "state:pending"
          - "state:analyzing"
          - "state:implementing"
          - "state:reviewing"
          - "state:done"
          - "state:blocked"
          - "state:failed"
          - "state:paused"

      AGENT:
        count: 6
        role: "Agentå‰²ã‚Šå½“ã¦"
        labels:
          - "agent:coordinator"
          - "agent:codegen"
          - "agent:review"
          - "agent:issue"
          - "agent:pr"
          - "agent:deployment"

      PRIORITY:
        count: 4
        role: "å„ªå…ˆåº¦ç®¡ç†"
        labels:
          - "priority:P0-Critical"
          - "priority:P1-High"
          - "priority:P2-Medium"
          - "priority:P3-Low"

      TYPE:
        count: 7
        role: "Issueåˆ†é¡"
        labels:
          - "type:feature"
          - "type:bug"
          - "type:docs"
          - "type:refactor"
          - "type:test"
          - "type:architecture"
          - "type:deployment"

      SEVERITY:
        count: 4
        role: "æ·±åˆ»åº¦ãƒ»ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³"
        labels:
          - "severity:Sev.1-Critical"
          - "severity:Sev.2-High"
          - "severity:Sev.3-Medium"
          - "severity:Sev.4-Low"

      PHASE:
        count: 5
        role: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚§ãƒ¼ã‚º"
        labels:
          - "phase:planning"
          - "phase:implementation"
          - "phase:testing"
          - "phase:deployment"
          - "phase:monitoring"

      SPECIAL:
        count: 7
        role: "ç‰¹æ®Šæ“ä½œ"
        labels:
          - "security"
          - "cost-watch"
          - "dependencies"
          - "learning"
          - "experiment"
          - "wontfix"
          - "duplicate"

      TRIGGER:
        count: 4
        role: "è‡ªå‹•åŒ–ãƒˆãƒªã‚¬ãƒ¼"
        labels:
          - "trigger:agent-execute"
          - "trigger:generate-report"
          - "trigger:deploy-staging"
          - "trigger:deploy-production"

      QUALITY:
        count: 4
        role: "å“è³ªã‚¹ã‚³ã‚¢"
        labels:
          - "quality:excellent"
          - "quality:good"
          - "quality:needs-improvement"
          - "quality:poor"

      COMMUNITY:
        count: 4
        role: "ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£"
        labels:
          - "good-first-issue"
          - "help-wanted"
          - "question"
          - "discussion"

      HIERARCHY:
        count: 4
        role: "éšå±¤æ§‹é€ ç®¡ç†"
        labels:
          - "hierarchy:root"
          - "hierarchy:parent"
          - "hierarchy:child"
          - "hierarchy:leaf"

    total_count: 57

    relations:
      - "R16: triggers â†’ Agent"
      - "R17: defines-state â†’ Issue"
      - "R18: categorizes â†’ Task"

    implementation:
      guide: "docs/guides/LABEL_SYSTEM_GUIDE.md"
      definition: ".github/labels.yml"
      sdk_integration: "docs/AGENT_SDK_LABEL_INTEGRATION.md"

  # E6: QualityReport - Code Quality Report
  E6_QualityReport:
    id: "E6"
    name: "QualityReport"
    type: "Quality Report"
    description: "ReviewAgentã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªãƒ¬ãƒãƒ¼ãƒˆ"

    attributes:
      score:
        - name: "score"
          type: "number"
          range: "0-100"
          description: "ç·åˆã‚¹ã‚³ã‚¢"
          required: true
        - name: "passed"
          type: "boolean"
          description: "åˆæ ¼ãƒ•ãƒ©ã‚°ï¼ˆscore >= 80ï¼‰"
          required: true

      issues:
        - name: "issues"
          type: "QualityIssue[]"
          description: "æ¤œå‡ºã•ã‚ŒãŸå•é¡Œãƒªã‚¹ãƒˆ"
          required: true

      recommendations:
        - name: "recommendations"
          type: "string[]"
          description: "æ¨å¥¨äº‹é …"
          required: true

      breakdown:
        - name: "eslintScore"
          type: "number"
          weight: "40%"
          description: "ESLintã‚¹ã‚³ã‚¢"
          required: true
        - name: "typeScriptScore"
          type: "number"
          weight: "30%"
          description: "TypeScriptã‚¹ã‚³ã‚¢"
          required: true
        - name: "securityScore"
          type: "number"
          weight: "20%"
          description: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢"
          required: true
        - name: "testCoverageScore"
          type: "number"
          weight: "10%"
          description: "ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚¹ã‚³ã‚¢"
          required: true

    quality_issue_structure:
      attributes:
        - name: "type"
          type: "enum"
          values: ["eslint", "typescript", "security", "coverage"]
        - name: "severity"
          type: "enum"
          values: ["critical", "high", "medium", "low"]
        - name: "message"
          type: "string"
        - name: "file"
          type: "string"
        - name: "line"
          type: "number"
        - name: "column"
          type: "number"
        - name: "scoreImpact"
          type: "number"
          description: "æ¸›ç‚¹ï¼ˆ-20, -30, -40ç­‰ï¼‰"

    relations:
      - "R22: evaluated-by â†’ Agent (ReviewAgent)"
      - "R23: attached-to â†’ PR"

    implementation:
      type_definition: "agents/types/index.ts:108-130"
      agent: "agents/review/review-agent.ts"
      spec: ".claude/agents/specs/review-agent.md"

  # E7: Command - Claude Code Command
  E7_Command:
    id: "E7"
    name: "Command"
    type: "Command"
    description: "Claude Code Slash Commandï¼ˆ9å€‹ï¼‰"

    commands:
      - name: "/test"
        description: "ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
        file: ".claude/commands/test.md"
      - name: "/agent-run"
        description: "Agentæ‰‹å‹•å®Ÿè¡Œ"
        file: ".claude/commands/agent-run.md"
      - name: "/verify"
        description: "ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª"
        file: ".claude/commands/verify.md"
      - name: "/deploy"
        description: "ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ"
        file: ".claude/commands/deploy.md"
      - name: "/create-issue"
        description: "Issueå¯¾è©±çš„ä½œæˆ"
        file: ".claude/commands/create-issue.md"
      - name: "/security-scan"
        description: "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³"
        file: ".claude/commands/security-scan.md"
      - name: "/generate-docs"
        description: "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ"
        file: ".claude/commands/generate-docs.md"
      - name: "/miyabi-todos"
        description: "TODOæ¤œå‡ºãƒ»IssueåŒ–"
        file: ".claude/commands/miyabi-todos.md"
      - name: "/miyabi-auto"
        description: "å…¨è‡ªå‹•ãƒ¢ãƒ¼ãƒ‰"
        file: ".claude/commands/miyabi-auto.md"

    structure:
      format: "Markdown with YAML frontmatter"
      frontmatter:
        - "description"
      body:
        - "command name"
        - "execution details"
        - "bash code block"

    relations:
      - "R15: invokes â†’ Agent"

    implementation:
      location: ".claude/commands/*.md"

  # E8: Escalation - Escalation Info
  E8_Escalation:
    id: "E8"
    name: "Escalation"
    type: "Escalation"
    description: "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±"

    attributes:
      - name: "reason"
        type: "string"
        description: "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç†ç”±"
        required: true
      - name: "target"
        type: "EscalationTarget"
        values: ["TechLead", "PO", "CISO", "CTO", "DevOps"]
        description: "ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å…ˆ"
        required: true
      - name: "severity"
        type: "Severity"
        values: ["Sev.1-Critical", "Sev.2-High", "Sev.3-Medium", "Sev.4-Low"]
        description: "æ·±åˆ»åº¦"
        required: true
      - name: "context"
        type: "Record<string, any>"
        description: "è¿½åŠ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ"
        required: true
      - name: "timestamp"
        type: "string"
        format: "ISO8601"
        description: "ç™ºç”Ÿæ—¥æ™‚"
        required: true

    trigger_conditions:
      TechLead:
        - "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å•é¡Œ"
        - "è¤‡é›‘åº¦è¶…é"
      CISO:
        - "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ï¼ˆSev.1-2ï¼‰"
      PO:
        - "è¦ä»¶ä¸æ˜ç¢º"
        - "ãƒ“ã‚¸ãƒã‚¹åˆ¤æ–­å¿…è¦"
      CTO:
        - "ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«éšœå®³"
      DevOps:
        - "ã‚¤ãƒ³ãƒ•ãƒ©ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤å•é¡Œ"

    relations:
      - "R12: triggered-by â†’ Agent"

    implementation:
      type_definition: "agents/types/index.ts:96-102"
      method: "agents/base-agent.ts (escalate ãƒ¡ã‚½ãƒƒãƒ‰)"

  # E9: Deployment - Deployment Info
  E9_Deployment:
    id: "E9"
    name: "Deployment"
    type: "Deployment"
    description: "ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±"

    attributes:
      config:
        - name: "environment"
          type: "enum"
          values: ["staging", "production"]
          description: "ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ"
          required: true
        - name: "version"
          type: "string"
          format: "semantic version"
          description: "ãƒãƒ¼ã‚¸ãƒ§ãƒ³"
          required: true
        - name: "projectId"
          type: "string"
          description: "Firebase Project ID"
          required: true
        - name: "targets"
          type: "string[]"
          values: ["hosting", "functions"]
          description: "ãƒ‡ãƒ—ãƒ­ã‚¤å¯¾è±¡"
          required: true
        - name: "skipTests"
          type: "boolean"
          description: "ãƒ†ã‚¹ãƒˆã‚¹ã‚­ãƒƒãƒ—ãƒ•ãƒ©ã‚°"
          required: false
        - name: "autoRollback"
          type: "boolean"
          description: "è‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æœ‰åŠ¹åŒ–"
          required: true
        - name: "healthCheckUrl"
          type: "string"
          format: "URL"
          description: "ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯URL"
          required: true

      result:
        - name: "environment"
          type: "enum"
          values: ["staging", "production"]
          required: true
        - name: "version"
          type: "string"
          required: true
        - name: "projectId"
          type: "string"
          required: true
        - name: "deploymentUrl"
          type: "string"
          format: "URL"
          description: "ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸURL"
          required: true
        - name: "deployedAt"
          type: "string"
          format: "ISO8601"
          description: "ãƒ‡ãƒ—ãƒ­ã‚¤æ—¥æ™‚"
          required: true
        - name: "durationMs"
          type: "number"
          unit: "milliseconds"
          description: "ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚é–“"
          required: true
        - name: "status"
          type: "enum"
          values: ["success", "failed", "rolled_back"]
          description: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
          required: true

    relations:
      - "R13: performed-by â†’ Agent (DeploymentAgent)"

    implementation:
      type_definition: "agents/types/index.ts:262-281"
      agent: "agents/deployment/deployment-agent.ts"
      spec: ".claude/agents/specs/deployment-agent.md"
      command: ".claude/commands/deploy.md"

  # E10: LDDLog - Log-Driven Development Log
  E10_LDDLog:
    id: "E10"
    name: "LDDLog"
    type: "LDD Log"
    description: "Log-Driven Developmentå®Ÿè¡Œãƒ­ã‚°"

    attributes:
      session:
        - name: "sessionId"
          type: "string"
          format: "UUID"
          description: "ã‚»ãƒƒã‚·ãƒ§ãƒ³ID"
          required: true
        - name: "date"
          type: "string"
          format: "YYYY-MM-DD"
          description: "ãƒ­ã‚°æ—¥ä»˜"
          required: true
        - name: "deviceIdentifier"
          type: "string"
          description: "ãƒ‡ãƒã‚¤ã‚¹è­˜åˆ¥å­"
          required: true

      codex_prompt_chain:
        - name: "intent"
          type: "string"
          description: "æ„å›³"
          required: true
        - name: "plan"
          type: "string[]"
          description: "è¨ˆç”»ã‚¹ãƒ†ãƒƒãƒ—"
          required: true
        - name: "implementation"
          type: "string[]"
          description: "å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—"
          required: true
        - name: "verification"
          type: "string[]"
          description: "æ¤œè¨¼ã‚¹ãƒ†ãƒƒãƒ—"
          required: true

      tool_invocations:
        structure: "Array of ToolInvocation"
        fields:
          - name: "command"
            type: "string"
            description: "å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰"
          - name: "workdir"
            type: "string"
            description: "ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª"
          - name: "timestamp"
            type: "string"
            format: "ISO8601"
            description: "å®Ÿè¡Œæ™‚åˆ»"
          - name: "status"
            type: "enum"
            values: ["passed", "failed"]
            description: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
          - name: "notes"
            type: "string"
            description: "ãƒ¡ãƒ¢"
          - name: "output"
            type: "string"
            description: "å‡ºåŠ›"
          - name: "error"
            type: "string"
            description: "ã‚¨ãƒ©ãƒ¼"

      memory_bank:
        - name: "memoryBankUpdates"
          type: "string[]"
          description: "Memory Bankæ›´æ–°"
          required: true

      next_steps:
        - name: "nextSteps"
          type: "string"
          description: "æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—"
          required: true

    relations:
      - "R14: logged-by â†’ Agent"

    implementation:
      type_definition: "agents/types/index.ts:284-312"
      method: "agents/base-agent.ts (logToLDD ãƒ¡ã‚½ãƒƒãƒ‰)"
      output_location: ".ai/logs/YYYY-MM-DD.md"
      format: "Markdown"

  # E11: DAG - Directed Acyclic Graph
  E11_DAG:
    id: "E11"
    name: "DAG"
    type: "Directed Acyclic Graph"
    description: "ã‚¿ã‚¹ã‚¯ä¾å­˜ã‚°ãƒ©ãƒ•"

    attributes:
      structure:
        - name: "nodes"
          type: "Task[]"
          description: "Taskãƒªã‚¹ãƒˆ"
          required: true
        - name: "edges"
          type: "Edge[]"
          description: "ä¾å­˜é–¢ä¿‚ã‚¨ãƒƒã‚¸"
          required: true
        - name: "levels"
          type: "string[][]"
          description: "ãƒˆãƒãƒ­ã‚¸ã‚«ãƒ«ã‚½ãƒ¼ãƒˆæ¸ˆã¿ãƒ¬ãƒ™ãƒ«"
          required: true

      edge_structure:
        - name: "from"
          type: "string"
          description: "ä¾å­˜å…ƒTaskID"
        - name: "to"
          type: "string"
          description: "ä¾å­˜å…ˆTaskID"

    task_decomposition:
      attributes:
        - name: "originalIssue"
          type: "Issue"
          description: "å…ƒã®Issue"
        - name: "tasks"
          type: "Task[]"
          description: "åˆ†è§£ã•ã‚ŒãŸTask"
        - name: "dag"
          type: "DAG"
          description: "æ§‹ç¯‰ã•ã‚ŒãŸDAG"
        - name: "estimatedTotalDuration"
          type: "number"
          unit: "minutes"
          description: "æ¨å®šåˆè¨ˆæ™‚é–“"
        - name: "hasCycles"
          type: "boolean"
          description: "å¾ªç’°ä¾å­˜ãƒã‚§ãƒƒã‚¯"
        - name: "recommendations"
          type: "string[]"
          description: "æ¨å¥¨äº‹é …"

    composition_algebra:
      sequential: "Tâ‚ âˆ˜ Tâ‚‚ = Tâ‚ƒ"
      parallel: "Tâ‚ âŠ— Tâ‚‚ = Tâ‚ƒ"
      conditional: "Tâ‚ âŠ• Tâ‚‚ = Tâ‚ƒ"
      iterative: "T* = âŠ•[n=0â†’âˆ] Tâ¿"

    relations:
      - "R24: decomposed-from â†’ Issue"
      - "R25: contains â†’ Task[]"

    implementation:
      type_definition: "agents/types/index.ts:66-70, 135-143"
      agent: "agents/coordinator/coordinator-agent.ts"
      methods: ["decomposeIssue", "buildDAG"]

  # E12: Worktree - Git Worktree
  E12_Worktree:
    id: "E12"
    name: "Worktree"
    type: "Git Worktree"
    description: "Git Worktreeï¼ˆä¸¦åˆ—å®Ÿè¡ŒåŸºç›¤ï¼‰"

    attributes:
      - name: "path"
        type: "string"
        format: "filesystem path"
        description: "Worktreeãƒ‘ã‚¹"
        example: ".worktrees/issue-270"
        required: true
      - name: "branch"
        type: "string"
        description: "ãƒ–ãƒ©ãƒ³ãƒå"
        example: "feature/agent-issue-270"
        required: true
      - name: "taskId"
        type: "string"
        description: "å®Ÿè¡ŒTaskID"
        required: true
      - name: "issueNumber"
        type: "number"
        description: "é–¢é€£Issueç•ªå·"
        required: false
      - name: "agentType"
        type: "AgentType"
        description: "å®Ÿè¡ŒAgent"
        required: true
      - name: "status"
        type: "enum"
        values: ["active", "completed", "failed"]
        description: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
        required: true

    path_convention:
      pattern: ".worktrees/issue-{ISSUE_NUMBER}/task-{TASK_ID}/"
      examples:
        - ".worktrees/issue-270/"
        - ".worktrees/issue-270/task-abc123/"

    relations:
      - "R26: executes â†’ Task"
      - "R27: creates â†’ PR"

    implementation:
      documentation: "CLAUDE.md (Git Worktreeä¸¦åˆ—å®Ÿè¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)"
      script: "scripts/parallel-executor.ts"

  # E13: DiscordCommunity - Discord Community
  E13_DiscordCommunity:
    id: "E13"
    name: "DiscordCommunity"
    type: "Discord Community"
    description: "Discordã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£çµ±åˆ"

    attributes:
      identification:
        - name: "serverId"
          type: "string"
          description: "Discord Server ID"
          required: true
        - name: "serverName"
          type: "string"
          description: "ã‚µãƒ¼ãƒãƒ¼å"
          example: "Miyabi Community"
          required: true

      channels:
        - name: "channels"
          type: "DiscordChannel[]"
          description: "ãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆ15+ï¼‰"
          required: true

      roles:
        - name: "roles"
          type: "DiscordRole[]"
          description: "Progressive Role System"
          required: true

      members:
        - name: "members"
          type: "number"
          description: "ç¾åœ¨ã®ãƒ¡ãƒ³ãƒãƒ¼æ•°"
          required: true

      integrations:
        - name: "webhooks"
          type: "WebhookConfig[]"
          description: "GitHub/Agenté€šçŸ¥ç”¨Webhook"
          required: true
        - name: "botIntegrations"
          type: "BotConfig[]"
          description: "MEE6, GitHub Bot, Custom Miyabi Bot"
          required: true

      metadata:
        - name: "createdAt"
          type: "string"
          format: "ISO8601"
          description: "ã‚µãƒ¼ãƒãƒ¼ä½œæˆæ—¥æ™‚"
          required: true

    channel_structure:
      attributes:
        - "id: Channel ID"
        - "name: ãƒãƒ£ãƒ³ãƒãƒ«å"
        - "type: text/voice/forum"
        - "category: ã‚«ãƒ†ã‚´ãƒªå"
        - "purpose: ç”¨é€”èª¬æ˜"

    role_structure:
      attributes:
        - "id: Role ID"
        - "name: ãƒ­ãƒ¼ãƒ«å"
        - "level: 1-5"
        - "requirements: å–å¾—æ¡ä»¶"

    webhook_structure:
      attributes:
        - "channelId: é€ä¿¡å…ˆChannel ID"
        - "webhookUrl: Webhook URL"
        - "triggerEvents: ãƒˆãƒªã‚¬ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆ"

    relations:
      - "R28: notified-from â† Issue"
      - "R29: posted-from â† Agent"
      - "R30: announced-from â† QualityReport"
      - "R31: announced-from â† PR"
      - "R32: notified-from â† Deployment"
      - "R33: notification-triggered-by â† Label"
      - "R34: notified-from â† Escalation"
      - "R35: integrated-with â† Command"

    implementation:
      documentation: "docs/DISCORD_COMMUNITY_PLAN.md"
      issue: "#52 - Create Discord server and launch community"
      type_definition: "agents/types/index.ts (è¿½åŠ äºˆå®š)"

  # E14: SubIssue - Hierarchical Issue
  E14_SubIssue:
    id: "E14"
    name: "SubIssue"
    type: "Hierarchical Issue"
    description: "éšå±¤çš„Issueï¼ˆè¦ªå­é–¢ä¿‚ã‚µãƒãƒ¼ãƒˆï¼‰"

    extends: "E1_Issue"

    attributes:
      hierarchy:
        - name: "parentIssueNumber"
          type: "number"
          description: "è¦ªIssueç•ªå·ï¼ˆãƒ«ãƒ¼ãƒˆã®å ´åˆundefinedï¼‰"
          required: false
        - name: "childIssueNumbers"
          type: "number[]"
          description: "ç›´æ¥ã®å­Issueç•ªå·"
          required: true
          default: "[]"
        - name: "hierarchyLevel"
          type: "number"
          description: "éšå±¤ãƒ¬ãƒ™ãƒ«ï¼ˆ0=root, 1=first level, ...ï¼‰"
          required: true

      relationships:
        - name: "siblingIssueNumbers"
          type: "number[]"
          description: "åŒãƒ¬ãƒ™ãƒ«ã®å…„å¼ŸIssue"
          required: true
          default: "[]"
        - name: "ancestorPath"
          type: "number[]"
          description: "ãƒ«ãƒ¼ãƒˆã‹ã‚‰ç¾åœ¨ã¾ã§ã®ãƒ‘ã‚¹"
          example: "[root, parent, current]"
          required: true

      metadata:
        - name: "isLeaf"
          type: "boolean"
          description: "å­ãŒãªã„ï¼ˆãƒªãƒ¼ãƒ•ãƒãƒ¼ãƒ‰ï¼‰"
          required: true
        - name: "isRoot"
          type: "boolean"
          description: "è¦ªãŒãªã„ï¼ˆãƒ«ãƒ¼ãƒˆãƒãƒ¼ãƒ‰ï¼‰"
          required: true
        - name: "totalDescendants"
          type: "number"
          description: "ç·å­å­«æ•°ï¼ˆå†å¸°ã‚«ã‚¦ãƒ³ãƒˆï¼‰"
          required: true

      progress:
        - name: "completionProgress"
          type: "CompletionProgress"
          description: "å®Œäº†é€²æ—ï¼ˆå­Issueã‹ã‚‰é›†ç´„ï¼‰"
          required: true

    completion_progress_structure:
      attributes:
        - name: "total"
          type: "number"
          description: "ç·å­Issueæ•°"
        - name: "completed"
          type: "number"
          description: "å®Œäº†æ¸ˆã¿å­Issueæ•°"
        - name: "percentage"
          type: "number"
          range: "0-100"
          description: "å®Œäº†ç‡"

    hierarchy_labels:
      - name: "ğŸŒ³ hierarchy:root"
        description: "ãƒ«ãƒ¼ãƒˆIssueï¼ˆè¦ªãªã—ï¼‰"
      - name: "ğŸ“‚ hierarchy:parent"
        description: "å­Issueã‚’æŒã¤"
      - name: "ğŸ“„ hierarchy:child"
        description: "è¦ªIssueã‚’æŒã¤"
      - name: "ğŸƒ hierarchy:leaf"
        description: "å­Issueãªã—ï¼ˆãƒªãƒ¼ãƒ•ãƒãƒ¼ãƒ‰ï¼‰"

    use_cases:
      - "ã‚¨ãƒ”ãƒƒã‚¯åˆ†è§£: å¤§è¦æ¨¡æ©Ÿèƒ½ã‚’è¤‡æ•°ã®å­Issueã«åˆ†è§£"
      - "é€²æ—ç®¡ç†: è¦ªIssueã§å…¨ä½“ã®å®Œäº†ç‡ã‚’è‡ªå‹•è¿½è·¡"
      - "ä¾å­˜é–¢ä¿‚ç®¡ç†: éšå±¤çš„ãªã‚¿ã‚¹ã‚¯ä¾å­˜ã‚’æ˜ç¤ºåŒ–"
      - "çµ„ç¹”åŒ–: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è«–ç†çš„ãªéšå±¤ã§æ•´ç†"

    relations:
      - "R36: parent-of â† Issue (1:N)"
      - "R37: child-of â†’ Issue (N:1)"
      - "R38: sibling-of â†” SubIssue (N:N)"
      - "R39: tracked-by â†’ Label (N:N)"

    implementation:
      type_definition: "packages/coding-agents/types/index.ts:67-114"
      agent: "packages/coding-agents/issue/issue-agent.ts"
      methods: ["createSubIssue", "fetchIssueHierarchy"]
      labels: "docs/guides/LABEL_SYSTEM_GUIDE.md (HIERARCHY Labels)"

# Summary Statistics
metadata:
  total_entities: 14
  coding_agents: 7
  business_agents: 14
  total_agents: 21
  total_labels: 57
  label_categories: 11
  total_relations: 39

  entity_categories:
    core_workflow: ["E1_Issue", "E2_Task", "E3_Agent", "E4_PR"]
    quality_control: ["E6_QualityReport", "E5_Label"]
    execution: ["E7_Command", "E8_Escalation", "E9_Deployment"]
    infrastructure: ["E11_DAG", "E12_Worktree", "E10_LDDLog"]
    community: ["E13_DiscordCommunity", "E14_SubIssue"]

  completion_status:
    implemented: 14
    in_progress: 0
    planned: 0
