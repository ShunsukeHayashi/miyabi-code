# Plans for Issue #614

**Title**: feat: Agentè¨­å®šç®¡ç†CLIã®å®Ÿè£… (miyabi agent list/config/edit)

**URL**: https://github.com/customer-cloud/miyabi-private/issues/614

---

## ğŸ“‹ Summary

- **Total Tasks**: 4
- **Estimated Duration**: 60 minutes
- **Execution Levels**: 4
- **Has Cycles**: âœ… No

## ğŸ“ Task Breakdown

### 1. Analyze requirements for #614

- **ID**: `task-614-analysis`
- **Type**: Docs
- **Assigned Agent**: IssueAgent
- **Priority**: 0
- **Estimated Duration**: 5 min

**Description**: Analyze issue requirements and create detailed specification

### 2. Implement solution for #614

- **ID**: `task-614-impl`
- **Type**: Feature
- **Assigned Agent**: CodeGenAgent
- **Priority**: 1
- **Estimated Duration**: 30 min
- **Dependencies**: task-614-analysis

**Description**: # Agentè¨­å®šç®¡ç†CLIã®å®Ÿè£…

**Parent Issue**: #612 (Epic: KAMUI 4Dè¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³çµ±åˆ)
**Phase**: Phase 1 - åŸºç›¤æ•´å‚™
**Priority**: âš ï¸ P1-High
**Estimated Time**: 3-5 days

## ğŸ“‹ æ¦‚è¦

21å€‹ã®Miyabi Agentï¼ˆCoding 7 + Business 14ï¼‰ã‚’çµ±ä¸€çš„ã«ç®¡ç†ã™ã‚‹CLIã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹ã€‚KAMUI 4Dã®`agent-config-service.js`ã®è¨­è¨ˆã‚’å‚è€ƒã«ã€Agentä¸€è¦§è¡¨ç¤ºã€è¨­å®šç¢ºèªã€è¨­å®šç·¨é›†æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã€‚

## ğŸ¯ ç›®æ¨™

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§å…¨Agentã‚’åŠ¹ç‡çš„ã«ç®¡ç†ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼š

```bash
miyabi agent list                        # Agentä¸€è¦§è¡¨ç¤º
miyabi agent config CoordinatorAgent     # è¨­å®šç¢ºèª
miyabi agent edit CoordinatorAgent       # è¨­å®šç·¨é›†
miyabi agent create MyCustomAgent        # ã‚«ã‚¹ã‚¿ãƒ Agentä½œæˆ
```

## ğŸ“Š è¦ä»¶

### å¿…é ˆè¦ä»¶

- [ ] `miyabi agent list` - å…¨21å€‹ã®Agentä¸€è¦§è¡¨ç¤º
- [ ] `miyabi agent config <name>` - Agentè¨­å®šè¡¨ç¤º
- [ ] `miyabi agent edit <name>` - Agentè¨­å®šç·¨é›†ï¼ˆã‚¨ãƒ‡ã‚£ã‚¿èµ·å‹•ï¼‰
- [ ] Agentè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ¤œå‡º
  - `.miyabi/agents/*.toml`
  - `~/.config/miyabi/agents/*.toml`
  - ç’°å¢ƒå¤‰æ•° `MIYABI_AGENT_CONFIG_PATH`
- [ ] AgentçŠ¶æ…‹ã®è¡¨ç¤ºï¼ˆæœ‰åŠ¹/ç„¡åŠ¹ï¼‰
- [ ] Agentä¾å­˜é–¢ä¿‚ã®è¡¨ç¤º

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¦ä»¶

- [ ] `miyabi agent create` - ã‚«ã‚¹ã‚¿ãƒ Agentä½œæˆ
- [ ] `miyabi agent validate` - è¨­å®šæ¤œè¨¼
- [ ] `miyabi agent export` - è¨­å®šã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- [ ] `miyabi agent import` - è¨­å®šã‚¤ãƒ³ãƒãƒ¼ãƒˆ

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: Rust 2021 Edition
- **Crate**: `miyabi-cli`, `miyabi-agents`
- **ä¾å­˜**: `clap`, `toml`, `serde`, `dirs`

## ğŸ“ è¨­è¨ˆ

### Agentè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```toml
# .miyabi/agents/CoordinatorAgent.toml

[agent]
name = "CoordinatorAgent"
type = "coordinator"
enabled = true
model = "claude-sonnet-4"
description = "ã‚¿ã‚¹ã‚¯çµ±æ‹¬ãƒ»DAGåˆ†è§£Agent"

[parameters]
max_tasks = 10
timeout = 3600
max_retries = 3

[skills]
rust-development = { enabled = true }
git-workflow = { enabled = true }
debugging-troubleshooting = { enabled = false }

[dependencies]
requires = []
provides = ["task-coordination", "dag-decomposition"]
```

### CLIå‡ºåŠ›ã‚¤ãƒ¡ãƒ¼ã‚¸

#### `miyabi agent list`

```
Miyabi Agent List (21 agents)

Coding Agents (7):
  âœ… CoordinatorAgent       - ã‚¿ã‚¹ã‚¯çµ±æ‹¬ãƒ»DAGåˆ†è§£
  âœ… CodeGenAgent           - ã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆClaude Sonnet 4ï¼‰
  âœ… ReviewAgent            - å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ100ç‚¹æº€ç‚¹ï¼‰
  âœ… IssueAgent             - Issueåˆ†æãƒ»ãƒ©ãƒ™ãƒ«ä»˜ä¸
  âœ… PRAgent                - Pull Requestä½œæˆ
  âœ… DeploymentAgent        - CI/CDãƒ‡ãƒ—ãƒ­ã‚¤
  âš ï¸  RefresherAgent        - IssueçŠ¶æ…‹ç›£è¦–ï¼ˆæœªè¨­å®šï¼‰

Business Agents (14):
  âœ… AIEntrepreneurAgent    - AIèµ·æ¥­å®¶æ”¯æ´
  âœ… ProductConceptAgent    - ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚³ãƒ³ã‚»ãƒ—ãƒˆè¨­è¨ˆ
  âœ… ProductDesignAgent     - ã‚µãƒ¼ãƒ“ã‚¹è©³ç´°è¨­è¨ˆ
  ...

Custom Agents (0):
  (ã‚«ã‚¹ã‚¿ãƒ Agentãªã—)

Legend: âœ… Active | âš ï¸ Not Configured | âŒ Disabled
```

#### `miyabi agent config CoordinatorAgent`

```
Agent Configuration: CoordinatorAgent

Name:         CoordinatorAgent
Type:         coordinator
Status:       âœ… Active
Model:        claude-sonnet-4
Config File:  .miyabi/agents/CoordinatorAgent.toml

Parameters:
  max_tasks:    10
  timeout:      3600s
  max_retries:  3

Skills:
  âœ… rust-development
  âœ… git-workflow
  âŒ debugging-troubleshooting

Dependencies:
  Requires:     (none)
  Provides:     task-coordination, dag-decomposition

Edit: miyabi agent edit CoordinatorAgent
```

### Rustå®Ÿè£…

```rust
// crates/miyabi-cli/src/commands/agent.rs

#[derive(Debug, clap::Parser)]
pub struct AgentCommand {
    #[command(subcommand)]
    subcommand: AgentSubcommand,
}

#[derive(Debug, clap::Subcommand)]
pub enum AgentSubcommand {
    /// List all agents
    List {
        #[arg(long)]
        json: bool,
    },
    /// Show agent configuration
    Config {
        agent_name: String,
    },
    /// Edit agent configuration
    Edit {
        agent_name: String,
        #[arg(long, default_value = "vi")]
        editor: String,
    },
    /// Create custom agent
    Create {
        agent_name: String,
        #[arg(long)]
        template: Option<String>,
    },
}

impl AgentCommand {
    pub async fn execute(&self) -> Result<()> {
        match &self.subcommand {
            AgentSubcommand::List { json } => self.list_agents(*json).await,
            AgentSubcommand::Config { agent_name } => self.show_config(agent_name).await,
            AgentSubcommand::Edit { agent_name, editor } => self.edit_config(agent_name, editor).await,
            AgentSubcommand::Create { agent_name, template } => self.create_agent(agent_name, template).await,
        }
    }
}
```

```rust
// crates/miyabi-agents/src/config.rs

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AgentConfig {
    pub agent: AgentMetadata,
    pub parameters: HashMap<String, serde_json::Value>,
    pub skills: HashMap<String, SkillConfig>,
    pub dependencies: AgentDependencies,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct AgentMetadata {
    pub name: String,
    pub agent_type: AgentType,
    pub enabled: bool,
    pub model: String,
    pub description: String,
}

pub struct AgentConfigManager {
    config_dirs: Vec<PathBuf>,
}

impl AgentConfigManager {
    pub fn new() -> Result<Self>;
    pub fn list_agents(&self) -> Result<Vec<AgentInfo>>;
    pub fn load_config(&self, name: &str) -> Result<AgentConfig>;
    pub fn save_config(&self, name: &str, config: &AgentConfig) -> Result<()>;
    pub fn find_config_file(&self, name: &str) -> Result<Option<PathBuf>>;
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```rust
#[cfg(test)]
mod tests {
    #[test]
    fn test_list_agents() {
        // å…¨Agentä¸€è¦§å–å¾—
    }

    #[test]
    fn test_load_agent_config() {
        // Agentè¨­å®šèª­ã¿è¾¼ã¿
    }

    #[test]
    fn test_save_agent_config() {
        // Agentè¨­å®šä¿å­˜
    }

    #[test]
    fn test_agent_config_validation() {
        // è¨­å®šæ¤œè¨¼
    }
}
```

## ğŸ”— å‚è€ƒãƒªã‚½ãƒ¼ã‚¹

### KAMUI 4Då®Ÿè£…

```javascript
// agent-config-service.js
const AGENT_DEFINITIONS = [
  {
    id: 'codex',
    name: 'Codex CLI',
    envKeys: ['CODEX_CONFIG_PATH'],
    directories: [
      ({ home }) => path.join(home, '.config', 'codex'),
      ({ home }) => path.join(home, '.codex')
    ]
  },
  // ...
];
```

### Miyabiæ—¢å­˜å®Ÿè£…

- `.claude/agents/specs/` - 21å€‹ã®Agentä»•æ§˜
- `.claude/agents/prompts/` - Agentå®Ÿè¡Œãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ

## ğŸ“Š æˆåŠŸæ¡ä»¶

- [ ] `miyabi agent list` ã§å…¨21å€‹ã®AgentãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `miyabi agent config <name>` ã§è¨­å®šãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] `miyabi agent edit <name>` ã§ã‚¨ãƒ‡ã‚£ã‚¿ãŒèµ·å‹•ã™ã‚‹
- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•æ¤œå‡ºãŒå‹•ä½œã™ã‚‹
- [ ] å…¨ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒé€šéã™ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã‚‹

---

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

### 3. Add tests for #614

- **ID**: `task-614-test`
- **Type**: Test
- **Assigned Agent**: CodeGenAgent
- **Priority**: 2
- **Estimated Duration**: 15 min
- **Dependencies**: task-614-impl

**Description**: Create comprehensive test coverage

### 4. Review code quality for #614

- **ID**: `task-614-review`
- **Type**: Refactor
- **Assigned Agent**: ReviewAgent
- **Priority**: 3
- **Estimated Duration**: 10 min
- **Dependencies**: task-614-test

**Description**: Run quality checks and code review

## ğŸ”„ Execution Plan (DAG Levels)

Tasks can be executed in parallel within each level:

### Level 0 (Parallel Execution)

- `task-614-analysis` - Analyze requirements for #614

### Level 1 (Parallel Execution)

- `task-614-impl` - Implement solution for #614

### Level 2 (Parallel Execution)

- `task-614-test` - Add tests for #614

### Level 3 (Parallel Execution)

- `task-614-review` - Review code quality for #614

## ğŸ“Š Dependency Graph

```mermaid
graph TD
    task_614_analysis["Analyze requirements for #614"]
    task_614_impl["Implement solution for #614"]
    task_614_test["Add tests for #614"]
    task_614_review["Review code quality for #614"]
    task_614_analysis --> task_614_impl
    task_614_impl --> task_614_test
    task_614_test --> task_614_review
```

## â±ï¸ Timeline Estimation

- **Sequential Execution**: 60 minutes (1.0 hours)
- **Parallel Execution (Critical Path)**: 10 minutes (0.2 hours)
- **Estimated Speedup**: 6.0x

---

*Generated by CoordinatorAgent on 2025-10-29 23:11:09 UTC*
