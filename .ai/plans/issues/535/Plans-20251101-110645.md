# Plans for Issue #535

**Title**: Task: Axum APIã‚µãƒ¼ãƒãƒ¼å®Ÿè£…ï¼ˆ/chat ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼‰

**URL**: https://github.com/customer-cloud/miyabi-private/issues/535

---

## ğŸ“‹ Summary

- **Total Tasks**: 4
- **Estimated Duration**: 60 minutes
- **Execution Levels**: 4
- **Has Cycles**: âœ… No

## ğŸ“ Task Breakdown

### 1. Analyze requirements for #535

- **ID**: `task-535-analysis`
- **Type**: Docs
- **Assigned Agent**: IssueAgent
- **Priority**: 0
- **Estimated Duration**: 5 min

**Description**: Analyze issue requirements and create detailed specification

### 2. Implement solution for #535

- **ID**: `task-535-impl`
- **Type**: Feature
- **Assigned Agent**: CodeGenAgent
- **Priority**: 1
- **Estimated Duration**: 30 min
- **Dependencies**: task-535-analysis

**Description**: # Task: Axum APIã‚µãƒ¼ãƒãƒ¼å®Ÿè£…

**è¦ªIssue**: #532
**å„ªå…ˆåº¦**: P0
**æœŸé™**: 2æ—¥ä»¥å†…
**æ‹…å½“Agent**: CodeGenAgent

---

## ğŸ¯ ç›®çš„

å‰äººAIã¨ã®å¯¾è©±ã‚’æä¾›ã™ã‚‹REST APIã‚’å®Ÿè£…ã™ã‚‹ã€‚

---

## ğŸ“‹ å®Ÿè£…å†…å®¹

### APIä»•æ§˜
```
POST /api/chat
Content-Type: application/json

Request:
{
  "figure": "oda_nobunaga",
  "message": "æ–°è¦äº‹æ¥­ã®åˆ¤æ–­ã«è¿·ã£ã¦ã„ã¾ã™",
  "user_id": "user_123"
}

Response:
{
  "reply": "ãã®è¿·ã„ã¯ä¸è¦ã§ã‚ã‚ã†ã€‚ã¾ãšã¯...",
  "sources": ["Wikipedia: æ¡¶ç‹­é–“ã®æˆ¦ã„", ...],
  "timestamp": "2025-10-25T12:00:00Z"
}
```

### å®Ÿè£…
```rust
// crates/miyabi-historical-ai/src/api/chat.rs
use axum::{Json, Router};
use serde::{Deserialize, Serialize};

#[derive(Deserialize)]
struct ChatRequest {
    figure: String,
    message: String,
    user_id: String,
}

#[derive(Serialize)]
struct ChatResponse {
    reply: String,
    sources: Vec<String>,
    timestamp: String,
}

async fn chat_handler(
    Json(req): Json<ChatRequest>,
) -> Result<Json<ChatResponse>> {
    // 1. RAGæ¤œç´¢
    let docs = search_knowledge(&req.message, &req.figure, 5).await?;
    
    // 2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰
    let prompt = build_prompt(&req.figure, &req.message, &docs);
    
    // 3. Claude APIå‘¼ã³å‡ºã—
    let reply = call_claude(&prompt).await?;
    
    Ok(Json(ChatResponse {
        reply,
        sources: docs.iter().map(|d| d.title.clone()).collect(),
        timestamp: Utc::now().to_rfc3339(),
    }))
}
```

---

## âœ… å®Œäº†æ¡ä»¶

- [ ] `/api/chat` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå®Ÿè£…
- [ ] Claude APIçµ±åˆ
- [ ] RAGçµ±åˆ
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ  <2ç§’
- [ ] ãƒ†ã‚¹ãƒˆ10ã‚±ãƒ¼ã‚¹Pass

---

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

### 3. Add tests for #535

- **ID**: `task-535-test`
- **Type**: Test
- **Assigned Agent**: CodeGenAgent
- **Priority**: 2
- **Estimated Duration**: 15 min
- **Dependencies**: task-535-impl

**Description**: Create comprehensive test coverage

### 4. Review code quality for #535

- **ID**: `task-535-review`
- **Type**: Refactor
- **Assigned Agent**: ReviewAgent
- **Priority**: 3
- **Estimated Duration**: 10 min
- **Dependencies**: task-535-test

**Description**: Run quality checks and code review

## ğŸ”„ Execution Plan (DAG Levels)

Tasks can be executed in parallel within each level:

### Level 0 (Parallel Execution)

- `task-535-analysis` - Analyze requirements for #535

### Level 1 (Parallel Execution)

- `task-535-impl` - Implement solution for #535

### Level 2 (Parallel Execution)

- `task-535-test` - Add tests for #535

### Level 3 (Parallel Execution)

- `task-535-review` - Review code quality for #535

## ğŸ“Š Dependency Graph

```mermaid
graph TD
    task_535_analysis["Analyze requirements for #535"]
    task_535_impl["Implement solution for #535"]
    task_535_test["Add tests for #535"]
    task_535_review["Review code quality for #535"]
    task_535_analysis --> task_535_impl
    task_535_impl --> task_535_test
    task_535_test --> task_535_review
```

## â±ï¸ Timeline Estimation

- **Sequential Execution**: 60 minutes (1.0 hours)
- **Parallel Execution (Critical Path)**: 10 minutes (0.2 hours)
- **Estimated Speedup**: 6.0x

---

*Generated by CoordinatorAgent on 2025-11-01 11:06:45 UTC*
