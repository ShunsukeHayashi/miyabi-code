<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIYABI GUARDIAN HIERARCHY - 3D Unreal Engine Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            color: #e5e5e5;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        /* Header HUD */
        .hud {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid #10b981;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 0.5em;
            color: #10b981;
            text-shadow: 0 0 20px #10b981;
        }

        .system-status {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* 3D Canvas Container */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Control Panel */
        .control-panel {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 20px;
        }

        .execute-btn {
            background: transparent;
            border: 3px solid #10b981;
            color: #10b981;
            padding: 15px 50px;
            font-size: 1.2rem;
            font-family: inherit;
            font-weight: 900;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .execute-btn:hover {
            background: #10b981;
            color: #000;
            box-shadow: 0 0 30px #10b981;
            transform: scale(1.05);
        }

        .execute-btn:active {
            transform: scale(0.95);
        }

        .execute-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Terminal Log */
        .terminal {
            position: fixed;
            bottom: 40px;
            right: 40px;
            width: 450px;
            max-height: 300px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #10b981;
            padding: 15px;
            font-size: 0.75rem;
            overflow-y: auto;
            z-index: 1000;
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
        }

        .terminal-line {
            color: #10b981;
            margin-bottom: 5px;
            opacity: 0;
            animation: fadeInLine 0.3s ease-out forwards;
        }

        @keyframes fadeInLine {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .terminal-line.guardian { color: #ff0055; }
        .terminal-line.maestro { color: #ffcc00; }
        .terminal-line.orchestra { color: #00ccff; }
        .terminal-line.success { color: #10b981; font-weight: bold; }

        /* Agent Counter */
        .agent-counter {
            position: fixed;
            top: 100px;
            right: 40px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #10b981;
            padding: 20px;
            z-index: 1000;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .agent-counter h3 {
            color: #10b981;
            font-size: 0.9rem;
            letter-spacing: 0.2em;
            margin-bottom: 15px;
            text-align: center;
        }

        .counter-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.85rem;
        }

        .counter-label {
            color: #888;
        }

        .counter-value {
            color: #10b981;
            font-weight: bold;
        }

        /* Loading Screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeOutLoading 1.5s ease-out 2s forwards;
        }

        @keyframes fadeOutLoading {
            to { opacity: 0; pointer-events: none; }
        }

        .loading-text {
            font-size: 1.5rem;
            letter-spacing: 0.5em;
            color: #10b981;
            animation: loadingPulse 1.5s ease-in-out infinite;
            margin-bottom: 30px;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .loading-bar {
            width: 300px;
            height: 4px;
            background: #222;
            position: relative;
            overflow: hidden;
        }

        .loading-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #00ccff);
            width: 0%;
            animation: loadingProgress 2s ease-out forwards;
        }

        @keyframes loadingProgress {
            to { width: 100%; }
        }

        /* Info Panel */
        .info-panel {
            position: fixed;
            top: 100px;
            left: 40px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #10b981;
            padding: 20px;
            z-index: 1000;
            max-width: 350px;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }

        .info-panel h3 {
            color: #10b981;
            font-size: 1rem;
            letter-spacing: 0.2em;
            margin-bottom: 15px;
            border-bottom: 1px solid #10b981;
            padding-bottom: 10px;
        }

        .info-layer {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(16, 185, 129, 0.05);
            border-left: 3px solid #10b981;
        }

        .info-layer-title {
            font-size: 0.9rem;
            color: #10b981;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .info-layer-desc {
            font-size: 0.75rem;
            color: #888;
            line-height: 1.4;
        }

        .info-layer.guardian { border-left-color: #ff0055; }
        .info-layer.guardian .info-layer-title { color: #ff0055; }

        .info-layer.maestro { border-left-color: #ffcc00; }
        .info-layer.maestro .info-layer-title { color: #ffcc00; }

        .info-layer.orchestra { border-left-color: #00ccff; }
        .info-layer.orchestra .info-layer-title { color: #00ccff; }
    </style>
</head>
<body>

<!-- Loading Screen -->
<div class="loading">
    <div class="loading-text">INITIALIZING MIYABI GUARDIAN PROTOCOL...</div>
    <div class="loading-bar">
        <div class="loading-bar-fill"></div>
    </div>
</div>

<!-- HUD -->
<div class="hud">
    <div class="logo">MIYABI GUARDIAN HIERARCHY</div>
    <div class="system-status">
        <div class="status-item">
            <div class="status-dot"></div>
            <span>SYSTEM READY</span>
        </div>
        <div class="status-item">
            <span>AGENTS: <span id="agent-count">21</span></span>
        </div>
    </div>
</div>

<!-- 3D Canvas -->
<canvas id="three-canvas"></canvas>

<!-- Info Panel -->
<div class="info-panel">
    <h3>ARCHITECTURE</h3>
    <div class="info-layer guardian">
        <div class="info-layer-title">LAYER 1: GUARDIAN</div>
        <div class="info-layer-desc">Human commander issuing natural language commands</div>
    </div>
    <div class="info-layer maestro">
        <div class="info-layer-title">LAYER 2: MAESTRO</div>
        <div class="info-layer-desc">CoordinatorAgent translating intent to tasks</div>
    </div>
    <div class="info-layer orchestra">
        <div class="info-layer-title">LAYER 3: ORCHESTRA</div>
        <div class="info-layer-desc">21 Agents: 7 Coding + 14 Business Agents</div>
    </div>
</div>

<!-- Agent Counter -->
<div class="agent-counter">
    <h3>ACTIVE AGENTS</h3>
    <div class="counter-row">
        <span class="counter-label">Guardian:</span>
        <span class="counter-value" id="guardian-count">1</span>
    </div>
    <div class="counter-row">
        <span class="counter-label">Maestro:</span>
        <span class="counter-value" id="maestro-count">1</span>
    </div>
    <div class="counter-row">
        <span class="counter-label">Coding Agents:</span>
        <span class="counter-value" id="coding-count">7</span>
    </div>
    <div class="counter-row">
        <span class="counter-label">Business Agents:</span>
        <span class="counter-value" id="business-count">14</span>
    </div>
    <div class="counter-row" style="border-top: 1px solid #10b981; margin-top: 10px; padding-top: 10px;">
        <span class="counter-label">Total:</span>
        <span class="counter-value" id="total-count">23</span>
    </div>
</div>

<!-- Control Panel -->
<div class="control-panel">
    <button class="execute-btn" id="execute-btn" onclick="executeCommand()">EXECUTE COMMAND</button>
</div>

<!-- Terminal Log -->
<div class="terminal" id="terminal">
    <div class="terminal-line">> System initialized</div>
    <div class="terminal-line">> 3D visualization engine loaded</div>
    <div class="terminal-line">> 21 agents standing by</div>
    <div class="terminal-line">> Awaiting command...</div>
</div>

<!-- Three.js + GSAP from CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
    // 3D Scene Setup
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 10, 50);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 15);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({
        canvas: document.getElementById('three-canvas'),
        antialias: true,
        alpha: true
    });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    // Lighting
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.3);
    scene.add(ambientLight);

    const pointLight1 = new THREE.PointLight(0x10b981, 2, 50);
    pointLight1.position.set(0, 10, 10);
    scene.add(pointLight1);

    const pointLight2 = new THREE.PointLight(0xff0055, 1.5, 40);
    pointLight2.position.set(-10, 5, -5);
    scene.add(pointLight2);

    const pointLight3 = new THREE.PointLight(0x00ccff, 1.5, 40);
    pointLight3.position.set(10, 5, -5);
    scene.add(pointLight3);

    // Grid Floor (Cybertruck style)
    const gridHelper = new THREE.GridHelper(50, 50, 0x10b981, 0x222222);
    gridHelper.position.y = -5;
    scene.add(gridHelper);

    // Layer Objects
    const layers = [];

    // Guardian Layer (Top - Pink)
    const guardianGeometry = new THREE.BoxGeometry(2, 0.3, 2);
    const guardianMaterial = new THREE.MeshPhongMaterial({
        color: 0xff0055,
        emissive: 0xff0055,
        emissiveIntensity: 0.3,
        transparent: true,
        opacity: 0.9
    });
    const guardian = new THREE.Mesh(guardianGeometry, guardianMaterial);
    guardian.position.y = 6;
    scene.add(guardian);
    layers.push({ mesh: guardian, name: 'guardian', color: 0xff0055 });

    // Guardian Edges
    const guardianEdges = new THREE.EdgesGeometry(guardianGeometry);
    const guardianLine = new THREE.LineSegments(guardianEdges, new THREE.LineBasicMaterial({ color: 0xff0055 }));
    guardian.add(guardianLine);

    // Maestro Layer (Middle - Amber)
    const maestroGeometry = new THREE.BoxGeometry(4, 0.3, 4);
    const maestroMaterial = new THREE.MeshPhongMaterial({
        color: 0xffcc00,
        emissive: 0xffcc00,
        emissiveIntensity: 0.3,
        transparent: true,
        opacity: 0.9
    });
    const maestro = new THREE.Mesh(maestroGeometry, maestroMaterial);
    maestro.position.y = 3;
    scene.add(maestro);
    layers.push({ mesh: maestro, name: 'maestro', color: 0xffcc00 });

    const maestroEdges = new THREE.EdgesGeometry(maestroGeometry);
    const maestroLine = new THREE.LineSegments(maestroEdges, new THREE.LineBasicMaterial({ color: 0xffcc00 }));
    maestro.add(maestroLine);

    // Orchestra Layer (Bottom - Cyan)
    const orchestraGeometry = new THREE.BoxGeometry(8, 0.3, 8);
    const orchestraMaterial = new THREE.MeshPhongMaterial({
        color: 0x00ccff,
        emissive: 0x00ccff,
        emissiveIntensity: 0.3,
        transparent: true,
        opacity: 0.9
    });
    const orchestra = new THREE.Mesh(orchestraGeometry, orchestraMaterial);
    orchestra.position.y = 0;
    scene.add(orchestra);
    layers.push({ mesh: orchestra, name: 'orchestra', color: 0x00ccff });

    const orchestraEdges = new THREE.EdgesGeometry(orchestraGeometry);
    const orchestraLine = new THREE.LineSegments(orchestraEdges, new THREE.LineBasicMaterial({ color: 0x00ccff }));
    orchestra.add(orchestraLine);

    // Connection Lines
    const lineMaterial = new THREE.LineBasicMaterial({ color: 0x10b981, transparent: true, opacity: 0.5 });

    const line1Points = [new THREE.Vector3(0, 5.85, 0), new THREE.Vector3(0, 3.15, 0)];
    const line1Geometry = new THREE.BufferGeometry().setFromPoints(line1Points);
    const line1 = new THREE.Line(line1Geometry, lineMaterial);
    scene.add(line1);

    const line2Points = [new THREE.Vector3(0, 2.85, 0), new THREE.Vector3(0, 0.15, 0)];
    const line2Geometry = new THREE.BufferGeometry().setFromPoints(line2Points);
    const line2 = new THREE.Line(line2Geometry, lineMaterial);
    scene.add(line2);

    // Particle System for Agents
    const agentParticles = [];

    function createAgentParticle(x, y, z, color) {
        const geometry = new THREE.SphereGeometry(0.1, 8, 8);
        const material = new THREE.MeshBasicMaterial({ color: color });
        const particle = new THREE.Mesh(geometry, material);
        particle.position.set(x, y, z);
        scene.add(particle);
        return particle;
    }

    // Camera Animation
    let cameraAngle = 0;
    function animateCamera() {
        cameraAngle += 0.001;
        camera.position.x = Math.sin(cameraAngle) * 15;
        camera.position.z = Math.cos(cameraAngle) * 15;
        camera.lookAt(0, 2, 0);
    }

    // Render Loop
    function animate() {
        requestAnimationFrame(animate);

        // Rotate layers slowly
        guardian.rotation.y += 0.005;
        maestro.rotation.y -= 0.003;
        orchestra.rotation.y += 0.002;

        // Animate agent particles
        agentParticles.forEach((p, i) => {
            p.position.y += Math.sin(Date.now() * 0.001 + i) * 0.001;
            p.rotation.x += 0.01;
            p.rotation.y += 0.01;
        });

        animateCamera();
        renderer.render(scene, camera);
    }

    animate();

    // Terminal Logging
    function log(message, type = 'normal') {
        const terminal = document.getElementById('terminal');
        const line = document.createElement('div');
        line.className = `terminal-line ${type}`;
        line.textContent = `> ${message}`;
        terminal.appendChild(line);
        terminal.scrollTop = terminal.scrollHeight;
    }

    // Execute Command Sequence
    async function executeCommand() {
        const btn = document.getElementById('execute-btn');
        btn.disabled = true;

        log('GUARDIAN initiates command...', 'guardian');

        // Guardian activates
        gsap.to(guardian.material, { emissiveIntensity: 1, duration: 0.5, yoyo: true, repeat: 1 });
        gsap.to(guardian.scale, { x: 1.2, y: 1.2, z: 1.2, duration: 0.3, yoyo: true, repeat: 1 });

        await sleep(1000);

        log('Connecting to MAESTRO...', 'normal');
        await sleep(500);

        // Maestro activates
        log('MAESTRO connection established [0.002ms]', 'maestro');
        gsap.to(maestro.material, { emissiveIntensity: 1, duration: 0.5, yoyo: true, repeat: 1 });
        gsap.to(maestro.scale, { x: 1.2, y: 1.2, z: 1.2, duration: 0.3, yoyo: true, repeat: 1 });

        await sleep(1000);

        log('INPUT RECEIVED: "Deploy full orchestra"', 'normal');
        log('MAESTRO: Analyzing intent...', 'maestro');
        log('STRATEGY: PARALLEL EXECUTION', 'maestro');

        await sleep(1000);

        log('Activating ORCHESTRA (21 agents)...', 'orchestra');

        // Orchestra activates
        gsap.to(orchestra.material, { emissiveIntensity: 1, duration: 0.5, yoyo: true, repeat: 1 });
        gsap.to(orchestra.scale, { x: 1.2, y: 1.2, z: 1.2, duration: 0.3, yoyo: true, repeat: 1 });

        await sleep(500);

        // Deploy agents as particles
        log('DEPLOYING CODING AGENTS (7)...', 'orchestra');
        for (let i = 0; i < 7; i++) {
            const angle = (i / 7) * Math.PI * 2;
            const x = Math.cos(angle) * 3;
            const z = Math.sin(angle) * 3;
            const particle = createAgentParticle(x, 0, z, 0x00ffcc);
            agentParticles.push(particle);

            gsap.from(particle.position, { y: 10, duration: 1, ease: 'bounce.out' });
            await sleep(100);
        }

        log('CODING AGENTS: ONLINE', 'success');
        log('  - IssueAgent, CoordinatorAgent, CodeGenAgent', 'orchestra');
        log('  - ReviewAgent, PRAgent, DeploymentAgent, RefresherAgent', 'orchestra');

        await sleep(500);

        log('DEPLOYING BUSINESS AGENTS (14)...', 'orchestra');
        for (let i = 0; i < 14; i++) {
            const angle = (i / 14) * Math.PI * 2;
            const x = Math.cos(angle) * 4.5;
            const z = Math.sin(angle) * 4.5;
            const particle = createAgentParticle(x, 0, z, 0x10b981);
            agentParticles.push(particle);

            gsap.from(particle.position, { y: 10, duration: 1, ease: 'bounce.out' });
            await sleep(70);
        }

        log('BUSINESS AGENTS: ONLINE', 'success');
        log('  - Strategy (6), Marketing (5), Sales/CRM (3)', 'orchestra');

        await sleep(500);

        log('===================================', 'success');
        log('DEPLOYMENT COMPLETE', 'success');
        log('Total: 21 Agents Ready', 'success');
        log('MIYABI ORCHESTRA STANDING BY', 'success');
        log('===================================', 'success');

        btn.disabled = false;
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Window Resize
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Initial camera animation
    gsap.to(camera.position, { y: 8, z: 12, duration: 3, ease: 'power2.out' });

</script>

</body>
</html>