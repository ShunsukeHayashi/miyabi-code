# .miyabirules - Miyabi Project-specific Custom Rules
# Version: 1.0.0
#
# This file defines project-specific coding standards, preferences, and agent behaviors.
# Place this file in your project root to customize Miyabi's behavior.

version: 1

# Coding Standards & Rules
rules:
  - name: "Use async-trait for traits"
    pattern: "trait.*\\{"
    suggestion: "Add #[async_trait] for async methods in traits"
    severity: "warning"
    enabled: true

  - name: "Prefer Result over Option"
    pattern: "fn.*-> Option<"
    suggestion: "Use Result<T, E> for better error context"
    severity: "info"
    enabled: true

# Agent Preferences
agent_preferences:
  codegen:
    style: "idiomatic"
    error_handling: "thiserror"
    async_runtime: "tokio"
    generate_tests: true
    generate_docs: true
    prefer_workspace_deps: true

  review:
    min_score: 85
    clippy_strict: true
    clippy_deny_level: "warnings"
    require_tests: true
    min_coverage: 80
    security_audit: true

  deployment:
    auto_deploy: false
    default_target: "staging"
    auto_rollback: true
    health_check_timeout: 300

  pr:
    auto_create: true
    default_type: "draft"
    commit_format: "conventional"

  coordinator:
    decomposition_strategy: "sequential"
    max_concurrency: 3
    task_timeout: 3600
    auto_assign: true

  issue:
    auto_label: true
    ai_inference: true
    escalation_priority: "P0-Critical"

# Project Context
context:
  description: "Miyabi - Autonomous development framework"
  tech_stack:
    - "Rust 2021 Edition"
    - "Tokio async runtime"
    - "Axum web framework"
  architecture: "modular-monolith"
  conventions:
    - "Follow Rust API Guidelines"
    - "Use thiserror for error handling"

# Escalation Rules
escalation:
  security_issues: true
  breaking_changes: true
  low_quality_threshold: 70
  test_failures: true
  targets:
    security: "CISO"
    architecture: "TechLead"
    business: "ProductOwner"
