# Lark Base 構築フレームワーク - 10コマンドスタック

## 📖 概要

このドキュメントは、Lark Base統合管理システムを段階的に構築するための完全なフレームワークです。
**C1〜C10の10コマンドスタック**により、要件分析からデプロイまでの全プロセスを体系的に実行します。

## 🎯 全体目標

**目標**: {{業界}}{{業務領域}}向けのLark Base統合管理システムを構築する
**出力**: 完全に動作するLark Baseアプリケーション（テーブル、ビュー、ワークフロー、ダッシュボード含む）
**基準**: Lark Base公式ドキュメント、識学理論ベースの設計原則

## 📅 実装計画

### Phase 0: 準備 (3日間)

#### Day 1: 環境セットアップ
- [ ] Lark App作成・認証情報取得
- [ ] MCP Server構築・テスト
- [ ] Wiki空間作成
- [ ] 開発環境確認

#### Day 2: データ準備
- [ ] 既存データの整理・分析
- [ ] マスターデータの定義
- [ ] トランザクションデータの定義
- [ ] データ移行計画作成

#### Day 3: 設計レビュー
- [ ] 要件定義書の確認
- [ ] ER図の作成
- [ ] 画面遷移図の作成
- [ ] ステークホルダー承認

### Phase 1: 基盤構築 (2週間)

#### Week 1: テーブル作成
- [ ] マスターテーブル作成（5-10テーブル）
- [ ] トランザクションテーブル作成（5-10テーブル）
- [ ] 主キーフィールド設定
- [ ] 基本フィールド設定

#### Week 2: リレーション設定
- [ ] テーブル間リンク作成（双方向）
- [ ] Lookupフィールド作成
- [ ] Rollupフィールド作成
- [ ] リレーション検証

### Phase 2: 自動化 (1週間)

#### Day 15-16: アラート設定
- [ ] 期限超過アラート
- [ ] ステータス変更通知
- [ ] 承認リクエスト通知

#### Day 17-18: プロセス自動化
- [ ] 承認ワークフロー
- [ ] 自動フィールド更新
- [ ] 連動処理設定

#### Day 19-21: ボタン実装
- [ ] ワンクリック作成ボタン
- [ ] 外部連携ボタン
- [ ] バッチ処理ボタン

### Phase 3: 最適化 (1週間)

#### Day 22-23: ビュー最適化
- [ ] グリッドビュー作成（各テーブル）
- [ ] かんばんビュー作成（必要箇所）
- [ ] カレンダービュー作成（スケジュール）
- [ ] ビューフィルター・ソート設定

#### Day 24-25: ダッシュボード作成
- [ ] KPIカード作成（5-10個）
- [ ] グラフ作成（5-10個）
- [ ] アクションテーブル作成

#### Day 26-28: 最終調整
- [ ] UI/UX改善
- [ ] パフォーマンス最適化
- [ ] ドキュメント作成

### Phase 4: 運用開始 (1週間)

#### Day 29-30: 権限設定
- [ ] ロール定義
- [ ] テーブル権限設定
- [ ] フィールド権限設定

#### Day 31-33: テスト・検証
- [ ] 単体テスト
- [ ] 統合テスト
- [ ] パフォーマンステスト

#### Day 34-35: デプロイ
- [ ] データ移行
- [ ] ユーザー設定
- [ ] 本番稼働

## 🚀 10コマンドスタック

### C1: システム分析

#### 目的
システム要件を分析し、Lark Baseの構造に落とし込む

#### タスク

**T1: 要件定義**
```
入力:
- ビジネス要件書
- 業務フロー図
- ステークホルダーヒアリング結果

処理:
- 管理対象の特定（マスター/トランザクション）
- 必要なフィールドの洗い出し
- リレーションシップの特定
- 権限要件の整理

出力:
- 要件定義書
- テーブル一覧
- フィールド一覧
- リレーション図
```

**T2: データ構造設計**
```
入力:
- 要件定義書
- 既存データサンプル

処理:
- ER図作成
- 正規化検討
- 主キー設計
- リレーションシップ設計

出力:
- ER図
- テーブル設計書
- フィールド設計書
```

#### 成果物
- [ ] 要件定義書
- [ ] ER図
- [ ] テーブル設計書（全テーブル）
- [ ] フィールド設計書（全フィールド）

#### チェックポイント
- [ ] 全ての業務要件が網羅されているか
- [ ] テーブル間の関係が明確か
- [ ] 主キー設計が適切か（識別性・可視性）
- [ ] ステークホルダーの承認を得たか

### C2: フィールド実装

#### 目的
各テーブルのフィールドを詳細設計・実装

#### タスク

**T0: 主キーフィールド設定（最優先）**
```
Critical: 主キーは常に最左端に配置

パターン1: 直接入力型
- マスターデータ: "会社名", "商品コード"
- 手動入力で一意性を保証

パターン2: 数式生成型
- トランザクションデータ: "YY月DD日-山田太郎-新規"
- 数式で動的に生成し一意性を保証

主キー設計の3原則:
1. 識別性: レコードを一意に識別できる
2. 可視性: リレーション先で内容が分かる
3. 左端配置: 常にテーブルの最左端フィールド
```

**T1: マスターフィールド**
```
基本情報フィールド:
- 名称・コード系: Text型
- 分類・区分系: Single Select型
- 属性・タグ系: Multi Select型
- 担当者系: User型

識学理論準拠フィールド:
- 👤作成者: User型
- 👥担当者: User型
- 👑承認者: User型
- 🎯最終責任者: User型
```

**T2: トランザクションフィールド**
```
実績・数値フィールド:
- 金額系: Currency型
- 数量系: Number型
- 期日系: Date/DateTime型
- 達成率系: Percentage型

ステータスフィールド:
- 識学理論準拠の番号プレフィックス
- 色分けルールに基づく色設定
- 階層と責任を明確にした選択肢
```

**T3: 計算フィールド**
```
Formula型フィールド:
- 主キー生成: CONCATENATE関数
- 達成率計算: 実績 / 目標 × 100
- 期限判定: IF(TODAY() > 期限, "超過", "期限内")
- 累計計算: SUM関数（Rollup）

Lookup型フィールド:
- リレーション先の情報を参照
- マスター情報の自動取得

Rollup型フィールド:
- 関連レコードの集計
- 売上合計、件数カウント等
```

#### 成果物
- [ ] 全テーブルの主キーフィールド
- [ ] 全テーブルの基本フィールド
- [ ] 全テーブルの計算フィールド
- [ ] フィールド命名規則チェックリスト

#### チェックポイント
- [ ] 主キーフィールドが最左端に配置されているか
- [ ] 主キーがリレーション先で識別可能か
- [ ] フィールド名が識学理論に準拠しているか
- [ ] 色分けルールが適用されているか

### C3: リレーション設定

#### 目的
テーブル間の双方向リンクを設定

#### タスク

**T0: リレーション可視性チェック（最優先）**
```
Critical: リレーション設定直後に必ず実行

チェック項目:
1. リレーション先テーブルでレコード内容が識別できるか
   - 主キーフィールドの内容が表示されているか
   - 識別情報が十分か

2. リレーション元テーブルで対象が選択しやすいか
   - ドロップダウンで見やすい表示になっているか
   - 検索しやすい命名になっているか

3. 双方向リンクが正常に機能しているか
   - 元→先のリンクが機能するか
   - 先→元の逆リンクが自動生成されているか

修正方法:
- 主キーフィールドの内容を改善
- Lookup/Formula で表示情報を追加
- フィールド名を分かりやすく変更
```

**T1: テーブル準備**
```
前提条件:
- 全テーブルの主キーフィールドが設定済み
- 主キーが最左端に配置済み

リレーション対象の特定:
- マスター → トランザクション
- トランザクション → トランザクション
- 多対多の中間テーブル
```

**T2: 双方向リンク作成**
```
手順:
1. リレーション元テーブルでLink型フィールド作成
2. リレーション先テーブルを選択
3. 双方向リンクを有効化
4. リレーション先に逆リンクフィールドが自動生成される
5. T0の可視性チェックを実行

命名規則:
- 単方向: "関連{{テーブル名}}"
- 双方向: "{{テーブル名}}" / "{{元テーブル名}}（逆リンク）"

例:
- "顧客管理" テーブル
  ↕️ 双方向リンク
- "案件管理" テーブル
  - リンクフィールド: "顧客"
  - 逆リンクフィールド: "案件（顧客管理）"
```

**T3: Lookup/Rollup作成**
```
Lookup（参照）:
- リレーション先の情報を表示
- "顧客名", "顧客ランク", "担当営業"等

Rollup（集計）:
- リレーション先の集計値を表示
- "案件数", "売上合計", "平均単価"等

活用例:
- 顧客管理テーブル
  - Rollup: "案件数" = COUNT(案件管理)
  - Rollup: "総売上" = SUM(案件管理.受注金額)
```

#### 成果物
- [ ] 全テーブル間の双方向リンク
- [ ] Lookupフィールド（必要箇所）
- [ ] Rollupフィールド（集計箇所）
- [ ] リレーション検証レポート

#### チェックポイント
- [ ] リレーション設定直後に可視性チェックを実施したか
- [ ] リレーション先で主キー内容が識別可能か
- [ ] 双方向リンクが正常に機能しているか
- [ ] Lookupで必要な情報が参照できているか
- [ ] Rollupで正確な集計ができているか

### C4: ワークフロー自動化

#### 目的
自動化ワークフローを構築

#### タスク

**T1: アラートワークフロー**
```
用途: 期限超過、ステータス変更等の通知

トリガー:
- レコード作成時
- フィールド更新時
- 定期実行

アクション:
- 通知送信（Lark メッセージ）
- フィールド更新
- ログ記録

実装例:
- 期限超過アラート
  トリガー: 定期実行（毎日9時）
  条件: TODAY() > 期限 AND ステータス != "完了"
  アクション: 担当者にメッセージ送信
```

**T2: 承認ワークフロー**
```
用途: 階層的な承認プロセス

フロー:
1. 申請者が申請
2. 主任が確認
3. 課長が審査
4. 部長が承認
5. 承認完了 or 却下

実装:
- ステータス: 識学理論準拠の番号プレフィックス
  00.申請中 → 01.主任確認中 → 02.課長審査中 → 03.部長承認中 → 04.承認完了
- 権限: 各階層の担当者のみが次のステータスに変更可能
- 通知: ステータス変更時に次の担当者に自動通知
```

**T3: プロセスワークフロー**
```
用途: 業務プロセスの自動化

例1: 受注時の自動処理
トリガー: ステータスが "受注確定" に変更
アクション:
- プロジェクト管理テーブルに新規レコード作成
- 売上管理テーブルに実績記録
- 担当PMに通知送信

例2: 完了時の自動集計
トリガー: ステータスが "完了" に変更
アクション:
- 完了日を自動記入
- 処理時間を計算
- KPI管理テーブルを更新
```

#### 成果物
- [ ] アラートワークフロー（5-10個）
- [ ] 承認ワークフロー（1-3個）
- [ ] プロセスワークフロー（3-5個）

#### チェックポイント
- [ ] ワークフローが正常に動作するか
- [ ] 通知が正しい担当者に届くか
- [ ] 自動更新が正確に実行されるか
- [ ] エラーハンドリングが適切か

### C5: ボタン実装

#### 目的
アクションボタンを設定

#### タスク

**T1: ワンクリック作成ボタン**
```
用途: 関連レコードの即座作成

実装例:
- "案件作成" ボタン（顧客管理テーブル）
  機能: 現在の顧客に紐づく新規案件を作成
  処理:
    1. 案件管理テーブルに新規レコード作成
    2. 顧客リンクを自動設定
    3. 顧客名・担当営業を自動コピー
```

**T2: 外部連携ボタン**
```
用途: 外部サービスとの連携

実装例:
- "Googleマップで開く" ボタン
  機能: 住所をGoogleマップで表示
  URL: https://www.google.com/maps/search/?api=1&query={{住所}}

- "メール送信" ボタン
  機能: メーラーを起動
  URL: mailto:{{メールアドレス}}?subject={{件名}}
```

**T3: バッチ処理ボタン**
```
用途: 関連レコードの一括更新

実装例:
- "全案件ステータス更新" ボタン（顧客管理テーブル）
  機能: 関連する全案件のステータスを一括変更
  処理:
    1. 関連案件レコードを取得
    2. 各レコードのステータスを更新
    3. 更新件数をログに記録
```

#### 成果物
- [ ] ワンクリック作成ボタン（3-5個）
- [ ] 外部連携ボタン（2-3個）
- [ ] バッチ処理ボタン（1-2個）

#### チェックポイント
- [ ] ボタンが正常に動作するか
- [ ] 作成されるレコードの内容が正しいか
- [ ] 外部連携URLが正しいか
- [ ] バッチ処理が正確に実行されるか

### C6: ビュー作成

#### 目的
各種ビューを作成・設定

#### タスク

**T1: グリッドビュー**
```
用途: データ一覧、詳細確認、一括編集

設定:
- フィルター: 必要なレコードのみ表示
- ソート: 主キー or 更新日時で並び替え
- グループ化: ステータス or カテゴリでグループ化
- 列の表示/非表示: 必要な情報のみ表示

実装例:
- "進行中案件" ビュー（案件管理テーブル）
  フィルター: ステータス != "完了" AND ステータス != "失注"
  ソート: 期限（昇順）
  グループ化: 担当営業
```

**T2: かんばんビュー**
```
用途: プロセス管理、ステータス管理

設定:
- グループ化フィールド: ステータス
- カード表示: 主キー + 主要情報3-5項目
- ソート: 優先度 or 期限

実装例:
- "営業プロセス" ビュー（案件管理テーブル）
  グループ化: ステータス
    00.リード獲得 | 01.初回アポ | 02.ニーズ確認 | ... | 06.受注
  カード表示: 会社名、担当営業、金額、期限
```

**T3: カレンダービュー**
```
用途: スケジュール管理、期日管理

設定:
- 日付フィールド: 期限 or 実施日
- カード表示: 主キー + 担当者
- 色分け: ステータス or 優先度

実装例:
- "期限管理" ビュー（タスク管理テーブル）
  日付フィールド: 期限
  カード表示: タスク名、担当者
  色分け: 優先度（緊急=赤、高=オレンジ、中=黄色、低=緑）
```

#### 成果物
- [ ] グリッドビュー（各テーブル 2-5個）
- [ ] かんばんビュー（必要箇所 1-3個）
- [ ] カレンダービュー（スケジュール 1-2個）

#### チェックポイント
- [ ] ビューが業務フローに沿っているか
- [ ] フィルター・ソートが適切か
- [ ] 必要な情報が表示されているか
- [ ] 色分けが見やすいか

### C7: ダッシュボード作成

#### 目的
分析ダッシュボードを構築

#### 構成

**3層構造**:
```
┌─────────────────────────────────┐
│ KPIカード層（上段）               │
│ - 重要指標の即座表示              │
│ - 目標達成状況のリアルタイム表示  │
└─────────────────────────────────┘
┌─────────────────────────────────┐
│ グラフ層（中段）                  │
│ - トレンドの可視化                │
│ - 比較分析                        │
└─────────────────────────────────┘
┌─────────────────────────────────┐
│ 詳細テーブル層（下段）            │
│ - ドリルダウン分析                │
│ - アクションアイテム              │
└─────────────────────────────────┘
```

#### タスク

**T1: KPIカード作成**
```
種類:
1. アラート型KPI
   - 期限超過件数
   - 未対応案件数
   - 要注意顧客数

2. 財務KPI
   - 月間売上
   - 累計売上
   - 目標達成率

3. パーセンテージKPI
   - 受注率
   - 顧客満足度
   - プロジェクト進捗率

設定:
- データソース: 該当テーブル
- 集計方法: COUNT, SUM, AVERAGE等
- 表示形式: 数値、パーセンテージ、通貨
- 色分け: 基準値に基づく色変更
```

**T2: グラフ作成**
```
種類:
1. 棒グラフ（縦）
   - 月別売上推移
   - 担当者別実績比較

2. 棒グラフ（横）
   - ランキング表示
   - カテゴリ別比較

3. 折れ線グラフ
   - トレンド分析
   - 時系列変化

4. 円グラフ
   - 構成比分析
   - シェア表示

5. 散布図
   - 相関分析
   - ポートフォリオ分析

6. コンボチャート
   - 複数指標の同時表示
   - 売上と利益率の併記
```

**T3: アクションテーブル**
```
用途: 即座に対応が必要な項目の表示

例:
- 期限超過タスク一覧
- 未対応問い合わせ一覧
- 承認待ち申請一覧

設定:
- フィルター: 緊急度・優先度でフィルタリング
- ソート: 期限・重要度で並び替え
- アクション: ボタンでワンクリック対応
```

#### 成果物
- [ ] KPIカード（5-10個）
- [ ] グラフ（5-10個）
- [ ] アクションテーブル（2-3個）

#### チェックポイント
- [ ] KPIが業務目標に沿っているか
- [ ] グラフが見やすく理解しやすいか
- [ ] アクションテーブルが実用的か
- [ ] ダッシュボード全体のレイアウトが適切か

### C8: 権限設定

#### 目的
階層的な権限を設定

#### タスク

**T1: ロール定義**
```
階層:
- 👑管理者（Admin）: 全権限
- 📊管理職（Manager）: 承認・確認権限
- ✍️編集者（Editor）: 編集権限
- 📝投稿者（Contributor）: 作成権限
- 👁️閲覧者（Viewer）: 閲覧のみ
```

**T2: テーブル権限設定**
```
権限マトリックス:
┌─────────────┬──────┬──────┬──────┬──────┬──────┐
│ テーブル     │ Admin │ Mngr │ Edit │ Cont │ View │
├─────────────┼──────┼──────┼──────┼──────┼──────┤
│ 顧客管理     │  ✅   │  ✅   │  ✅   │  ✅   │  ✅   │
│ 案件管理     │  ✅   │  ✅   │  ✅   │  ✅   │  ✅   │
│ 売上管理     │  ✅   │  ✅   │  ❌   │  ❌   │  ✅   │
│ KPI管理      │  ✅   │  ✅   │  ❌   │  ❌   │  ✅   │
└─────────────┴──────┴──────┴──────┴──────┴──────┘

操作権限:
- ✅ 全操作可能
- 🔸 一部操作可能（自分が作成したレコードのみ編集可）
- ❌ 操作不可（閲覧のみ）
```

**T3: フィールド権限設定**
```
機密情報の保護:
- 金額フィールド: 管理職以上のみ閲覧可
- 評価フィールド: 管理者のみ編集可
- 承認フィールド: 承認者のみ編集可

実装:
- フィールドレベルで権限設定
- ロール別に表示/非表示を制御
- 編集可否を個別に設定
```

#### 成果物
- [ ] ロール定義書
- [ ] テーブル権限マトリックス
- [ ] フィールド権限設定

#### チェックポイント
- [ ] 権限設定が組織階層に沿っているか
- [ ] 機密情報が適切に保護されているか
- [ ] 業務フローが阻害されていないか
- [ ] ユーザーが必要な操作を実行できるか

### C9: テスト・検証

#### 目的
システムの動作確認と検証

#### タスク

**T1: 単体テスト**
```
検証項目:
- 各フィールドの動作確認
- 計算フィールドの正確性
- リレーションの正常動作
- ワークフローの実行確認

チェックリスト:
- [ ] 全フィールドが正しく動作するか
- [ ] Formulaフィールドの計算が正確か
- [ ] Lookupフィールドが正しく参照できるか
- [ ] Rollupフィールドの集計が正確か
```

**T2: 統合テスト**
```
検証項目:
- テーブル間連携の確認
- ワークフロー連鎖の確認
- ボタン動作の確認
- ダッシュボード表示の確認

シナリオテスト:
1. 顧客登録 → 案件作成 → 提案書作成 → 受注確定
2. タスク作成 → 作業実施 → 完了報告 → 承認
3. 期限超過 → アラート通知 → 対応 → 完了

チェックリスト:
- [ ] 業務フローが正常に実行できるか
- [ ] データの整合性が保たれるか
- [ ] 通知が正しく送信されるか
- [ ] ダッシュボードが正確に表示されるか
```

**T3: パフォーマンステスト**
```
検証項目:
- レコード数増加時の動作
- 複雑なFormulaの処理時間
- ダッシュボードの読み込み速度
- 同時アクセス時の挙動

負荷テスト:
- 1,000レコードでの動作確認
- 10,000レコードでの動作確認
- 複数ユーザー同時アクセス

チェックリスト:
- [ ] 大量データでも正常に動作するか
- [ ] 処理速度が許容範囲内か
- [ ] 同時アクセスで問題が発生しないか
```

#### 成果物
- [ ] 単体テスト結果レポート
- [ ] 統合テスト結果レポート
- [ ] パフォーマンステスト結果レポート
- [ ] バグ修正リスト

#### チェックポイント
- [ ] 全ての機能が正常に動作するか
- [ ] 業務フローが実行可能か
- [ ] パフォーマンスが十分か
- [ ] 発見されたバグが修正されたか

### C10: デプロイ

#### 目的
本番環境への展開

#### タスク

**T1: データ移行**
```
手順:
1. 既存データのエクスポート
2. データクレンジング
3. Lark Base形式への変換
4. インポート実行
5. データ検証

注意点:
- バックアップを必ず取得
- 段階的にインポート（テーブル毎）
- リレーションは最後に設定
- インポート後の検証を徹底
```

**T2: ユーザー設定**
```
手順:
1. ユーザーアカウント作成
2. ロール割り当て
3. 権限設定
4. 初期トレーニング実施
5. マニュアル配布

ユーザー教育:
- システム概要説明（30分）
- 基本操作研修（1時間）
- 業務フロー研修（1時間）
- Q&Aセッション（30分）
```

**T3: 本番稼働**
```
手順:
1. 最終確認（全機能の動作確認）
2. ステークホルダー承認
3. 本番切替（段階的 or 一括）
4. 監視体制確立
5. サポート体制確立

監視項目:
- システム稼働状況
- エラー発生状況
- ユーザー問い合わせ対応
- パフォーマンス監視
```

#### 成果物
- [ ] データ移行完了報告
- [ ] ユーザー設定完了報告
- [ ] 本番稼働報告書
- [ ] 運用マニュアル

#### チェックポイント
- [ ] データ移行が正常に完了したか
- [ ] ユーザーが適切に設定されたか
- [ ] 本番稼働の承認を得たか
- [ ] 監視・サポート体制が確立されたか

## 🎯 実行シナリオ

### フル実装
```
C1 → C2 → C3 → C4 → C5 → C6 → C7 → C8 → C9 → C10
```
**期間**: 4-6週間
**用途**: 新規システム構築

### フェーズ実装

#### Phase 1: Foundation
```
C1 → C2 → C3
```
**期間**: 2-3週間
**成果**: 基本的なデータ管理が可能

#### Phase 2: Automation
```
C4 → C5
```
**期間**: 1週間
**成果**: 業務プロセスの自動化

#### Phase 3: Optimization
```
C6 → C7
```
**期間**: 1週間
**成果**: 分析・可視化の実現

#### Phase 4: Operation
```
C8 → C9 → C10
```
**期間**: 1週間
**成果**: 本番稼働

## 📋 チェックリスト統合

### 全体チェックリスト
- [ ] Phase 0: 準備（3日間）完了
- [ ] Phase 1: 基盤構築（2週間）完了
- [ ] Phase 2: 自動化（1週間）完了
- [ ] Phase 3: 最適化（1週間）完了
- [ ] Phase 4: 運用開始（1週間）完了

### 品質チェックリスト
- [ ] 識学理論に準拠した設計か
- [ ] 命名規則が統一されているか
- [ ] リレーションが正常に機能するか
- [ ] ワークフローが正確に動作するか
- [ ] 権限設定が適切か

### 運用チェックリスト
- [ ] ユーザーマニュアルが整備されているか
- [ ] サポート体制が確立されているか
- [ ] 監視体制が確立されているか
- [ ] バックアップ体制が確立されているか

## 📊 効果測定

### 即時効果
- ⏱️ **時間削減**: 手作業→自動化による時間削減率
- 🎯 **エラー削減**: ヒューマンエラーの削減件数
- 🤖 **自動化率**: 自動化されたプロセスの割合

### 長期効果
- 📈 **業務効率**: 業務処理時間の改善率
- ✅ **品質向上**: 品質スコアの向上
- 💰 **財務影響**: コスト削減・収益増加

---

**最終更新**: 2025-10-18
**バージョン**: 1.0.0
**次へ**: [MCP操作マニュアル](mcp-operations.md)
