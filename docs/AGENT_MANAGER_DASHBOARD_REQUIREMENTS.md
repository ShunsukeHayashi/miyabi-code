# 🎨 Agent Manager Dashboard - 要件定義書

**プロジェクト**: Miyabi Agent Management System
**バージョン**: v1.0.0
**作成日**: 2025-10-22
**YouTube LIVE実況**: Agent Managerダッシュボード構築

---

## 🎯 プロジェクト目標

**ミッション**: Agent Manager の10大苦労ポイントを解決する、直感的な3Dダッシュボード

**ターゲットユーザー**:
- Agent Manager（21個のAgentを管理）
- Project Manager（プロジェクト全体を俯瞰）
- Developer（Agent開発者）

---

## 📋 機能要件（6大機能）

### 1️⃣ Agent Status Overview（全Agent状態一覧）

**目的**: 全21個のAgentの現在状態を一目で把握

#### 機能詳細
```
┌───────────────────────────────────────────────────────┐
│ 🤖 Agent Status Overview                              │
├──────────────┬─────────┬──────────┬──────────┬───────┤
│ Agent名      │ Status  │ 現在Task │ キュー   │ CPU   │
├──────────────┼─────────┼──────────┼──────────┼───────┤
│ しきるん     │ 🟢 稼働 │ #270     │ 3        │ 42%   │
│ つくるん     │ 🟢 稼働 │ #271     │ 5        │ 78%   │
│ めだまん     │ 🟡 待機 │ -        │ 0        │ 5%    │
│ はこぶん     │ 🔴 失敗 │ #268     │ 1        │ 0%    │
│ まとめるん   │ 🟢 稼働 │ #272     │ 2        │ 35%   │
└──────────────┴─────────┴──────────┴──────────┴───────┘
```

#### ステータス定義
- 🟢 **稼働中**（Working）: タスク処理中
- 🟡 **待機中**（Idle）: 待機中、キューが空
- 🔴 **エラー**（Failed）: 失敗、要対応
- ⚪ **停止中**（Stopped）: 意図的停止
- 🔵 **起動中**（Starting）: 初期化中

#### UI要素
- リアルタイム更新（1秒間隔）
- クリックで詳細表示
- フィルタ機能（ステータス別、Agent種別）
- ソート機能（名前、負荷、キュー長）

---

### 2️⃣ Real-time 3D Visualization（リアルタイム3D可視化）

**目的**: 複雑なAgent-Task関係を3D空間で直感的に理解

#### 可視化ルール

**Agentの表現**:
```
┌─ Agent球体 ───────────────────────────┐
│ 色   = ステータス                      │
│ サイズ = 負荷（キュー長 + CPU使用率）   │
│ 発光 = 稼働度（明るい = 高負荷）       │
│ 位置 = 役割グループ（リーダー/実行/分析）│
└───────────────────────────────────────┘
```

**Taskの表現**（既存Vector Space Universe）:
```
┌─ Task星 ──────────────────────────────┐
│ 色   = ステータス                      │
│ サイズ = 優先度（P0 > P1 > P2 > P3）  │
│ 発光 = 重要度                          │
│ 位置 = 意味空間（類似タスクが近接）     │
└───────────────────────────────────────┘
```

**Agent-Task接続線**:
```
Agent球体 ━━━━━ Task星
         実線 = 現在処理中
         点線 = キュー待ち
         赤線 = エラー状態
```

#### インタラクション
- マウスホバー: Agent/Task詳細表示
- クリック: モーダルで全情報表示
- ドラッグ: カメラ回転
- スクロール: ズームイン/アウト
- ダブルクリック: Agent/Taskにフォーカス

#### 3D配置戦略
```
       🔴 リーダー層（y=10）
         しきるん, あきんどさん
              │
     🟢 実行役層（y=0）─────────
      つくるん, めだまん, はこぶん等
              │
     🔵 分析役層（y=-5）
      みつけるん, しらべるん等
              │
     🟡 サポート役層（y=-10）
      まとめるん, つなぐん等
```

---

### 3️⃣ Performance Metrics（パフォーマンス指標）

**目的**: Agent効率を定量的に測定・比較

#### 表示指標（Agent毎）

**処理性能**:
- **処理速度**: Tasks/Hour（時間あたり処理タスク数）
- **成功率**: Success Rate（成功/総試行）
- **平均完了時間**: Avg Completion Time
- **総処理タスク数**: Total Tasks Processed

**リソース使用**:
- **CPU使用率**: Current / Peak
- **メモリ使用量**: Current / Max
- **実行時間**: Uptime
- **エラー率**: Error Rate

**コスト効率**:
- **API呼び出し数**: Claude API Calls（CodeGen, Review等）
- **推定コスト**: Estimated Cost（$）
- **ROI**: Return on Investment

#### グラフ表示
```
┌─ CodeGenAgent Performance（過去24時間）─┐
│                                          │
│ 処理速度: 4.2 tasks/hour                │
│ ┌───────────────────────────────┐       │
│ │ ▃▅▇█▇▅▃▂▂▃▅▇█▇▅▃            │ 📈     │
│ └───────────────────────────────┘       │
│                                          │
│ 成功率: 94.3%                            │
│ ████████████████████░░  94%             │
│                                          │
│ 平均完了時間: 14.2分                    │
│ API呼び出し: 1,247回                    │
│ 推定コスト: $12.45                      │
└──────────────────────────────────────────┘
```

#### 比較ビュー
- Agent間の並列比較
- ベンチマークとの比較
- 過去データとのトレンド

---

### 4️⃣ Dependency Graph（依存関係グラフ）

**目的**: タスク依存関係とクリティカルパスの可視化

#### グラフ表示

**DAG（有向非巡回グラフ）**:
```
  Issue #270
      │
      ├─→ Task A (CodeGen) ─┐
      │                      ├─→ Task D (Review) ─→ Task E (Deploy)
      └─→ Task B (Test) ────┤
             │
             └─→ Task C (Doc)
```

**表示要素**:
- ノード = Task（色 = ステータス、サイズ = 優先度）
- エッジ = 依存関係（矢印方向 = 処理順）
- 強調表示 = クリティカルパス（最長経路）
- アニメーション = データフロー（流れる粒子）

#### クリティカルパス分析
```
┌─ Critical Path Analysis ─────────────┐
│ 最長経路: 42分 (3タスク)              │
│                                        │
│ Task A → Task D → Task E               │
│ (15分)   (18分)   (9分)               │
│                                        │
│ ボトルネック: Task D (Review)         │
│ 推奨: ReviewAgentを2並列実行           │
└────────────────────────────────────────┘
```

#### ブロック中タスクの検出
- 依存タスクが未完了
- 必要なAgentが稼働停止
- リソース不足

---

### 5️⃣ Alert System（アラートシステム）

**目的**: 異常・重要イベントの即時通知

#### アラートレベル

**🚨 Critical（緊急）** - 即時対応必須:
- Agentクラッシュ
- デプロイ失敗
- セキュリティ脆弱性検出

**⚠️ Warning（警告）** - 早期対応推奨:
- 高負荷状態（CPU > 80%）
- キュー滞留（Queue > 10）
- 異常な遅延

**💡 Info（情報）** - FYI:
- Agent完了通知
- マイルストーン達成
- リソース最適化提案

#### 通知方法
```
┌─ Alerts Panel ────────────────────────┐
│ 🚨 14:32 DeploymentAgent: Error       │
│    └─ #268 failed (Firebase timeout)  │
│                                        │
│ ⚠️  14:28 CodeGenAgent: High queue    │
│    └─ 8 tasks waiting (avg: 5 min)   │
│                                        │
│ 💡 14:15 ReviewAgent: Idle             │
│    └─ No tasks for 15 minutes        │
└────────────────────────────────────────┘
```

#### 通知チャンネル
- ダッシュボード内ポップアップ
- Discord Webhook（既存統合）
- VOICEVOX音声通知（YouTube LIVE実況）🎤
- メール通知（オプション）

---

### 6️⃣ Resource Optimization（リソース最適化提案）

**目的**: AI駆動の最適化提案で効率向上

#### 提案タイプ

**Agent並列実行**:
```
💡 最適化提案:
   現状: CodeGenAgent x1 (キュー: 8)
   提案: CodeGenAgent x3 (並列実行)
   効果: 処理時間 -67%、完了時刻 30分短縮

   [実行する] [却下]
```

**優先順位調整**:
```
💡 最適化提案:
   Issue #270 (P2) が Issue #271 (P1) をブロック中
   提案: #270を一時的にP1に昇格
   効果: クリティカルパス -12分

   [実行する] [却下]
```

**Agent再配置**:
```
💡 最適化提案:
   DeploymentAgent: 過去3回連続失敗
   提案: Agentを再起動 + ヘルスチェック
   効果: 成功率 +40%（推定）

   [実行する] [却下]
```

**コスト最適化**:
```
💡 最適化提案:
   ReviewAgent: API呼び出し過多（1,500回/日）
   提案: キャッシュ有効化 + バッチ処理
   効果: コスト -35% ($18 → $12/日)

   [実行する] [却下]
```

#### AI推論エンジン
- 過去データからパターン学習
- リアルタイム状態分析
- 複数の最適化案を生成
- 効果予測（推定値）

---

## 🎨 UI/UXコンセプト

### デザイン原則

**1. Glassomorphism（ガラスモーフィズム）**:
- 半透明パネル
- ブラー効果（backdrop-filter: blur(10px)）
- グラデーション境界線

**2. Dark Theme（ダークテーマ）**:
- 背景: #0a0a0a（漆黒）
- 強調色: ネオンブルー、グリーン
- 3D空間が映える

**3. Micro-interactions（マイクロインタラクション）**:
- ホバー時のアニメーション
- スムーズなトランジション
- ローディングスピナー

**4. Responsive Design（レスポンシブ）**:
- Desktop: フル3D体験
- Tablet: 簡易3D + リスト表示
- Mobile: リストビューのみ

### カラーパレット
```
ステータス色:
  🟢 稼働中: #86EFAC (緑)
  🟡 待機中: #FDE047 (黄)
  🔴 エラー: #FCA5A5 (赤)
  ⚪ 停止中: #E5E7EB (グレー)
  🔵 起動中: #60A5FA (青)

アクセント色:
  プライマリ: #3B82F6 (ブルー)
  セカンダリ: #10B981 (グリーン)
  警告: #F59E0B (オレンジ)
  エラー: #EF4444 (レッド)
```

---

## 🚀 技術スタック

### フロントエンド
- **React 18** + **TypeScript 5**
- **Next.js 14** (App Router)
- **React Three Fiber** (3D描画)
- **@react-three/drei** (Three.jsヘルパー)
- **Tailwind CSS** (スタイリング)
- **Framer Motion** (アニメーション)

### バックエンド
- **Rust** (Miyabi Agent SDK)
- **WebSocket** (リアルタイム更新)
- **GraphQL** (データ取得)

### データソース
- Miyabiログファイル（`.ai/logs/`）
- GitHub API（Issues, PRs）
- Agent実行ステータス（Worktree）

---

## 📊 非機能要件

### パフォーマンス
- **初回ロード**: < 2秒
- **リアルタイム更新**: 1秒間隔
- **3Dレンダリング**: 60 FPS
- **データ取得**: < 500ms

### スケーラビリティ
- 100+ Agents対応
- 1000+ Tasks同時表示
- 24時間連続稼働

### アクセシビリティ
- WAI-ARIA準拠
- キーボードナビゲーション
- スクリーンリーダー対応

---

## 🎯 成功指標（KPI）

**Agent Manager満足度**:
- ⭐⭐⭐⭐⭐ 5つ星評価

**効率向上**:
- タスク発見時間: -80%（10分 → 2分）
- エラー対応時間: -70%（30分 → 9分）
- 意思決定時間: -60%（15分 → 6分）

**システム健全性**:
- Agent稼働率: 95%以上
- エラー率: < 5%
- ダッシュボード利用率: 80%以上

---

**次のステップ**: [Phase 3] システム設計 → コンポーネント設計
