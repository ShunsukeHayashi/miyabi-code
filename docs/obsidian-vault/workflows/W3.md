---
title: "Code Implementation (W3)"
created: 2025-11-18
updated: 2025-11-18
author: "Miyabi Auto-Generator"
category: "workflows"
tags: ["miyabi", "workflow", "W3"]
status: "published"
---


# Code Implementation

**ID**: W3
**Trigger**: Task decomposition completed
**Duration**: ~30-120 minutes

## Description

CodeGenAgentがTaskを並列実行し、コードを生成・テストする

## Stages


### Stage 1: Implementation Start

- **Entity**: [[E3_Agent]]
- **Agent**: CodeGenAgent
- **State Label**: `state:implementing`

**Actions**:

- agent:codegen ラベル付与

- state:implementing へ遷移



### Stage 2: Worktree Setup

- **Entity**: [[E12_Worktree]]



**Actions**:

- 並列実行用Worktree作成

- git worktree add .worktrees/issue-{N} -b feature/agent-issue-{N}

- 各TaskをWorktreeに割り当て



### Stage 3: Parallel Execution

- **Entity**: [[E2_Task]]



**Actions**:

- DAGのレベル0（依存なし）を並列実行

- レベル0完了後、レベル1を並列実行

- 以降同様に、依存順序を守りながら並列実行



### Stage 4: Code Generation (per Task)

- **Entity**: [[E3_Agent]]
- **Agent**: CodeGenAgent


**Actions**:

- プロンプトファイル読み込み (.claude/agents/prompts/codegen-agent-prompt.md)

- Claude Sonnet 4によるコード生成

- TypeScript Strict mode対応

- テストコード生成

- コミット作成



### Stage 5: Verification (per Task)





**Actions**:

- pnpm typecheck

- pnpm test

- eslint実行

- 全チェック通過確認



### Stage 6: Integration

- **Entity**: [[E4_PR]]
- **Agent**: PRAgent


**Actions**:

- 全Task完了後、mainブランチにマージ準備

- PR作成（Draft）

- Conventional Commits形式のタイトル生成

- PR本文生成（変更サマリ、テスト結果）



### Stage 7: LDD Logging

- **Entity**: [[E10_LDDLog]]



**Actions**:

- 実行ログ記録 (.ai/logs/YYYY-MM-DD.md)

- Codex Prompt Chain記録

- Tool Invocations記録




## Related Documents

### Uses Entities

- [[../entities/E10|E10: LDDLog]]
- [[../entities/E12|E12: Worktree]]
- [[../entities/E2|E2: Task]]
- [[../entities/E3|E3: Agent]]
- [[../entities/E4|E4: PR]]

### Invokes Agents

- [[../agents/CodeGenAgent|CodeGenAgent]]
- [[../agents/PRAgent|PRAgent]]

### Creates Relations

This workflow activates 26 relations:

- [[../relations/R5|R5: assigned-to]] (E2 → E3)
- [[../relations/R6|R6: depends-on]] (E2 → E2)
- [[../relations/R8|R8: runs-in]] (E2 → E12)
- [[../relations/R9|R9: executes]] (E3 → E2)
- [[../relations/R10|R10: generates]] (E3 → E4)
- [[../relations/R14|R14: logs-to]] (E3 → E10)
- [[../relations/R19|R19: reviewed-by]] (E4 → E3)
- [[../relations/R26|R26: executes]] (E12 → E2)
- [[../relations/R27|R27: creates]] (E12 → E4)
- ... and 16 more

### Related Indexes

- [[INDEX|Workflows Index]] - All workflows
- [[../entities/INDEX|Entities Index]] - All entities
- [[../agents/INDEX|Agents Index]] - All agents
- [[../relations/INDEX|Relations Index]] - All relationships

## Search Tags

#workflow #W3
