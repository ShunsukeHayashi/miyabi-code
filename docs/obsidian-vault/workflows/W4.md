---
title: "Code Review & QA (W4)"
created: 2025-11-18
updated: 2025-11-18
author: "Miyabi Auto-Generator"
category: "workflows"
tags: ["miyabi", "workflow", "W4"]
status: "published"
---


# Code Review & QA

**ID**: W4
**Trigger**: Draft PR created
**Duration**: ~10-20 minutes

## Description

ReviewAgentがコード品質を評価し、QualityReportを生成する

## Stages


### Stage 1: Review Start

- **Entity**: [[E3_Agent]]
- **Agent**: ReviewAgent
- **State Label**: `state:reviewing`

**Actions**:

- agent:review ラベル付与

- state:reviewing へ遷移



### Stage 2: Static Analysis





**Actions**:

- ESLint実行（全ファイル）

- TypeScript compiler実行

- エラー・警告カウント



### Stage 3: Security Scan





**Actions**:

- npm audit実行

- Snyk scan（オプション）

- OWASP Top 10チェック

- 脆弱性カウント



### Stage 4: Test Coverage Analysis





**Actions**:

- Jest coverage report取得

- カバレッジ率計算

- 80%未満の場合、警告



### Stage 5: Quality Scoring

- **Entity**: [[E6_QualityReport]]



**Actions**:

- ESLintスコア計算（40%）

- TypeScriptスコア計算（30%）

- セキュリティスコア計算（20%）

- カバレッジスコア計算（10%）

- 総合スコア算出（100点満点）



### Stage 6: Quality Judgment





**Actions**:

- passed判定（score >= 80）

- quality Label付与（excellent/good/needs-improvement/poor）



### Stage 7: Report Generation

- **Entity**: [[E6_QualityReport]]



**Actions**:

- QualityReport生成

- 推奨事項リスト作成

- PR commentに投稿



### Stage 8: Approval / Rejection





**Actions**:




## Related Documents

### Uses Entities

- [[../entities/E3|E3: Agent]]
- [[../entities/E6|E6: QualityReport]]

### Invokes Agents

- [[../agents/ReviewAgent|ReviewAgent]]

### Creates Relations

This workflow activates 16 relations:

- [[../relations/R11|R11: creates]] (E3 → E6)
- [[../relations/R22|R22: evaluated-by]] (E6 → E3)
- ... and 6 more

### Related Indexes

- [[INDEX|Workflows Index]] - All workflows
- [[../entities/INDEX|Entities Index]] - All entities
- [[../agents/INDEX|Agents Index]] - All agents
- [[../relations/INDEX|Relations Index]] - All relationships

## Search Tags

#workflow #W4
