@startuml
!theme bluegray
title Miyabi Electron App Architecture - Issue #624

skinparam backgroundColor #F8F9FA
skinparam componentStyle rectangle
skinparam titleFontSize 20
skinparam titleFontColor #1D1D1F

' User Interface Layer
package "Renderer Process (React 18)" as renderer #E5F2FF {
  component "Dashboard UI" as dashboard #007AFF
  component "Worktree View" as worktree #5AC8FA
  component "Agent Monitor" as monitor #34C759
  component "Issue Manager" as issueUI #FF9500

  dashboard -[hidden]down-> worktree
  worktree -[hidden]down-> monitor
  monitor -[hidden]down-> issueUI
}

' State Management
package "State Management (Zustand)" as state #FFF3E5 {
  component "App State" as appState #FF9500
  component "Worktree State" as wtState #FFCC00
  component "Agent State" as agentState #FF6B00
}

' IPC Layer
component "IPC Bridge\n(contextBridge + preload)" as ipc #FFE5E5

' Main Process
package "Main Process (Electron 33.2.0)" as main #FFE5E5 {
  component "Window Manager" as winMgr #FF3B30
  component "IPC Handlers" as ipcHandler #FF6B6B
  component "Process Manager" as procMgr #FF9999
}

' Rust Backend
package "Miyabi Rust Backend" as rust #E5FFE5 {
  component "miyabi-cli" as cli #34C759
  component "miyabi-core" as core #52C77F
  component "miyabi-github" as github #70D797
  component "miyabi-worktree" as wt #8EE6AF
  component "miyabi-agents" as agents #ACF5C7
}

' External Services
cloud "GitHub API" as githubAPI #F0F0F0
database "Local Git Repos" as git #F0F0F0

' Connections - Renderer to State
dashboard --> appState : read/write
worktree --> wtState : read/write
monitor --> agentState : read/write
issueUI --> appState : read/write

' State to IPC
appState --> ipc : invoke
wtState --> ipc : invoke
agentState --> ipc : invoke

' IPC to Main
ipc <--> ipcHandler : secure communication

' Main to Process Manager
ipcHandler --> procMgr : spawn/exec

' Process Manager to Rust
procMgr --> cli : child_process.exec

' Rust Internal
cli --> core : use
cli --> github : use
cli --> wt : use
cli --> agents : use

' Rust to External
github --> githubAPI : REST API
wt --> git : git commands
agents --> git : git commands

' Security Boundary
note right of ipc
  **Security**
  ============
  ✅ contextIsolation: true
  ✅ nodeIntegration: false
  ✅ sandbox: true
  ✅ CSP enabled
end note

' Performance Notes
note left of rust
  **Performance**
  ==============
  ⚡ Rust binary: Native speed
  ⚡ Async I/O: Tokio runtime
  ⚡ Parallel execution: Git Worktree
end note

footer Generated by Miyabi えがくん | 2025-10-31
@enduml
