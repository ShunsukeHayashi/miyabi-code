# Miyabi crates.io Publishing Guide

## ğŸ¯ Overview

This guide walks you through publishing all 28 Miyabi crates to crates.io.

## âœ… Pre-Publishing Checklist

### 1. crates.io Account Setup
- [ ] Create account at https://crates.io
- [ ] Verify email address
- [ ] Generate API token: https://crates.io/me
- [ ] Run `cargo login` with your token

### 2. Repository Preparation
- [ ] Ensure all tests pass: `cargo test --all`
- [ ] Verify builds succeed: `cargo build --release --all`
- [ ] Run clippy: `cargo clippy --all -- -D warnings`
- [ ] Check formatting: `cargo fmt --all -- --check`
- [ ] Update CHANGELOG.md
- [ ] Verify LICENSE file exists (Apache-2.0)

### 3. Documentation
- [ ] Each crate has a README.md
- [ ] Each crate has proper doc comments
- [ ] Examples are up-to-date
- [ ] API documentation is complete

### 4. Metadata Verification
- [ ] `Cargo.toml` has correct version (0.1.1)
- [ ] `repository` URL is correct (public repo)
- [ ] `authors` field is set
- [ ] `license` field is set
- [ ] `description` is meaningful
- [ ] `keywords` are relevant (max 5)
- [ ] `categories` are appropriate

## ğŸš€ Publishing Process

### Option 1: Automated (Recommended)

**Dry Run First** (verifies everything without publishing):
```bash
./scripts/publish-to-cratesio.sh all --dry-run
```

**Publish All Crates**:
```bash
./scripts/publish-to-cratesio.sh all
```

**Publish Single Crate**:
```bash
./scripts/publish-to-cratesio.sh miyabi-types
```

### Option 2: Manual Publishing

#### Phase 1: Foundation (No dependencies)
```bash
cd crates/miyabi-types
cargo publish

cd ../miyabi-core
cargo publish
```

#### Phase 2: Core Services
```bash
cd crates/miyabi-llm
cargo publish

cd ../miyabi-github
cargo publish

cd ../miyabi-worktree
cargo publish
```

#### Phase 3-8: Continue in order...
See `scripts/publish-to-cratesio.sh` for complete order.

## ğŸ“¦ Publishing Order

Crates must be published in dependency order:

1. **Phase 1**: miyabi-types, miyabi-core
2. **Phase 2**: miyabi-llm, miyabi-github, miyabi-worktree
3. **Phase 3**: miyabi-knowledge, miyabi-agent-core
4. **Phase 4**: All miyabi-agent-* crates
5. **Phase 5**: miyabi-agents (aggregation)
6. **Phase 6**: miyabi-orchestrator, miyabi-modes, miyabi-cli
7. **Phase 7**: Specialized services (webhook, mcp-server, etc.)
8. **Phase 8**: E2E tests

## ğŸ”§ Troubleshooting

### "crate name already taken"
- Choose a different name or namespace
- Consider prefixing with your username

### "version already exists"
- Bump version in Cargo.toml
- Update workspace.package.version if using workspace inheritance

### "missing required fields"
- Check Cargo.toml has: description, license, repository
- Verify workspace.package fields are inherited correctly

### "rate limit exceeded"
- Wait 30-60 seconds between publishes
- Script automatically adds delays

### "dependency not found"
- Ensure dependencies are published first
- Follow publishing order strictly

## ğŸ“Š Post-Publishing

After publishing:

1. **Verify on crates.io**:
   ```bash
   cargo search miyabi-types
   ```

2. **Test installation**:
   ```bash
   cargo new test-miyabi
   cd test-miyabi
   cargo add miyabi-types
   cargo build
   ```

3. **Update README badges**:
   ```markdown
   [![Crates.io](https://img.shields.io/crates/v/miyabi-types.svg)](https://crates.io/crates/miyabi-types)
   [![Documentation](https://docs.rs/miyabi-types/badge.svg)](https://docs.rs/miyabi-types)
   ```

4. **Announce release**:
   - Update GitHub Release
   - Post on social media
   - Update project documentation

## ğŸ”„ Version Management

### Workspace Version (Current)
All crates share version: **0.1.1**

Defined in root `Cargo.toml`:
```toml
[workspace.package]
version = "0.1.1"
```

### Version Bumping Strategy
- **Patch** (0.1.x): Bug fixes
- **Minor** (0.x.0): New features (backward compatible)
- **Major** (x.0.0): Breaking changes

To bump all crates:
```bash
# Update version in root Cargo.toml [workspace.package]
sed -i '' 's/version = "0.1.1"/version = "0.1.2"/' Cargo.toml

# Verify
cargo check --all
```

## ğŸ“ Notes

- **First publish**: Cannot be yanked, so test thoroughly
- **Private crates**: Set `publish = false` in Cargo.toml
- **Dependencies**: crates.io only accepts published dependencies
- **Documentation**: Auto-generated at docs.rs after publishing
- **Repository**: Must be public for crates.io

## ğŸ”— Resources

- crates.io: https://crates.io
- Publishing guide: https://doc.rust-lang.org/cargo/reference/publishing.html
- API tokens: https://crates.io/me
- Package guidelines: https://doc.rust-lang.org/cargo/reference/manifest.html

---

**Generated by**: Claude Code
**Date**: 2025-11-03
