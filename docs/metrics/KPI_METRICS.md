# Miyabi Orchestra - KPI & ãƒ¡ãƒˆãƒªã‚¯ã‚¹å®šç¾©

**ç›®çš„**: å®Œå…¨è‡ªå¾‹ç¨¼åƒã‚·ã‚¹ãƒ†ãƒ ã®å¥å…¨æ€§ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å®šé‡çš„ã«æ¸¬å®š

---

## ğŸ¯ KPIéšå±¤

```
Level 1: ãƒ“ã‚¸ãƒã‚¹KPIï¼ˆæœ€é‡è¦ï¼‰
  â”œâ”€ è‡ªå¾‹ç¨¼åƒç‡
  â”œâ”€ ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
  â””â”€ ã‚¿ã‚¹ã‚¯æˆåŠŸç‡

Level 2: é‹ç”¨KPI
  â”œâ”€ å¹³å‡å¾©æ—§æ™‚é–“ï¼ˆMTTRï¼‰
  â”œâ”€ Agentç¨¼åƒç‡
  â””â”€ ã‚·ã‚¹ãƒ†ãƒ å¯ç”¨æ€§

Level 3: æŠ€è¡“ãƒ¡ãƒˆãƒªã‚¯ã‚¹
  â”œâ”€ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ 
  â”œâ”€ ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡
  â””â”€ ã‚¨ãƒ©ãƒ¼ç‡
```

---

## ğŸ“Š Level 1: ãƒ“ã‚¸ãƒã‚¹KPI

### KPI 1: è‡ªå¾‹ç¨¼åƒç‡ï¼ˆAutonomous Operation Rateï¼‰

**å®šç¾©**: äººé–“ã®ä»‹å…¥ãªã—ã«ç¨¼åƒã—ãŸæ™‚é–“ã®å‰²åˆ

**è¨ˆç®—å¼**:
```
è‡ªå¾‹ç¨¼åƒç‡(%) = (ç·ç¨¼åƒæ™‚é–“ - äººé–“ä»‹å…¥æ™‚é–“) / ç·ç¨¼åƒæ™‚é–“ Ã— 100
```

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: 50%
- **Phase 2å®Œäº†æ™‚**: 80%
- **Phase 3å®Œäº†æ™‚**: 95%
- **Phase 4å®Œäº†æ™‚**: 99.9%

**æ¸¬å®šæ–¹æ³•**:
- systemdãƒ­ã‚°ã‹ã‚‰ç¨¼åƒæ™‚é–“ã‚’å–å¾—
- Watchdogãƒ­ã‚°ã‹ã‚‰è‡ªå‹•å¾©æ—§å›æ•°ã‚’è¨˜éŒ²
- æ‰‹å‹•ä»‹å…¥ã¯Slackã‚³ãƒãƒ³ãƒ‰ `/miyabi-manual-intervention` ã§è¨˜éŒ²

**è¨±å®¹å€¤**:
- ç›®æ¨™å€¤ Â±5%ä»¥å†…

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: 1æ™‚é–“ã”ã¨

**ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**:
```python
# Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹ä¾‹
miyabi_autonomous_operation_rate{phase="1"} 0.50
miyabi_autonomous_operation_rate{phase="4"} 0.999
```

---

### KPI 2: ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆï¼ˆTask Throughputï¼‰

**å®šç¾©**: å˜ä½æ™‚é–“ã‚ãŸã‚Šã«å‡¦ç†ã•ã‚ŒãŸGitHub Issueã®æ•°

**è¨ˆç®—å¼**:
```
ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ = å‡¦ç†å®Œäº†Issueæ•° / æœŸé–“ï¼ˆæ—¥ï¼‰
```

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: 10 Issues/æ—¥
- **Phase 2å®Œäº†æ™‚**: 30 Issues/æ—¥
- **Phase 3å®Œäº†æ™‚**: 50 Issues/æ—¥
- **Phase 4å®Œäº†æ™‚**: 100 Issues/æ—¥ï¼ˆãƒ”ãƒ¼ã‚¯æ™‚ï¼‰

**æ¸¬å®šæ–¹æ³•**:
- GitHub API: `gh issue list --state closed --search "closed:>YYYY-MM-DD"`
- å‡¦ç†å®Œäº†ãƒ­ã‚°ã‹ã‚‰é›†è¨ˆ

**è¨±å®¹å€¤**:
- ç›®æ¨™å€¤ -20%ä»¥å†…ï¼ˆãƒ”ãƒ¼ã‚¯æ™‚ã¯+50%ã¾ã§è¨±å®¹ï¼‰

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: 1æ—¥ã”ã¨

**ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**:
```python
# Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹ä¾‹
miyabi_task_throughput_daily 50
miyabi_task_throughput_weekly 350
miyabi_task_throughput_monthly 1500
```

---

### KPI 3: ã‚¿ã‚¹ã‚¯æˆåŠŸç‡ï¼ˆTask Success Rateï¼‰

**å®šç¾©**: æ­£å¸¸å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®å‰²åˆ

**è¨ˆç®—å¼**:
```
ã‚¿ã‚¹ã‚¯æˆåŠŸç‡(%) = æˆåŠŸå®Œäº†ã‚¿ã‚¹ã‚¯æ•° / å…¨ã‚¿ã‚¹ã‚¯æ•° Ã— 100
```

**æˆåŠŸã®å®šç¾©**:
- Issue statusãŒ `closed` ã«ãªã£ã¦ã„ã‚‹
- CI/CDãŒå…¨ã¦ãƒ‘ã‚¹ã—ã¦ã„ã‚‹
- PR ãŒãƒãƒ¼ã‚¸ã•ã‚Œã¦ã„ã‚‹

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: 70%
- **Phase 2å®Œäº†æ™‚**: 85%
- **Phase 3å®Œäº†æ™‚**: 95%
- **Phase 4å®Œäº†æ™‚**: 98%

**æ¸¬å®šæ–¹æ³•**:
- GitHub API: Issue/PR statusç¢ºèª
- CI/CDãƒ­ã‚°è§£æ

**è¨±å®¹å€¤**:
- ç›®æ¨™å€¤ -10%ä»¥å†…

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: 1æ—¥ã”ã¨

---

## ğŸ“Š Level 2: é‹ç”¨KPI

### KPI 4: å¹³å‡å¾©æ—§æ™‚é–“ï¼ˆMTTR - Mean Time To Recoveryï¼‰

**å®šç¾©**: éšœå®³ç™ºç”Ÿã‹ã‚‰å¾©æ—§ã¾ã§ã®å¹³å‡æ™‚é–“

**è¨ˆç®—å¼**:
```
MTTR = Î£(å¾©æ—§æ™‚é–“) / éšœå®³ç™ºç”Ÿå›æ•°
```

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: < 10åˆ†
- **Phase 2å®Œäº†æ™‚**: < 5åˆ†
- **Phase 3å®Œäº†æ™‚**: < 2åˆ†
- **Phase 4å®Œäº†æ™‚**: < 1åˆ†

**æ¸¬å®šæ–¹æ³•**:
- Watchdogãƒ­ã‚°: `[CRITICAL]` ã‹ã‚‰ `[RECOVERY]` ã¾ã§ã®æ™‚é–“

**è¨±å®¹å€¤**:
- ç›®æ¨™å€¤ +50%ä»¥å†…

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: éšœå®³ç™ºç”Ÿæ™‚

---

### KPI 5: Agentç¨¼åƒç‡ï¼ˆAgent Utilization Rateï¼‰

**å®šç¾©**: AgentãŒã‚¿ã‚¹ã‚¯å‡¦ç†ä¸­ã®æ™‚é–“å‰²åˆ

**è¨ˆç®—å¼**:
```
Agentç¨¼åƒç‡(%) = Î£(å„Agentã®ãƒ“ã‚¸ãƒ¼æ™‚é–“) / (Agentæ•° Ã— ç·æ™‚é–“) Ã— 100
```

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: 30%
- **Phase 2å®Œäº†æ™‚**: 60%
- **Phase 3å®Œäº†æ™‚**: 80%
- **Phase 4å®Œäº†æ™‚**: 85%

**æ¸¬å®šæ–¹æ³•**:
- ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰å„Agentã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†è¨ˆ
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: `IDLE`, `ACTIVE`, `WORKING`

**è¨±å®¹å€¤**:
- 30% - 95% ã®ç¯„å›²å†…ï¼ˆ95%è¶…ã¯ãƒªã‚½ãƒ¼ã‚¹ä¸è¶³ã®å…†å€™ï¼‰

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: 10ç§’ã”ã¨

---

### KPI 6: ã‚·ã‚¹ãƒ†ãƒ å¯ç”¨æ€§ï¼ˆSystem Availabilityï¼‰

**å®šç¾©**: ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ç¨¼åƒã—ã¦ã„ãŸæ™‚é–“ã®å‰²åˆ

**è¨ˆç®—å¼**:
```
å¯ç”¨æ€§(%) = (ç·æ™‚é–“ - ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ ) / ç·æ™‚é–“ Ã— 100
```

**ç›®æ¨™å€¤**:
- **Phase 1å®Œäº†æ™‚**: 99% ï¼ˆæœˆé–“ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  < 7.2æ™‚é–“ï¼‰
- **Phase 2å®Œäº†æ™‚**: 99.5% ï¼ˆæœˆé–“ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  < 3.6æ™‚é–“ï¼‰
- **Phase 3å®Œäº†æ™‚**: 99.9% ï¼ˆæœˆé–“ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  < 43åˆ†ï¼‰
- **Phase 4å®Œäº†æ™‚**: 99.99% ï¼ˆæœˆé–“ãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ  < 4.3åˆ†ï¼‰

**æ¸¬å®šæ–¹æ³•**:
- systemd serviceãƒ­ã‚°
- Health Checkãƒ­ã‚°

**è¨±å®¹å€¤**:
- ç›®æ¨™å€¤ -0.5%ä»¥å†…

**ãƒ‡ãƒ¼ã‚¿åé›†é »åº¦**: 1åˆ†ã”ã¨

---

## ğŸ“Š Level 3: æŠ€è¡“ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### Metric 1: ã‚¿ã‚¹ã‚¯å‡¦ç†æ™‚é–“ï¼ˆTask Processing Timeï¼‰

**è¨ˆæ¸¬å¯¾è±¡**:
- Issueå‰²ã‚Šå½“ã¦ã‹ã‚‰å®Œäº†ã¾ã§ã®æ™‚é–“

**ç›®æ¨™å€¤**:
- P50: < 30åˆ†
- P90: < 2æ™‚é–“
- P99: < 6æ™‚é–“

**æ¸¬å®šæ–¹æ³•**:
- Task Schedulerãƒ­ã‚° + GitHub API

---

### Metric 2: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼é…å»¶ï¼ˆMessage Queue Latencyï¼‰

**è¨ˆæ¸¬å¯¾è±¡**:
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‹ã‚‰å—ä¿¡ã¾ã§ã®æ™‚é–“

**ç›®æ¨™å€¤**:
- å¹³å‡: < 1ç§’
- P99: < 5ç§’

**æ¸¬å®šæ–¹æ³•**:
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‹ã‚‰è¨ˆç®—

---

### Metric 3: ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨ç‡

**è¨ˆæ¸¬å¯¾è±¡**:
- CPUä½¿ç”¨ç‡
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡
- ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡

**ç›®æ¨™å€¤**:
- CPU: å¹³å‡ < 50%, ãƒ”ãƒ¼ã‚¯ < 80%
- ãƒ¡ãƒ¢ãƒª: å¹³å‡ < 2GB, ãƒ”ãƒ¼ã‚¯ < 4GB
- ãƒ‡ã‚£ã‚¹ã‚¯: < 80%ä½¿ç”¨

**æ¸¬å®šæ–¹æ³•**:
- ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆ`top`, `free`, `df`ï¼‰
- Prometheusãƒãƒ¼ãƒ‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ã‚¿ãƒ¼

---

### Metric 4: ã‚¨ãƒ©ãƒ¼ç‡

**è¨ˆæ¸¬å¯¾è±¡**:
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼
- GitHub APIã‚¨ãƒ©ãƒ¼
- tmuxã‚³ãƒãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç›®æ¨™å€¤**:
- < 1% (å…¨æ“ä½œã«å¯¾ã—ã¦)

**æ¸¬å®šæ–¹æ³•**:
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®é›†è¨ˆ

---

## ğŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Data Collection Layer                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Scripts    â”‚   â”‚   systemd    â”‚   â”‚   GitHub     â”‚    â”‚
â”‚  â”‚   Logs       â”‚   â”‚   Logs       â”‚   â”‚   API        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                  â”‚                  â”‚              â”‚
â”‚         â–¼                  â–¼                  â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚         Metrics Aggregator (Custom Script)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Prometheus Time Series DB              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                           â”‚                                  â”‚
â”‚                           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Grafana Dashboard (Visualize)          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ å®Ÿè£…: Metrics Aggregator

**ãƒ•ã‚¡ã‚¤ãƒ«**: `scripts/miyabi-metrics-aggregator.sh`

```bash
#!/bin/bash
# Miyabi Orchestra - Metrics Aggregation Script

METRICS_DIR="data/metrics"
PROMETHEUS_DIR="/var/lib/prometheus/node-exporter"

mkdir -p "$METRICS_DIR" "$PROMETHEUS_DIR"

# KPI 1: è‡ªå¾‹ç¨¼åƒç‡
calculate_autonomous_rate() {
    local total_time=$(systemctl show miyabi-orchestra -p ActiveEnterTimestamp --value | xargs -I{} date -d "{}" +%s)
    local current_time=$(date +%s)
    local uptime=$((current_time - total_time))

    local manual_interventions=$(grep -c "MANUAL_INTERVENTION" logs/scheduler/*.log 2>/dev/null || echo 0)
    local intervention_time=$((manual_interventions * 300))  # 5åˆ†/å›ã¨ä»®å®š

    local autonomous_time=$((uptime - intervention_time))
    local autonomous_rate=$(echo "scale=4; $autonomous_time / $uptime" | bc)

    echo "miyabi_autonomous_operation_rate $autonomous_rate" > "$PROMETHEUS_DIR/autonomous_rate.prom"
}

# KPI 2: ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ
calculate_task_throughput() {
    local today=$(date +%Y-%m-%d)
    local completed_issues=$(gh issue list --repo "$REPO" --state closed --search "closed:>$today" --json number | jq '. | length')

    echo "miyabi_task_throughput_daily $completed_issues" > "$PROMETHEUS_DIR/task_throughput.prom"
}

# KPI 3: ã‚¿ã‚¹ã‚¯æˆåŠŸç‡
calculate_success_rate() {
    local total_tasks=$(gh issue list --repo "$REPO" --state all --json number | jq '. | length')
    local successful_tasks=$(gh issue list --repo "$REPO" --state closed --label "status:completed" --json number | jq '. | length')

    local success_rate=$(echo "scale=4; $successful_tasks / $total_tasks" | bc)

    echo "miyabi_task_success_rate $success_rate" > "$PROMETHEUS_DIR/success_rate.prom"
}

# KPI 4: MTTR
calculate_mttr() {
    local recovery_times=$(grep "RECOVERY" logs/watchdog/*.log | awk '{print $NF}' | paste -sd+ | bc)
    local recovery_count=$(grep -c "RECOVERY" logs/watchdog/*.log)

    if [[ $recovery_count -gt 0 ]]; then
        local mttr=$(echo "scale=2; $recovery_times / $recovery_count" | bc)
    else
        local mttr=0
    fi

    echo "miyabi_mttr_seconds $mttr" > "$PROMETHEUS_DIR/mttr.prom"
}

# KPI 5: Agentç¨¼åƒç‡
calculate_agent_utilization() {
    # ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ï¼ˆçœç•¥: å®Ÿè£…è©³ç´°ï¼‰
    echo "miyabi_agent_utilization_rate 0.80" > "$PROMETHEUS_DIR/agent_utilization.prom"
}

# ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
while true; do
    calculate_autonomous_rate
    calculate_task_throughput
    calculate_success_rate
    calculate_mttr
    calculate_agent_utilization

    sleep 60  # 1åˆ†ã”ã¨
done
```

---

## ğŸ“Š Grafana Dashboard è¨­å®šä¾‹

```json
{
  "dashboard": {
    "title": "Miyabi Orchestra - Autonomous Operation Dashboard",
    "panels": [
      {
        "title": "è‡ªå¾‹ç¨¼åƒç‡ (Target: 99.9%)",
        "targets": [
          {
            "expr": "miyabi_autonomous_operation_rate * 100"
          }
        ],
        "type": "gauge",
        "thresholds": [
          {"value": 0, "color": "red"},
          {"value": 95, "color": "yellow"},
          {"value": 99, "color": "green"}
        ]
      },
      {
        "title": "ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ (Issues/æ—¥)",
        "targets": [
          {
            "expr": "miyabi_task_throughput_daily"
          }
        ],
        "type": "graph"
      },
      {
        "title": "Agentç¨¼åƒç‡",
        "targets": [
          {
            "expr": "miyabi_agent_utilization_rate * 100"
          }
        ],
        "type": "bar gauge"
      }
    ]
  }
}
```

---

## âœ… KPIé”æˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1å®Œäº†æ™‚
- [ ] è‡ªå¾‹ç¨¼åƒç‡ â‰¥ 50%
- [ ] ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ â‰¥ 10 Issues/æ—¥
- [ ] ã‚¿ã‚¹ã‚¯æˆåŠŸç‡ â‰¥ 70%
- [ ] MTTR < 10åˆ†

### Phase 4å®Œäº†æ™‚ï¼ˆæœ€çµ‚ç›®æ¨™ï¼‰
- [ ] è‡ªå¾‹ç¨¼åƒç‡ â‰¥ 99.9%
- [ ] ã‚¿ã‚¹ã‚¯å‡¦ç†ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ â‰¥ 100 Issues/æ—¥
- [ ] ã‚¿ã‚¹ã‚¯æˆåŠŸç‡ â‰¥ 98%
- [ ] MTTR < 1åˆ†
- [ ] ã‚·ã‚¹ãƒ†ãƒ å¯ç”¨æ€§ â‰¥ 99.99%

---

**KPIç®¡ç†è²¬ä»»è€…**: Project Manager
**ãƒ¬ãƒ“ãƒ¥ãƒ¼é »åº¦**: é€±æ¬¡
**æœ€çµ‚æ›´æ–°**: 2025-11-03
