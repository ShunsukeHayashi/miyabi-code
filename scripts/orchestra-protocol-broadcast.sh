#!/bin/bash
# ============================================
# 🎼 Orchestra-Worker プロトコル伝達スクリプト
# Version: 1.0.0
# Date: 2025-11-22
# ============================================

set -e

echo "📨 PUSH型報告プロトコル伝達開始..."

# ============================================
# オーケストレーターへの指示
# ============================================
echo "→ ORCHESTRATOR (%1) に指示送信..."
tmux send-keys -t %1 '【⚠️ P0ルール: PULL禁止・PUSH待機】

ワーカーの状況を確認しに行かないでください。処理負荷が大きくなります。

■ 新ルール
- ❌ tmux capture-paneでワーカーを確認しない
- ❌ ワーカーの状態をポーリングしない
- ✅ ワーカーからの報告を待つだけ

■ ワーカーからの報告形式
[WORKER-N報告] 作業内容: 結果

■ 指示送信方法
tmux send-keys -t %2 "指示内容" Enter  # WORKER-1
tmux send-keys -t %3 "指示内容" Enter  # WORKER-2
tmux send-keys -t %4 "指示内容" Enter  # WORKER-3
tmux send-keys -t %5 "指示内容" Enter  # WORKER-4

このルールを認識したら「プロトコル了解」と返答してください。' Enter

sleep 0.5

# ============================================
# WORKER-1への指示
# ============================================
echo "→ WORKER-1 (%2) に指示送信..."
tmux send-keys -t %2 '【⚠️ P0ルール: PUSH型報告】

オーケストレーターが確認しに来るのを待たないでください。

■ あなたの責務（必須）
作業が完了したら、自分から即座にオーケストレーターへ報告を送ってください。

■ 報告コマンド（作業完了時に必ず実行）
tmux send-keys -t %1 "[WORKER-1報告] 作業内容: 結果" Enter

■ 報告タイミング
- 開始時: [WORKER-1開始] タスク受領
- 進捗時: [WORKER-1進捗] 50%完了など
- 完了時: [WORKER-1完了] 結果サマリ
- ブロック時: [WORKER-1ブロック] 原因と対応案

このルールを認識したら「プロトコル了解」と返答してください。' Enter

sleep 0.5

# ============================================
# WORKER-2への指示
# ============================================
echo "→ WORKER-2 (%3) に指示送信..."
tmux send-keys -t %3 '【⚠️ P0ルール: PUSH型報告】

オーケストレーターが確認しに来るのを待たないでください。

■ あなたの責務（必須）
作業が完了したら、自分から即座にオーケストレーターへ報告を送ってください。

■ 報告コマンド（作業完了時に必ず実行）
tmux send-keys -t %1 "[WORKER-2報告] 作業内容: 結果" Enter

■ 報告タイミング
- 開始時: [WORKER-2開始] タスク受領
- 進捗時: [WORKER-2進捗] 50%完了など
- 完了時: [WORKER-2完了] 結果サマリ
- ブロック時: [WORKER-2ブロック] 原因と対応案

このルールを認識したら「プロトコル了解」と返答してください。' Enter

sleep 0.5

# ============================================
# WORKER-3への指示
# ============================================
echo "→ WORKER-3 (%4) に指示送信..."
tmux send-keys -t %4 '【⚠️ P0ルール: PUSH型報告】

オーケストレーターが確認しに来るのを待たないでください。

■ あなたの責務（必須）
作業が完了したら、自分から即座にオーケストレーターへ報告を送ってください。

■ 報告コマンド（作業完了時に必ず実行）
tmux send-keys -t %1 "[WORKER-3報告] 作業内容: 結果" Enter

■ 報告タイミング
- 開始時: [WORKER-3開始] タスク受領
- 進捗時: [WORKER-3進捗] 50%完了など
- 完了時: [WORKER-3完了] 結果サマリ
- ブロック時: [WORKER-3ブロック] 原因と対応案

このルールを認識したら「プロトコル了解」と返答してください。' Enter

sleep 0.5

# ============================================
# WORKER-4への指示
# ============================================
echo "→ WORKER-4 (%5) に指示送信..."
tmux send-keys -t %5 '【⚠️ P0ルール: PUSH型報告】

オーケストレーターが確認しに来るのを待たないでください。

■ あなたの責務（必須）
作業が完了したら、自分から即座にオーケストレーターへ報告を送ってください。

■ 報告コマンド（作業完了時に必ず実行）
tmux send-keys -t %1 "[WORKER-4報告] 作業内容: 結果" Enter

■ 報告タイミング
- 開始時: [WORKER-4開始] タスク受領
- 進捗時: [WORKER-4進捗] 50%完了など
- 完了時: [WORKER-4完了] 結果サマリ
- ブロック時: [WORKER-4ブロック] 原因と対応案

このルールを認識したら「プロトコル了解」と返答してください。' Enter

echo ""
echo "✅ プロトコル伝達完了!"
echo ""
echo "伝達先:"
echo "  %1 - ORCHESTRATOR: PULL禁止ルール"
echo "  %2 - WORKER-1: PUSH型報告ルール"
echo "  %3 - WORKER-2: PUSH型報告ルール"
echo "  %4 - WORKER-3: PUSH型報告ルール"
echo "  %5 - WORKER-4: PUSH型報告ルール"
