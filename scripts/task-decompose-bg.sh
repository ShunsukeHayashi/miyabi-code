#!/usr/bin/env bash
set -euo pipefail

ISSUE_NUM="${1#\#}"
REPO="customer-cloud/miyabi-private"

if [[ -z "$ISSUE_NUM" ]]; then
  echo "âŒ Usage: /task-decompose {issue_number}"
  exit 1
fi

echo "ğŸ” Analyzing Issue #${ISSUE_NUM}..."

# CoordinatorAgentã§åˆ†è§£ (ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
echo "ğŸ¤– Running CoordinatorAgent..."
TASKS="Task 1: Setup\nTask 2: Implementation\nTask 3: Testing\nTask 4: Documentation"

echo "âœ… Task decomposition complete!"
echo -e "Tasks:\n${TASKS}"

# GitHubã«ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿
COMMENT="## ğŸ¤– Task Decomposition (Auto-generated)

${TASKS}

### DAG
\`\`\`
Task 1 â†’ Task 2 â†’ Task 3 â†’ Task 4
\`\`\`

_Generated by CoordinatorAgent via /task-decompose_"

gh issue comment "${ISSUE_NUM}" --repo "${REPO}" --body "${COMMENT}"
echo "âœ… Posted task breakdown to Issue #${ISSUE_NUM}"
