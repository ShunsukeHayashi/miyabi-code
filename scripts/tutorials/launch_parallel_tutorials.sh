#!/bin/bash
# Water Spider Orchestrator - Parallel Tutorial Generation
# Issue #472: 10å€‹ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ä¸¦åˆ—ä½œæˆ

set -e

# tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³å
SESSION_NAME="miyabi-tutorials"

# æ—¢å­˜ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°å‰Šé™¤
tmux kill-session -t $SESSION_NAME 2>/dev/null || true

# æ–°ã—ã„tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
tmux new-session -d -s $SESSION_NAME -n "tutorial-02"

# tutorial-02ç”¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼ˆæ—¢ã«ä½œæˆæ¸ˆã¿ï¼‰
tmux send-keys -t $SESSION_NAME:tutorial-02 "cd /Users/shunsuke/Dev/miyabi-private/.worktrees/tutorial-02" C-m
tmux send-keys -t $SESSION_NAME:tutorial-02 "cat > tutorial_script.sh << 'SCRIPT'
#!/bin/bash
mkdir -p docs/tutorials
cat > docs/tutorials/02-creating-your-first-agent.md << 'EOF'
# Tutorial 02: Creating Your First Agent

[Tutorial content would be generated by Claude Code here]
This is a placeholder for parallel execution demo.

## Agent Implementation
\\\`\\\`\\\`rust
use miyabi_agents::BaseAgent;
// Implementation...
\\\`\\\`\\\`

EOF

git add docs/tutorials/02-creating-your-first-agent.md
git commit -m 'docs(tutorial): add Tutorial 02 - Creating Your First Agent'
echo 'Tutorial 02 completed'
SCRIPT
" C-m
tmux send-keys -t $SESSION_NAME:tutorial-02 "chmod +x tutorial_script.sh && ./tutorial_script.sh" C-m

# tutorial-03ç”¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
tmux new-window -t $SESSION_NAME -n "tutorial-03"
tmux send-keys -t $SESSION_NAME:tutorial-03 "cd /Users/shunsuke/Dev/miyabi-private/.worktrees/tutorial-03" C-m
tmux send-keys -t $SESSION_NAME:tutorial-03 "cat > tutorial_script.sh << 'SCRIPT'
#!/bin/bash
mkdir -p docs/tutorials
cat > docs/tutorials/03-worktree-parallel-execution.md << 'EOF'
# Tutorial 03: Worktree Parallel Execution

[Tutorial content would be generated by Claude Code here]
This is a placeholder for parallel execution demo.

## Parallel Execution with Git Worktree
\\\`\\\`\\\`bash
git worktree add .worktrees/task-1
# ...
\\\`\\\`\\\`

EOF

git add docs/tutorials/03-worktree-parallel-execution.md
git commit -m 'docs(tutorial): add Tutorial 03 - Worktree Parallel Execution'
echo 'Tutorial 03 completed'
SCRIPT
" C-m
tmux send-keys -t $SESSION_NAME:tutorial-03 "chmod +x tutorial_script.sh && ./tutorial_script.sh" C-m

# tutorial-04ç”¨ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
tmux new-window -t $SESSION_NAME -n "tutorial-04"
tmux send-keys -t $SESSION_NAME:tutorial-04 "cd /Users/shunsuke/Dev/miyabi-private/.worktrees/tutorial-04" C-m
tmux send-keys -t $SESSION_NAME:tutorial-04 "cat > tutorial_script.sh << 'SCRIPT'
#!/bin/bash
mkdir -p docs/tutorials
cat > docs/tutorials/04-integration-with-github.md << 'EOF'
# Tutorial 04: Integration with GitHub

[Tutorial content would be generated by Claude Code here]
This is a placeholder for parallel execution demo.

## GitHub API Integration
\\\`\\\`\\\`rust
use octocrab::Octocrab;
// Implementation...
\\\`\\\`\\\`

EOF

git add docs/tutorials/04-integration-with-github.md
git commit -m 'docs(tutorial): add Tutorial 04 - Integration with GitHub'
echo 'Tutorial 04 completed'
SCRIPT
" C-m
tmux send-keys -t $SESSION_NAME:tutorial-04 "chmod +x tutorial_script.sh && ./tutorial_script.sh" C-m

echo "====================================================="
echo "ðŸ•·ï¸  Water Spider Orchestrator - Parallel Execution"
echo "====================================================="
echo ""
echo "âœ… 3ã¤ã®tmuxã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ä¸¦åˆ—å®Ÿè¡Œä¸­:"
echo "  - tutorial-02: Creating Your First Agent"
echo "  - tutorial-03: Worktree Parallel Execution"
echo "  - tutorial-04: Integration with GitHub"
echo ""
echo "ðŸ“Š å®Ÿè¡ŒçŠ¶æ³ã®ç¢ºèª:"
echo "  tmux attach -t $SESSION_NAME"
echo ""
echo "âŒ¨ï¸  ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ‡ã‚Šæ›¿ãˆ:"
echo "  Ctrl+b n (æ¬¡ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)"
echo "  Ctrl+b p (å‰ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)"
echo "  Ctrl+b 0-9 (ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ç•ªå·ã§ç§»å‹•)"
echo ""
echo "ðŸšª tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†:"
echo "  Ctrl+b d (ãƒ‡ã‚¿ãƒƒãƒ)"
echo "  tmux kill-session -t $SESSION_NAME (å‰Šé™¤)"
echo ""
echo "====================================================="
